<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<title data-react-helmet="true">Setting up a High-availability RKE Kubernetes Cluster | My Site</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://btat.github.io/rancher-docusaurus/installation/resources/k8s-tutorials/ha-RKE"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Setting up a High-availability RKE Kubernetes Cluster | My Site"><meta data-react-helmet="true" name="description" content="This section describes how to install a Kubernetes cluster. This cluster should be dedicated to run only the Rancher server."><meta data-react-helmet="true" property="og:description" content="This section describes how to install a Kubernetes cluster. This cluster should be dedicated to run only the Rancher server."><link data-react-helmet="true" rel="shortcut icon" href="/rancher-docusaurus/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://btat.github.io/rancher-docusaurus/installation/resources/k8s-tutorials/ha-RKE"><link data-react-helmet="true" rel="alternate" href="https://btat.github.io/rancher-docusaurus/installation/resources/k8s-tutorials/ha-RKE" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://btat.github.io/rancher-docusaurus/installation/resources/k8s-tutorials/ha-RKE" hreflang="x-default"><link rel="stylesheet" href="/rancher-docusaurus/assets/css/styles.6d09dbb1.css">
<link rel="preload" href="/rancher-docusaurus/assets/js/runtime~main.9668cced.js" as="script">
<link rel="preload" href="/rancher-docusaurus/assets/js/main.7243044c.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/rancher-docusaurus/"><img src="/rancher-docusaurus/img/rancher-logo.svg" alt="Rancher Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/rancher-docusaurus/img/rancher-logo.svg" alt="Rancher Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Rancher Docs</b></a><a href="https://suse-projects.github.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>More SUSE Projects<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Overview</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Rancher Deployment Quick Start Guides</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Installing/Upgrading Rancher</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/index">Intro</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">install-rancher-on-k8s</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">other-installation-methods</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">requirements</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">resources</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">advanced</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/bootstrap-password">Bootstrap Password</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/chart-options">Rancher Helm Chart Options</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/choosing-version">Choosing a Rancher Version</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/custom-ca-root-certificate">About Custom CA Root Certificates</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">feature-flags</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/helm-version">Helm Version Requirements</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/index">Resources</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/installing-docker">Installing Docker</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">k8s-tutorials</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rancher-docusaurus/installation/resources/k8s-tutorials/ha-RKE">Setting up a High-availability RKE Kubernetes Cluster</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/k8s-tutorials/ha-rke2">Setting up a High-availability RKE2 Kubernetes Cluster for Rancher</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/k8s-tutorials/ha-with-external-db">Setting up a High-availability K3s Kubernetes Cluster for Rancher</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/k8s-tutorials/how-ha-works">About High-availability Installations</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/k8s-tutorials/index">Don&#x27;t have a Kubernetes cluster? Try one of these tutorials.</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">infrastructure-tutorials</a></li></ul></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/local-system-charts">Setting up Local System Charts for Air Gapped Installations</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/tls-secrets">Adding TLS Secrets</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/tls-settings">TLS Settings</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/troubleshooting">Troubleshooting the Rancher Server Kubernetes Cluster</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/update-ca-cert">Updating a Private CA Certificate</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">upgrading-cert-manager</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Best Practices Guide</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Backups and Disaster Recovery</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Authentication, Permissions and Global Configuration</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Setting up Kubernetes Clusters in Rancher</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Cluster Administration</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Project Administration</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pipelines</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Deploying Applications across Clusters</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Monitoring and Alerting</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Istio</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Logging</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">CIS Scans</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Kubernetes Resources</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Security</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">User Settings</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">API</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">FAQ</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Troubleshooting</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/cli">Using the Rancher Command Line Interface</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/contributing">Contributing to Rancher</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/helm-charts">Helm Charts in Rancher</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/">Rancher 2.6</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/longhorn">Longhorn - Cloud native distributed block storage for Kubernetes</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/opa-gatekeper">OPA Gatekeeper</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/system-tools">System Tools</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Setting up a High-availability RKE Kubernetes Cluster</h1></header><p>This section describes how to install a Kubernetes cluster. This cluster should be dedicated to run only the Rancher server.</p><p>&gt; Rancher can run on any Kubernetes cluster, included hosted Kubernetes solutions such as Amazon EKS. The below instructions represent only one possible way to install Kubernetes.</p><p>The Rancher management server can only be run on Kubernetes cluster in an infrastructure provider where Kubernetes is installed using RKE or K3s. Use of Rancher on hosted Kubernetes providers, such as EKS, is not supported.</p><p>For systems without direct internet access, refer to <a href="https://rancher.com/docs/rancher/v2.6/en/installation/other-installation-methods/air-gap/" target="_blank" rel="noopener noreferrer">Air Gap: Kubernetes install.</a></p><p>&gt; <strong>Single-node Installation Tip:</strong>
&gt; In a single-node Kubernetes cluster, the Rancher server does not have high availability, which is important for running Rancher in production. However, installing Rancher on a single-node cluster can be useful if you want to save resources by using a single node in the short term, while preserving a high-availability migration path.
&gt;
&gt; To set up a single-node RKE cluster, configure only one node in the <code>cluster.yml</code> . The single node should have all three roles: <code>etcd</code>, <code>controlplane</code>, and <code>worker</code>.
&gt;
&gt; In both single-node setups, Rancher can be installed with Helm on the Kubernetes cluster in the same way that it would be installed on any other cluster.</p><header><h1>Installing Kubernetes</h1></header><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="required-cli-tools"></a>Required CLI Tools<a class="hash-link" href="#required-cli-tools" title="Direct link to heading">#</a></h3><p>Install <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/#install-kubectl" target="_blank" rel="noopener noreferrer">kubectl,</a> a Kubernetes command-line tool.</p><p>Also install <a href="https://rancher.com/docs/rke/latest/en/installation/" target="_blank" rel="noopener noreferrer">RKE,</a> the Rancher Kubernetes Engine, a Kubernetes distribution and command-line tool.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="1-create-the-cluster-configuration-file"></a>1. Create the cluster configuration file<a class="hash-link" href="#1-create-the-cluster-configuration-file" title="Direct link to heading">#</a></h3><p>In this section, you will create a Kubernetes cluster configuration file called <code>rancher-cluster.yml</code>. In a later step, when you set up the cluster with an RKE command, it will use this file to install Kubernetes on your nodes.</p><p>Using the sample below as a guide, create the <code>rancher-cluster.yml</code> file. Replace the IP addresses in the <code>nodes</code> list with the IP address or DNS names of the 3 nodes you created.</p><p>If your node has public and internal addresses, it is recommended to set the <code>internal_address:</code> so Kubernetes will use it for intra-cluster communication. Some services like AWS EC2 require setting the <code>internal_address:</code> if you want to use self-referencing security groups or firewalls.</p><p>RKE will need to connect to each node over SSH, and it will look for a private key in the default location of <code>~/.ssh/id_rsa</code>. If your private key for a certain node is in a different location than the default, you will also need to configure the <code>ssh_key_path</code> option for that node.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">nodes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 165.227.114.63</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">internal_address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 172.16.22.12</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">user</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">role</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">controlplane</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> worker</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> etcd</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 165.227.116.167</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">internal_address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 172.16.32.37</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">user</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">role</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">controlplane</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> worker</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> etcd</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 165.227.127.226</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">internal_address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 172.16.42.73</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">user</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">role</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">controlplane</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> worker</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> etcd</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">etcd</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">snapshot</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">creation</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 6h</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">retention</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 24h</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Required for external TLS termination with</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ingress-nginx v0.22+</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">ingress</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">provider</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">options</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">use-forwarded-headers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;true&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>\&lt;figcaption&gt;Common RKE Nodes Options\&lt;/figcaption&gt;</p><table><thead><tr><th>Option</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td><code>address</code></td><td>yes</td><td>The public DNS or IP address</td></tr><tr><td><code>user</code></td><td>yes</td><td>A user that can run docker commands</td></tr><tr><td><code>role</code></td><td>yes</td><td>List of Kubernetes roles assigned to the node</td></tr><tr><td><code>internal_address</code></td><td>no</td><td>The private DNS or IP address for internal cluster traffic</td></tr><tr><td><code>ssh_key_path</code></td><td>no</td><td>Path to SSH private key used to authenticate to the node (defaults to <code>~/.ssh/id_rsa</code>)</td></tr></tbody></table><p>&gt; <strong>Advanced Configurations:</strong> RKE has many configuration options for customizing the install to suit your specific environment.
&gt;
&gt; Please see the <a href="https://rancher.com/docs/rke/latest/en/config-options/" target="_blank" rel="noopener noreferrer">RKE Documentation</a> for the full list of options and capabilities.
&gt;
&gt; For tuning your etcd cluster for larger Rancher installations, see the <a href="https://rancher.com/docs/rancher/v2.6/en/installation/resources/advanced/etcd/" target="_blank" rel="noopener noreferrer">etcd settings guide</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="2-run-rke"></a>2. Run RKE<a class="hash-link" href="#2-run-rke" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">rke up --config ./rancher-cluster.yml</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>When finished, it should end with the line: <code>Finished building Kubernetes cluster successfully</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="3-test-your-cluster"></a>3. Test Your Cluster<a class="hash-link" href="#3-test-your-cluster" title="Direct link to heading">#</a></h3><p>This section describes how to set up your workspace so that you can interact with this cluster using the <code>kubectl</code> command-line tool.</p><p>Assuming you have installed <code>kubectl</code>, you need to place the <code>kubeconfig</code> file in a location where <code>kubectl</code> can reach it. The <code>kubeconfig</code> file contains the credentials necessary to access your cluster with <code>kubectl</code>.</p><p>When you ran <code>rke up</code>, RKE should have created a <code>kubeconfig</code> file named <code>kube_config_rancher-cluster.yml</code>. This file has the credentials for <code>kubectl</code> and <code>helm</code>.</p><p>&gt; <strong>Note:</strong> If you have used a different file name from <code>rancher-cluster.yml</code>, then the kube config file will be named <code>kube_config_\&lt;FILE_NAME\&gt;.yml</code>.</p><p>Move this file to <code>$HOME/.kube/config</code>, or if you are working with multiple Kubernetes clusters, set the <code>KUBECONFIG</code> environmental variable to the path of <code>kube_config_rancher-cluster.yml</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">export KUBECONFIG=$(pwd)/kube_config_rancher-cluster.yml</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Test your connectivity with <code>kubectl</code> and see if all your nodes are in <code>Ready</code> state:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get nodes</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                          STATUS    ROLES                      AGE       VERSION</span></span><span class="token-line" style="color:#393A34"><span class="token plain">165.227.114.63                Ready     controlplane,etcd,worker   11m       v1.13.5</span></span><span class="token-line" style="color:#393A34"><span class="token plain">165.227.116.167               Ready     controlplane,etcd,worker   11m       v1.13.5</span></span><span class="token-line" style="color:#393A34"><span class="token plain">165.227.127.226               Ready     controlplane,etcd,worker   11m       v1.13.5</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="4-check-the-health-of-your-cluster-pods"></a>4. Check the Health of Your Cluster Pods<a class="hash-link" href="#4-check-the-health-of-your-cluster-pods" title="Direct link to heading">#</a></h3><p>Check that all the required pods and containers are healthy are ready to continue.</p><ul><li>Pods are in <code>Running</code> or <code>Completed</code> state.</li><li><code>READY</code> column shows all the containers are running (i.e. <code>3/3</code>) for pods with <code>STATUS</code> <code>Running</code></li><li>Pods with <code>STATUS</code> <code>Completed</code> are run-once Jobs. For these pods <code>READY</code> should be <code>0/1</code>.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods --all-namespaces</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">NAMESPACE       NAME                                      READY     STATUS      RESTARTS   AGE</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ingress-nginx   nginx-ingress-controller-tnsn4            1/1       Running     0          30s</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ingress-nginx   nginx-ingress-controller-tw2ht            1/1       Running     0          30s</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ingress-nginx   nginx-ingress-controller-v874b            1/1       Running     0          30s</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system     canal-jp4hz                               3/3       Running     0          30s</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system     canal-z2hg8                               3/3       Running     0          30s</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system     canal-z6kpw                               3/3       Running     0          30s</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system     kube-dns-7588d5b5f5-sf4vh                 3/3       Running     0          30s</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system     kube-dns-autoscaler-5db9bbb766-jz2k6      1/1       Running     0          30s</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system     metrics-server-97bc649d5-4rl2q            1/1       Running     0          30s</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system     rke-ingress-controller-deploy-job-bhzgm   0/1       Completed   0          30s</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system     rke-kubedns-addon-deploy-job-gl7t4        0/1       Completed   0          30s</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system     rke-metrics-addon-deploy-job-7ljkc        0/1       Completed   0          30s</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kube-system     rke-network-plugin-deploy-job-6pbgj       0/1       Completed   0          30s</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This confirms that you have successfully installed a Kubernetes cluster that the Rancher server will run on.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="5-save-your-files"></a>5. Save Your Files<a class="hash-link" href="#5-save-your-files" title="Direct link to heading">#</a></h3><p>&gt; <strong>Important</strong>
&gt; The files mentioned below are needed to maintain, troubleshoot and upgrade your cluster.</p><p>Save a copy of the following files in a secure location:</p><ul><li><code>rancher-cluster.yml</code>: The RKE cluster configuration file.</li><li><code>kube_config_rancher-cluster.yml</code>: The <a href="https://rancher.com/docs/rke/latest/en/kubeconfig/" target="_blank" rel="noopener noreferrer">Kubeconfig file</a> for the cluster, this file contains credentials for full access to the cluster.</li><li><code>rancher-cluster.rkestate</code>: The <a href="https://rancher.com/docs/rke/latest/en/installation/#kubernetes-cluster-state" target="_blank" rel="noopener noreferrer">Kubernetes Cluster State file</a>, this file contains credentials for full access to the cluster.<em>The Kubernetes Cluster State file is only created when using RKE v0.2.0 or higher.</em></li></ul><p>&gt; <strong>Note:</strong> The &quot;rancher-cluster&quot; parts of the two latter file names are dependent on how you name the RKE cluster configuration file.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="issues-or-errors"></a>Issues or errors?<a class="hash-link" href="#issues-or-errors" title="Direct link to heading">#</a></h3><p>See the <a href="https://rancher.com/docs/rancher/v2.6/en/installation/resources/troubleshooting/" target="_blank" rel="noopener noreferrer">Troubleshooting</a> page.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="next-install-rancher"></a><a href="https://rancher.com/docs/rancher/v2.6/en/installation/install-rancher-on-k8s/" target="_blank" rel="noopener noreferrer">Next: Install Rancher</a><a class="hash-link" href="#next-install-rancher" title="Direct link to heading">#</a></h3></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/main/website/docs/installation/resources/k8s-tutorials/ha-RKE.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/rancher-docusaurus/installation/resources/installing-docker"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Installing Docker</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/rancher-docusaurus/installation/resources/k8s-tutorials/ha-rke2"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Setting up a High-availability RKE2 Kubernetes Cluster for Rancher Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#required-cli-tools" class="table-of-contents__link">Required CLI Tools</a></li><li><a href="#1-create-the-cluster-configuration-file" class="table-of-contents__link">1. Create the cluster configuration file</a></li><li><a href="#2-run-rke" class="table-of-contents__link">2. Run RKE</a></li><li><a href="#3-test-your-cluster" class="table-of-contents__link">3. Test Your Cluster</a></li><li><a href="#4-check-the-health-of-your-cluster-pods" class="table-of-contents__link">4. Check the Health of Your Cluster Pods</a></li><li><a href="#5-save-your-files" class="table-of-contents__link">5. Save Your Files</a></li><li><a href="#issues-or-errors" class="table-of-contents__link">Issues or errors?</a></li><li><a href="#next-install-rancher" class="table-of-contents__link">Next: Install Rancher</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://forums.rancher.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Forums<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://slack.rancher.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/Rancher_Labs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://rancher.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Rancher Website</a></li><li class="footer__item"><a href="https://github.com/rancher/rancher" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Rancher on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/rancher/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Rancher Docs on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/rancher-docusaurus/assets/js/runtime~main.9668cced.js"></script>
<script src="/rancher-docusaurus/assets/js/main.7243044c.js"></script>
</body>
</html>