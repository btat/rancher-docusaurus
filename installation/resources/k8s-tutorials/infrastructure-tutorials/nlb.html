<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<title data-react-helmet="true">Setting up Amazon ELB Network Load Balancer | My Site</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://btat.github.io/rancher-docusaurus/installation/resources/k8s-tutorials/infrastructure-tutorials/nlb"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Setting up Amazon ELB Network Load Balancer | My Site"><meta data-react-helmet="true" name="description" content="This how-to guide describes how to set up a Network Load Balancer (NLB) in Amazon&#x27;s EC2 service that will direct traffic to multiple instances on EC2."><meta data-react-helmet="true" property="og:description" content="This how-to guide describes how to set up a Network Load Balancer (NLB) in Amazon&#x27;s EC2 service that will direct traffic to multiple instances on EC2."><link data-react-helmet="true" rel="shortcut icon" href="/rancher-docusaurus/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://btat.github.io/rancher-docusaurus/installation/resources/k8s-tutorials/infrastructure-tutorials/nlb"><link data-react-helmet="true" rel="alternate" href="https://btat.github.io/rancher-docusaurus/installation/resources/k8s-tutorials/infrastructure-tutorials/nlb" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://btat.github.io/rancher-docusaurus/installation/resources/k8s-tutorials/infrastructure-tutorials/nlb" hreflang="x-default"><link rel="stylesheet" href="/rancher-docusaurus/assets/css/styles.6d09dbb1.css">
<link rel="preload" href="/rancher-docusaurus/assets/js/runtime~main.9668cced.js" as="script">
<link rel="preload" href="/rancher-docusaurus/assets/js/main.7243044c.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/rancher-docusaurus/"><img src="/rancher-docusaurus/img/rancher-logo.svg" alt="Rancher Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/rancher-docusaurus/img/rancher-logo.svg" alt="Rancher Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Rancher Docs</b></a><a href="https://suse-projects.github.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>More SUSE Projects<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Overview</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Rancher Deployment Quick Start Guides</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Installing/Upgrading Rancher</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/index">Intro</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">install-rancher-on-k8s</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">other-installation-methods</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">requirements</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">resources</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">advanced</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/bootstrap-password">Bootstrap Password</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/chart-options">Rancher Helm Chart Options</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/choosing-version">Choosing a Rancher Version</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/custom-ca-root-certificate">About Custom CA Root Certificates</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">feature-flags</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/helm-version">Helm Version Requirements</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/index">Resources</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/installing-docker">Installing Docker</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">k8s-tutorials</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/k8s-tutorials/ha-RKE">Setting up a High-availability RKE Kubernetes Cluster</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/k8s-tutorials/ha-rke2">Setting up a High-availability RKE2 Kubernetes Cluster for Rancher</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/k8s-tutorials/ha-with-external-db">Setting up a High-availability K3s Kubernetes Cluster for Rancher</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/k8s-tutorials/how-ha-works">About High-availability Installations</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/k8s-tutorials/index">Don&#x27;t have a Kubernetes cluster? Try one of these tutorials.</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">infrastructure-tutorials</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/k8s-tutorials/infrastructure-tutorials/ec2-node">Setting up Nodes in Amazon EC2</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/k8s-tutorials/infrastructure-tutorials/index">Don&#x27;t have infrastructure for your Kubernetes cluster? Try one of these tutorials.</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/k8s-tutorials/infrastructure-tutorials/infra-for-ha-with-external-db">Set up Infrastructure for a High Availability K3s Kubernetes Cluster</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/k8s-tutorials/infrastructure-tutorials/infra-for-ha">Set up Infrastructure for a High Availability RKE Kubernetes Cluster</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/k8s-tutorials/infrastructure-tutorials/infra-for-rke2-ha">Set up Infrastructure for a High Availability RKE2 Kubernetes Cluster</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/k8s-tutorials/infrastructure-tutorials/nginx">Setting up an NGINX Load Balancer</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rancher-docusaurus/installation/resources/k8s-tutorials/infrastructure-tutorials/nlb">Setting up Amazon ELB Network Load Balancer</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/k8s-tutorials/infrastructure-tutorials/rds">Setting up a MySQL Database in Amazon RDS</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/local-system-charts">Setting up Local System Charts for Air Gapped Installations</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/tls-secrets">Adding TLS Secrets</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/tls-settings">TLS Settings</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/troubleshooting">Troubleshooting the Rancher Server Kubernetes Cluster</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/update-ca-cert">Updating a Private CA Certificate</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">upgrading-cert-manager</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Best Practices Guide</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Backups and Disaster Recovery</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Authentication, Permissions and Global Configuration</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Setting up Kubernetes Clusters in Rancher</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Cluster Administration</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Project Administration</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pipelines</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Deploying Applications across Clusters</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Monitoring and Alerting</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Istio</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Logging</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">CIS Scans</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Kubernetes Resources</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Security</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">User Settings</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">API</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">FAQ</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Troubleshooting</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/cli">Using the Rancher Command Line Interface</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/contributing">Contributing to Rancher</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/helm-charts">Helm Charts in Rancher</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/">Rancher 2.6</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/longhorn">Longhorn - Cloud native distributed block storage for Kubernetes</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/opa-gatekeper">OPA Gatekeeper</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/system-tools">System Tools</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Setting up Amazon ELB Network Load Balancer</h1></header><p>This how-to guide describes how to set up a Network Load Balancer (NLB) in Amazon&#x27;s EC2 service that will direct traffic to multiple instances on EC2.</p><p>These examples show the load balancer being configured to direct traffic to three Rancher server nodes. If Rancher is installed on an RKE Kubernetes cluster, three nodes are required. If Rancher is installed on a K3s Kubernetes cluster, only two nodes are required.</p><p>This tutorial is about one possible way to set up your load balancer, not the only way. Other types of load balancers, such as a Classic Load Balancer or Application Load Balancer, could also direct traffic to the Rancher server nodes.</p><p>Rancher only supports using the Amazon NLB when terminating traffic in <code>tcp</code> mode for port 443 rather than <code>tls</code> mode. This is due to the fact that the NLB does not inject the correct headers into requests when terminated at the NLB. This means that if you want to use certificates managed by the Amazon Certificate Manager (ACM), you should use an ALB.</p><header><h1>Setting up the Load Balancer</h1></header><p>Configuring an Amazon NLB is a multistage process:</p><ol><li><a href="#1-create-target-groups">Create Target Groups</a></li><li><a href="#2-register-targets">Register Targets</a></li><li><a href="#3-create-your-nlb">Create Your NLB</a></li><li><a href="#4-add-listener-to-nlb-for-tcp-port-80">Add listener to NLB for TCP port 80</a></li></ol><header><h1>Requirements</h1></header><p>These instructions assume you have already created Linux instances in EC2. The load balancer will direct traffic to these nodes.</p><header><h1>1. Create Target Groups</h1></header><p>Begin by creating two target groups for the <strong>TCP</strong> protocol, one with TCP port 443 and one regarding TCP port 80 (providing redirect to TCP port 443). You&#x27;ll add your Linux nodes to these groups.</p><p>Your first NLB configuration step is to create two target groups. Technically, only port 443 is needed to access Rancher, but it&#x27;s convenient to add a listener for port 80, because traffic to port 80 will be automatically redirected to port 443.</p><p>Regardless of whether an NGINX Ingress or Traefik Ingress controller is used, the Ingress should redirect traffic from port 80 to port 443.</p><ol><li>Log into the <a href="https://console.aws.amazon.com/ec2/" target="_blank" rel="noopener noreferrer">Amazon AWS Console</a> to get started. Make sure to select the <strong>Region</strong> where your EC2 instances (Linux nodes) are created.</li><li>Select <strong>Services</strong> and choose <strong>EC2</strong>, find the section <strong>Load Balancing</strong> and open <strong>Target Groups</strong>.</li><li>Click <strong>Create target group</strong> to create the first target group, regarding TCP port 443.</li></ol><p>&gt; <strong>Note:</strong> Health checks are handled differently based on the Ingress. For details, refer to <a href="#health-check-paths-for-nginx-ingress-and-traefik-ingresses">this section.</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="target-group-tcp-port-443"></a>Target Group (TCP port 443)<a class="hash-link" href="#target-group-tcp-port-443" title="Direct link to heading">#</a></h3><p>Configure the first target group according to the table below.</p><table><thead><tr><th>Option</th><th>Setting</th></tr></thead><tbody><tr><td>Target Group Name</td><td><code>rancher-tcp-443</code></td></tr><tr><td>Target type</td><td><code>instance</code></td></tr><tr><td>Protocol</td><td><code>TCP</code></td></tr><tr><td>Port</td><td><code>443</code></td></tr><tr><td>VPC</td><td>Choose your VPC</td></tr></tbody></table><p>Health check settings:</p><table><thead><tr><th>Option</th><th>Setting</th></tr></thead><tbody><tr><td>Protocol</td><td>TCP</td></tr><tr><td>Port</td><td><code>override</code>,<code>80</code></td></tr><tr><td>Healthy threshold</td><td><code>3</code></td></tr><tr><td>Unhealthy threshold</td><td><code>3</code></td></tr><tr><td>Timeout</td><td><code>6 seconds</code></td></tr><tr><td>Interval</td><td><code>10 seconds</code></td></tr></tbody></table><p>Click <strong>Create target group</strong> to create the second target group, regarding TCP port 80.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="target-group-tcp-port-80"></a>Target Group (TCP port 80)<a class="hash-link" href="#target-group-tcp-port-80" title="Direct link to heading">#</a></h3><p>Configure the second target group according to the table below.</p><table><thead><tr><th>Option</th><th>Setting</th></tr></thead><tbody><tr><td>Target Group Name</td><td><code>rancher-tcp-80</code></td></tr><tr><td>Target type</td><td><code>instance</code></td></tr><tr><td>Protocol</td><td><code>TCP</code></td></tr><tr><td>Port</td><td><code>80</code></td></tr><tr><td>VPC</td><td>Choose your VPC</td></tr></tbody></table><p>Health check settings:</p><table><thead><tr><th>Option</th><th>Setting</th></tr></thead><tbody><tr><td>Protocol</td><td>TCP</td></tr><tr><td>Port</td><td><code>traffic port</code></td></tr><tr><td>Healthy threshold</td><td><code>3</code></td></tr><tr><td>Unhealthy threshold</td><td><code>3</code></td></tr><tr><td>Timeout</td><td><code>6 seconds</code></td></tr><tr><td>Interval</td><td><code>10 seconds</code></td></tr></tbody></table><header><h1>2. Register Targets</h1></header><p>Next, add your Linux nodes to both target groups.</p><p>Select the target group named <strong>rancher-tcp-443</strong>, click the tab <strong>Targets</strong> and choose <strong>Edit</strong>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly img"><pre tabindex="0" class="prism-code language-img codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">{{ img &quot;/img/rancher/ha/nlb/edit-targetgroup-443.png&quot; &quot;Edit target group 443&quot;}}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Select the instances (Linux nodes) you want to add, and click <strong>Add to registered</strong>.</p><p>\&lt;hr&gt;
<strong>Screenshot Add targets to target group TCP port 443</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly img"><pre tabindex="0" class="prism-code language-img codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">{{ img &quot;/img/rancher/ha/nlb/add-targets-targetgroup-443.png&quot;}}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>\&lt;hr&gt;
<strong>Screenshot Added targets to target group TCP port 443</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly img"><pre tabindex="0" class="prism-code language-img codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">{{ img &quot;/img/rancher/ha/nlb/added-targets-targetgroup-443.png&quot; &quot;Added targets to target group 443&quot;}}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>When the instances are added, click <strong>Save</strong> on the bottom right of the screen.</p><p>Repeat those steps, replacing <strong>rancher-tcp-443</strong> with <strong>rancher-tcp-80</strong>. The same instances need to be added as targets to this target group.</p><header><h1>3. Create Your NLB</h1></header><p>Use Amazon&#x27;s Wizard to create a Network Load Balancer. As part of this process, you&#x27;ll add the target groups you created in <a href="#1-create-target-groups">1. Create Target Groups</a>.</p><ol><li><p>From your web browser, navigate to the <a href="https://console.aws.amazon.com/ec2/" target="_blank" rel="noopener noreferrer">Amazon EC2 Console</a>.</p></li><li><p>From the navigation pane, choose <strong>LOAD BALANCING</strong> &gt; <strong>Load Balancers</strong>.</p></li><li><p>Click <strong>Create Load Balancer</strong>.</p></li><li><p>Choose <strong>Network Load Balancer</strong> and click <strong>Create</strong>. Then complete each form.</p></li></ol><ul><li><a href="#step-1-configure-load-balancer">Step 1: Configure Load Balancer</a></li><li><a href="#step-2-configure-routing">Step 2: Configure Routing</a></li><li><a href="#step-3-register-targets">Step 3: Register Targets</a></li><li><a href="#step-4-review">Step 4: Review</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step-1-configure-load-balancer"></a>Step 1: Configure Load Balancer<a class="hash-link" href="#step-1-configure-load-balancer" title="Direct link to heading">#</a></h3><p>Set the following fields in the form:</p><ul><li><strong>Name:</strong> <code>rancher</code></li><li><strong>Scheme:</strong> <code>internal</code> or <code>internet-facing</code>. The scheme that you choose for your NLB is dependent on the configuration of your instances and VPC. If your instances do not have public IPs associated with them, or you will only be accessing Rancher internally, you should set your NLB Scheme to <code>internal</code> rather than <code>internet-facing</code>.</li><li><strong>Listeners:</strong> The Load Balancer Protocol should be <code>TCP</code> and the corresponding Load Balancer Port should be set to <code>443</code>.</li><li><strong>Availability Zones:</strong> Select Your <strong>VPC</strong> and <strong>Availability Zones</strong>.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step-2-configure-routing"></a>Step 2: Configure Routing<a class="hash-link" href="#step-2-configure-routing" title="Direct link to heading">#</a></h3><ol><li>From the <strong>Target Group</strong> drop-down, choose <strong>Existing target group</strong>.</li><li>From the <strong>Name</strong> drop-down, choose <code>rancher-tcp-443</code>.</li><li>Open <strong>Advanced health check settings</strong>, and configure <strong>Interval</strong> to <code>10 seconds</code>.</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step-3-register-targets"></a>Step 3: Register Targets<a class="hash-link" href="#step-3-register-targets" title="Direct link to heading">#</a></h3><p>Since you registered your targets earlier, all you have to do is click <strong>Next: Review</strong>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step-4-review"></a>Step 4: Review<a class="hash-link" href="#step-4-review" title="Direct link to heading">#</a></h3><p>Look over the load balancer details and click <strong>Create</strong> when you&#x27;re satisfied.</p><p>After AWS creates the NLB, click <strong>Close</strong>.</p><header><h1>4. Add listener to NLB for TCP port 80</h1></header><ol><li><p>Select your newly created NLB and select the <strong>Listeners</strong> tab.</p></li><li><p>Click <strong>Add listener</strong>.</p></li><li><p>Use <code>TCP</code>:<code>80</code> as <strong>Protocol</strong> : <strong>Port</strong></p></li><li><p>Click <strong>Add action</strong> and choose <strong>Forward to..</strong>.</p></li><li><p>From the <strong>Forward to</strong> drop-down, choose <code>rancher-tcp-80</code>.</p></li><li><p>Click <strong>Save</strong> in the top right of the screen.</p></li></ol><header><h1>Health Check Paths for NGINX Ingress and Traefik Ingresses</h1></header><p>K3s and RKE Kubernetes clusters handle health checks differently because they use different Ingresses by default.</p><p>For RKE Kubernetes clusters, NGINX Ingress is used by default, whereas for K3s Kubernetes clusters, Traefik is the default Ingress. </p><ul><li><strong>Traefik:</strong> The health check path is <code>/ping</code>. By default <code>/ping</code> is always matched (regardless of Host), and a response from <a href="https://docs.traefik.io/operations/ping/" target="_blank" rel="noopener noreferrer">Traefik itself</a> is always served.</li><li><strong>NGINX Ingress:</strong> The default backend of the NGINX Ingress controller has a <code>/healthz</code> endpoint. By default <code>/healthz</code> is always matched (regardless of Host), and a response from <a href="https://github.com/kubernetes/ingress-nginx/blob/0cbe783f43a9313c9c26136e888324b1ee91a72f/charts/ingress-nginx/values.yaml#L212" target="_blank" rel="noopener noreferrer"><code>ingress-nginx</code> itself</a> is always served.</li></ul><p>To simulate an accurate health check, it is a best practice to use the Host header (Rancher hostname) combined with <code>/ping</code> or <code>/healthz</code> (for K3s or for RKE clusters, respectively) wherever possible, to get a response from the Rancher Pods, not the Ingress.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/main/website/docs/installation/resources/k8s-tutorials/infrastructure-tutorials/nlb.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/rancher-docusaurus/installation/resources/k8s-tutorials/infrastructure-tutorials/nginx"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Setting up an NGINX Load Balancer</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/rancher-docusaurus/installation/resources/k8s-tutorials/infrastructure-tutorials/rds"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Setting up a MySQL Database in Amazon RDS Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#target-group-tcp-port-443" class="table-of-contents__link">Target Group (TCP port 443)</a></li><li><a href="#target-group-tcp-port-80" class="table-of-contents__link">Target Group (TCP port 80)</a></li><li><a href="#step-1-configure-load-balancer" class="table-of-contents__link">Step 1: Configure Load Balancer</a></li><li><a href="#step-2-configure-routing" class="table-of-contents__link">Step 2: Configure Routing</a></li><li><a href="#step-3-register-targets" class="table-of-contents__link">Step 3: Register Targets</a></li><li><a href="#step-4-review" class="table-of-contents__link">Step 4: Review</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://forums.rancher.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Forums<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://slack.rancher.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/Rancher_Labs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://rancher.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Rancher Website</a></li><li class="footer__item"><a href="https://github.com/rancher/rancher" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Rancher on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/rancher/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Rancher Docs on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/rancher-docusaurus/assets/js/runtime~main.9668cced.js"></script>
<script src="/rancher-docusaurus/assets/js/main.7243044c.js"></script>
</body>
</html>