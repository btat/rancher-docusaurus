<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<title data-react-helmet="true">Docker Install with TLS Termination at Layer-7 NGINX Load Balancer | My Site</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://btat.github.io/rancher-docusaurus/installation/resources/advanced/single-node-install-external-lb"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Docker Install with TLS Termination at Layer-7 NGINX Load Balancer | My Site"><meta data-react-helmet="true" name="description" content="For development and testing environments that have a special requirement to terminate TLS/SSL at a load balancer instead of your Rancher Server container, deploy Rancher and configure a load balancer to work with it conjunction."><meta data-react-helmet="true" property="og:description" content="For development and testing environments that have a special requirement to terminate TLS/SSL at a load balancer instead of your Rancher Server container, deploy Rancher and configure a load balancer to work with it conjunction."><link data-react-helmet="true" rel="shortcut icon" href="/rancher-docusaurus/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://btat.github.io/rancher-docusaurus/installation/resources/advanced/single-node-install-external-lb"><link data-react-helmet="true" rel="alternate" href="https://btat.github.io/rancher-docusaurus/installation/resources/advanced/single-node-install-external-lb" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://btat.github.io/rancher-docusaurus/installation/resources/advanced/single-node-install-external-lb" hreflang="x-default"><link rel="stylesheet" href="/rancher-docusaurus/assets/css/styles.6d09dbb1.css">
<link rel="preload" href="/rancher-docusaurus/assets/js/runtime~main.9668cced.js" as="script">
<link rel="preload" href="/rancher-docusaurus/assets/js/main.7243044c.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/rancher-docusaurus/"><img src="/rancher-docusaurus/img/rancher-logo.svg" alt="Rancher Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/rancher-docusaurus/img/rancher-logo.svg" alt="Rancher Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Rancher Docs</b></a><a href="https://suse-projects.github.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>More SUSE Projects<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Overview</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Rancher Deployment Quick Start Guides</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Installing/Upgrading Rancher</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/index">Intro</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">install-rancher-on-k8s</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">other-installation-methods</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">requirements</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">resources</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">advanced</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/advanced/api-audit-log">Enabling the API Audit Log to Record System Events</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/advanced/arm64-platform">Running on ARM64 (Experimental)</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/advanced/etcd">Tuning etcd for Large Installations</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/advanced/firewall">Opening Ports with firewalld</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/advanced/index">Advanced</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rancher-docusaurus/installation/resources/advanced/single-node-install-external-lb">Docker Install with TLS Termination at Layer-7 NGINX Load Balancer</a></li></ul></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/bootstrap-password">Bootstrap Password</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/chart-options">Rancher Helm Chart Options</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/choosing-version">Choosing a Rancher Version</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/custom-ca-root-certificate">About Custom CA Root Certificates</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">feature-flags</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/helm-version">Helm Version Requirements</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/index">Resources</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/installing-docker">Installing Docker</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">k8s-tutorials</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/local-system-charts">Setting up Local System Charts for Air Gapped Installations</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/tls-secrets">Adding TLS Secrets</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/tls-settings">TLS Settings</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/troubleshooting">Troubleshooting the Rancher Server Kubernetes Cluster</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/resources/update-ca-cert">Updating a Private CA Certificate</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">upgrading-cert-manager</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Best Practices Guide</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Backups and Disaster Recovery</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Authentication, Permissions and Global Configuration</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Setting up Kubernetes Clusters in Rancher</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Cluster Administration</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Project Administration</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pipelines</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Deploying Applications across Clusters</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Monitoring and Alerting</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Istio</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Logging</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">CIS Scans</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Kubernetes Resources</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Security</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">User Settings</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">API</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">FAQ</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Troubleshooting</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/cli">Using the Rancher Command Line Interface</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/contributing">Contributing to Rancher</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/helm-charts">Helm Charts in Rancher</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/">Rancher 2.6</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/longhorn">Longhorn - Cloud native distributed block storage for Kubernetes</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/opa-gatekeper">OPA Gatekeeper</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/system-tools">System Tools</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Docker Install with TLS Termination at Layer-7 NGINX Load Balancer</h1></header><p>For development and testing environments that have a special requirement to terminate TLS/SSL at a load balancer instead of your Rancher Server container, deploy Rancher and configure a load balancer to work with it conjunction.</p><p>A layer-7 load balancer can be beneficial if you want to centralize your TLS termination in your infrastructure. Layer-7 load balancing also offers the capability for your load balancer to make decisions based on HTTP attributes such as cookies, etc. that a layer-4 load balancer is not able to concern itself with.</p><p>This install procedure walks you through deployment of Rancher using a single container, and then provides a sample configuration for a layer-7 NGINX load balancer.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="requirements-for-os-docker-hardware-and-networking"></a>Requirements for OS, Docker, Hardware, and Networking<a class="hash-link" href="#requirements-for-os-docker-hardware-and-networking" title="Direct link to heading">#</a></h2><p>Make sure that your node fulfills the general <a href="https://rancher.com/docs/rancher/v2.6/en/installation/requirements/" target="_blank" rel="noopener noreferrer">installation requirements.</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="installation-outline"></a>Installation Outline<a class="hash-link" href="#installation-outline" title="Direct link to heading">#</a></h2><p>\&lt;!-- TOC --&gt;</p><ul><li><a href="#1-provision-linux-host">1. Provision Linux Host</a></li><li><a href="#2-choose-an-ssl-option-and-install-rancher">2. Choose an SSL Option and Install Rancher</a></li><li><a href="#3-configure-load-balancer">3. Configure Load Balancer</a></li></ul><p>\&lt;!-- /TOC --&gt;</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="1-provision-linux-host"></a>1. Provision Linux Host<a class="hash-link" href="#1-provision-linux-host" title="Direct link to heading">#</a></h2><p>Provision a single Linux host according to our <a href="https://rancher.com/docs/rancher/v2.6/en/installation/requirements" target="_blank" rel="noopener noreferrer">Requirements</a> to launch your Rancher Server.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="2-choose-an-ssl-option-and-install-rancher"></a>2. Choose an SSL Option and Install Rancher<a class="hash-link" href="#2-choose-an-ssl-option-and-install-rancher" title="Direct link to heading">#</a></h2><p>For security purposes, SSL (Secure Sockets Layer) is required when using Rancher. SSL secures all Rancher network communication, like when you login or interact with a cluster.</p><p>&gt; <strong>Do you want to..</strong>.
&gt;
&gt; - Complete an Air Gap Installation?
&gt; - Record all transactions with the Rancher API?
&gt;
&gt; See <a href="#advanced-options">Advanced Options</a> below before continuing.</p><p>Choose from the following options:</p><p>{{% accordion id=&quot;option-a&quot; label=&quot;Option A-Bring Your Own Certificate: Self-Signed&quot; %}}
If you elect to use a self-signed certificate to encrypt communication, you must install the certificate on your load balancer (which you&#x27;ll do later) and your Rancher container. Run the Docker command to deploy Rancher, pointing it toward your certificate.</p><p>&gt; <strong>Prerequisites:</strong>
&gt; Create a self-signed certificate.
&gt;
&gt; - The certificate files must be in PEM format.</p><p><strong>To Install Rancher Using a Self-Signed Cert:</strong></p><ol><li><p>While running the Docker command to deploy Rancher, point Docker toward your CA certificate file.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">docker run -d --restart=unless-stopped \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  -p 80:80 -p 443:443 \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  -v /etc/your_certificate_directory/cacerts.pem:/etc/rancher/ssl/cacerts.pem \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  rancher/rancher:latest</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ol><p>{{% /accordion %}}
{{% accordion id=&quot;option-b&quot; label=&quot;Option B-Bring Your Own Certificate: Signed by Recognized CA&quot; %}}
If your cluster is public facing, it&#x27;s best to use a certificate signed by a recognized CA.</p><p>&gt; <strong>Prerequisites:</strong>
&gt;
&gt; - The certificate files must be in PEM format.</p><p><strong>To Install Rancher Using a Cert Signed by a Recognized CA:</strong></p><p>If you use a certificate signed by a recognized CA, installing your certificate in the Rancher container isn&#x27;t necessary. We do have to make sure there is no default CA certificate generated and stored, you can do this by passing the <code>--no-cacerts</code> parameter to the container.</p><ol><li><p>Enter the following command.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">```</span></span><span class="token-line" style="color:#393A34"><span class="token plain">docker run -d --restart=unless-stopped \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">-p 80:80 -p 443:443 \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">rancher/rancher:latest --no-cacerts</span></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>{{% /accordion %}}</p></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="3-configure-load-balancer"></a>3. Configure Load Balancer<a class="hash-link" href="#3-configure-load-balancer" title="Direct link to heading">#</a></h2><p>When using a load balancer in front of your Rancher container, there&#x27;s no need for the container to redirect port communication from port 80 or port 443. By passing the header <code>X-Forwarded-Proto: https</code> header, this redirect is disabled.</p><p>The load balancer or proxy has to be configured to support the following:</p><ul><li><p><strong>WebSocket</strong> connections</p></li><li><p><strong>SPDY</strong> / <strong>HTTP/2</strong> protocols</p></li><li><p>Passing / setting the following headers:</p><table><thead><tr><th>Header</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td><code>Host</code></td><td>Hostname used to reach Rancher.</td><td>To identify the server requested by the client.</td></tr><tr><td><code>X-Forwarded-Proto</code></td><td><code>https</code></td><td>To identify the protocol that a client used to connect to the load balancer or proxy.\&lt;br /&gt;<strong>Note:</strong> If this header is present, <code>rancher/rancher</code> does not redirect HTTP to HTTPS.</td></tr><tr><td><code>X-Forwarded-Port</code></td><td>Port used to reach Rancher.</td><td>To identify the protocol that client used to connect to the load balancer or proxy.</td></tr><tr><td><code>X-Forwarded-For</code></td><td>IP of the client connection.</td><td>To identify the originating IP address of a client.</td></tr></tbody></table></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="example-nginx-configuration"></a>Example NGINX configuration<a class="hash-link" href="#example-nginx-configuration" title="Direct link to heading">#</a></h3><p>This NGINX configuration is tested on NGINX 1.14.</p><p>&gt; <strong>Note:</strong> This NGINX configuration is only an example and may not suit your environment. For complete documentation, see <a href="https://docs.nginx.com/nginx/admin-guide/load-balancer/http-load-balancer/" target="_blank" rel="noopener noreferrer">NGINX Load Balancing - HTTP Load Balancing</a>.</p><ul><li>Replace <code>rancher-server</code> with the IP address or hostname of the node running the Rancher container.</li><li>Replace both occurrences of <code>FQDN</code> to the DNS name for Rancher.</li><li>Replace <code>/certs/fullchain.pem</code> and <code>/certs/privkey.pem</code> to the location of the server certificate and the server certificate key respectively.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">worker_processes 4;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">worker_rlimit_nofile 40000;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">events {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    worker_connections 8192;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">http {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    upstream rancher {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        server rancher-server:80;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    map $http_upgrade $connection_upgrade {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        default Upgrade;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;&#x27;      close;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    server {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        listen 443 ssl http2;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        server_name FQDN;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        ssl_certificate /certs/fullchain.pem;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        ssl_certificate_key /certs/privkey.pem;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        location / {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            proxy_set_header Host $host;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            proxy_set_header X-Forwarded-Proto $scheme;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            proxy_set_header X-Forwarded-Port $server_port;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            proxy_pass http://rancher;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            proxy_http_version 1.1;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            proxy_set_header Upgrade $http_upgrade;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            proxy_set_header Connection $connection_upgrade;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            # This allows the ability for the execute shell window to remain open for up to 15 minutes. Without this parameter, the default is 1 minute and will automatically close.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            proxy_read_timeout 900s;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            proxy_buffering off;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    server {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        listen 80;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        server_name FQDN;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return 301 https://$server_name$request_uri;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="whats-next"></a>What&#x27;s Next?<a class="hash-link" href="#whats-next" title="Direct link to heading">#</a></h2><ul><li><strong>Recommended:</strong> Review <a href="https://rancher.com/docs/rancher/v2.6/en/backups/docker-installs/" target="_blank" rel="noopener noreferrer">Single Node Backup and Restore</a>. Although you don&#x27;t have any data you need to back up right now, we recommend creating backups after regular Rancher use.</li><li>Create a Kubernetes cluster: <a href="https://rancher.com/docs/rancher/v2.6/en/cluster-provisioning/" target="_blank" rel="noopener noreferrer">Provisioning Kubernetes Clusters</a>.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="faq-and-troubleshooting"></a>FAQ and Troubleshooting<a class="hash-link" href="#faq-and-troubleshooting" title="Direct link to heading">#</a></h2><p>For help troubleshooting certificates, see <a href="https://rancher.com/docs/rancher/v2.6/en/installation/other-installation-methods/single-node-docker/troubleshooting" target="_blank" rel="noopener noreferrer">this section.</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="advanced-options"></a>Advanced Options<a class="hash-link" href="#advanced-options" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="api-auditing"></a>API Auditing<a class="hash-link" href="#api-auditing" title="Direct link to heading">#</a></h3><p>If you want to record all transactions with the Rancher API, enable the <a href="https://rancher.com/docs/rancher/v2.6/en/installation/resources/advanced/api-audit-log" target="_blank" rel="noopener noreferrer">API Auditing</a> feature by adding the flags below into your install command.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">-e AUDIT_LEVEL=1 \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">-e AUDIT_LOG_PATH=/var/log/auditlog/rancher-api-audit.log \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">-e AUDIT_LOG_MAXAGE=20 \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">-e AUDIT_LOG_MAXBACKUP=20 \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">-e AUDIT_LOG_MAXSIZE=100 \</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="air-gap"></a>Air Gap<a class="hash-link" href="#air-gap" title="Direct link to heading">#</a></h3><p>If you are visiting this page to complete an <a href="https://rancher.com/docs/rancher/v2.6/en/installation/other-installation-methods/air-gap" target="_blank" rel="noopener noreferrer">Air Gap Installation</a>, you must pre-pend your private registry URL to the server tag when running the installation command in the option that you choose. Add <code>\&lt;REGISTRY.DOMAIN.COM:PORT\&gt;</code> with your private registry URL in front of <code>rancher/rancher:latest</code>.</p><p><strong>Example:</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"> \&lt;REGISTRY.DOMAIN.COM:PORT\&gt;/rancher/rancher:latest</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="persistent-data"></a>Persistent Data<a class="hash-link" href="#persistent-data" title="Direct link to heading">#</a></h3><p>Rancher uses etcd as a datastore. When Rancher is installed with Docker, the embedded etcd is being used. The persistent data is at the following path in the container: <code>/var/lib/rancher</code>.</p><p>You can bind mount a host volume to this location to preserve data on the host it is running on:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">docker run -d --restart=unless-stopped \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  -p 80:80 -p 443:443 \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  -v /opt/rancher:/var/lib/rancher \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  --privileged \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  rancher/rancher:latest</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>As of Rancher v2.5, privileged access is <a href="https://rancher.com/docs/rancher/v2.6/en/installation/other-installation-methods/single-node-docker/#privileged-access-for-rancher-v2-5" target="_blank" rel="noopener noreferrer">required.</a></p><p>This layer 7 NGINX configuration is tested on NGINX version 1.13 (mainline) and 1.14 (stable).</p><p>&gt; <strong>Note:</strong> This NGINX configuration is only an example and may not suit your environment. For complete documentation, see <a href="https://docs.nginx.com/nginx/admin-guide/load-balancer/tcp-udp-load-balancer/" target="_blank" rel="noopener noreferrer">NGINX Load Balancing - TCP and UDP Load Balancer</a>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">upstream rancher {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    server rancher-server:80;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">map $http_upgrade $connection_upgrade {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    default Upgrade;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;&#x27;      close;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">server {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen 443 ssl http2;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name rancher.yourdomain.com;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_certificate /etc/your_certificate_directory/fullchain.pem;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ssl_certificate_key /etc/your_certificate_directory/privkey.pem;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    location / {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header Host $host;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header X-Forwarded-Proto $scheme;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header X-Forwarded-Port $server_port;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_pass http://rancher;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_http_version 1.1;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header Upgrade $http_upgrade;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_set_header Connection $connection_upgrade;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        # This allows the ability for the execute shell window to remain open for up to 15 minutes. Without this parameter, the default is 1 minute and will automatically close.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_read_timeout 900s;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        proxy_buffering off;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">server {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen 80;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    server_name rancher.yourdomain.com;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return 301 https://$server_name$request_uri;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/main/website/docs/installation/resources/advanced/single-node-install-external-lb.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/rancher-docusaurus/installation/resources/advanced/index"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Advanced</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/rancher-docusaurus/installation/resources/bootstrap-password"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Bootstrap Password Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#requirements-for-os-docker-hardware-and-networking" class="table-of-contents__link">Requirements for OS, Docker, Hardware, and Networking</a></li><li><a href="#installation-outline" class="table-of-contents__link">Installation Outline</a></li><li><a href="#1-provision-linux-host" class="table-of-contents__link">1. Provision Linux Host</a></li><li><a href="#2-choose-an-ssl-option-and-install-rancher" class="table-of-contents__link">2. Choose an SSL Option and Install Rancher</a></li><li><a href="#3-configure-load-balancer" class="table-of-contents__link">3. Configure Load Balancer</a><ul><li><a href="#example-nginx-configuration" class="table-of-contents__link">Example NGINX configuration</a></li></ul></li><li><a href="#whats-next" class="table-of-contents__link">What&#39;s Next?</a></li><li><a href="#faq-and-troubleshooting" class="table-of-contents__link">FAQ and Troubleshooting</a></li><li><a href="#advanced-options" class="table-of-contents__link">Advanced Options</a><ul><li><a href="#api-auditing" class="table-of-contents__link">API Auditing</a></li><li><a href="#air-gap" class="table-of-contents__link">Air Gap</a></li><li><a href="#persistent-data" class="table-of-contents__link">Persistent Data</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://forums.rancher.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Forums<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://slack.rancher.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/Rancher_Labs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://rancher.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Rancher Website</a></li><li class="footer__item"><a href="https://github.com/rancher/rancher" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Rancher on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/rancher/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Rancher Docs on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/rancher-docusaurus/assets/js/runtime~main.9668cced.js"></script>
<script src="/rancher-docusaurus/assets/js/main.7243044c.js"></script>
</body>
</html>