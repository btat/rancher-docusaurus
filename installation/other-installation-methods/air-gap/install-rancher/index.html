<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<title data-react-helmet="true">4. Install Rancher | My Site</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://btat.github.io/rancher-docusaurus/installation/other-installation-methods/air-gap/install-rancher/index"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="4. Install Rancher | My Site"><meta data-react-helmet="true" name="description" content="This section is about how to deploy Rancher for your air gapped environment in a high-availability Kubernetes installation. An air gapped environment could be where Rancher server will be installed offline, behind a firewall, or behind a proxy."><meta data-react-helmet="true" property="og:description" content="This section is about how to deploy Rancher for your air gapped environment in a high-availability Kubernetes installation. An air gapped environment could be where Rancher server will be installed offline, behind a firewall, or behind a proxy."><link data-react-helmet="true" rel="shortcut icon" href="/rancher-docusaurus/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://btat.github.io/rancher-docusaurus/installation/other-installation-methods/air-gap/install-rancher/index"><link data-react-helmet="true" rel="alternate" href="https://btat.github.io/rancher-docusaurus/installation/other-installation-methods/air-gap/install-rancher/index" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://btat.github.io/rancher-docusaurus/installation/other-installation-methods/air-gap/install-rancher/index" hreflang="x-default"><link rel="stylesheet" href="/rancher-docusaurus/assets/css/styles.6d09dbb1.css">
<link rel="preload" href="/rancher-docusaurus/assets/js/runtime~main.9668cced.js" as="script">
<link rel="preload" href="/rancher-docusaurus/assets/js/main.7243044c.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/rancher-docusaurus/"><img src="/rancher-docusaurus/img/rancher-logo.svg" alt="Rancher Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/rancher-docusaurus/img/rancher-logo.svg" alt="Rancher Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Rancher Docs</b></a><a href="https://suse-projects.github.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>More SUSE Projects<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Overview</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Rancher Deployment Quick Start Guides</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Installing/Upgrading Rancher</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/index">Intro</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">install-rancher-on-k8s</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">other-installation-methods</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">air-gap</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/other-installation-methods/air-gap/index">Air Gapped Helm CLI Install</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">install-rancher</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/other-installation-methods/air-gap/install-rancher/docker-install-commands">Docker Install Commands</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rancher-docusaurus/installation/other-installation-methods/air-gap/install-rancher/index">4. Install Rancher</a></li></ul></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/other-installation-methods/air-gap/launch-kubernetes">3. Install Kubernetes (Skip for Docker Installs)</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/other-installation-methods/air-gap/populate-private-registry">2. Collect and Publish Images to your Private Registry</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/other-installation-methods/air-gap/prepare-nodes">1. Set up Infrastructure and Private Registry</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">behind-proxy</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/installation/other-installation-methods/index">Other Installation Methods</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">single-node-docker</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">requirements</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">resources</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Best Practices Guide</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Backups and Disaster Recovery</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Authentication, Permissions and Global Configuration</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Setting up Kubernetes Clusters in Rancher</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Cluster Administration</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Project Administration</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pipelines</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Deploying Applications across Clusters</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Monitoring and Alerting</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Istio</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Logging</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">CIS Scans</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Kubernetes Resources</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Security</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">User Settings</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">API</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">FAQ</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Troubleshooting</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/cli">Using the Rancher Command Line Interface</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/contributing">Contributing to Rancher</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/helm-charts">Helm Charts in Rancher</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/">Rancher 2.6</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/longhorn">Longhorn - Cloud native distributed block storage for Kubernetes</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/opa-gatekeper">OPA Gatekeeper</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/system-tools">System Tools</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>4. Install Rancher</h1></header><p>This section is about how to deploy Rancher for your air gapped environment in a high-availability Kubernetes installation. An air gapped environment could be where Rancher server will be installed offline, behind a firewall, or behind a proxy.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="privileged-access-for-rancher"></a>Privileged Access for Rancher<a class="hash-link" href="#privileged-access-for-rancher" title="Direct link to heading">#</a></h3><p>When the Rancher server is deployed in the Docker container, a local Kubernetes cluster is installed within the container for Rancher to use. Because many features of Rancher run as deployments, and privileged mode is required to run containers within containers, you will need to install Rancher with the <code>--privileged</code> option.</p><header><h1>Docker Instructions</h1></header><p>If you want to continue the air gapped installation using Docker commands, skip the rest of this page and follow the instructions on <a href="/rancher-docusaurus/installation/other-installation-methods/air-gap/install-rancher/docker-install-commands">this page.</a></p><header><h1>Kubernetes Instructions</h1></header><p>Rancher recommends installing Rancher on a Kubernetes cluster. A highly available Kubernetes install is comprised of three nodes running the Rancher server components on a Kubernetes cluster. The persistence layer (etcd) is also replicated on these three nodes, providing redundancy and data duplication in case one of the nodes fails.</p><p>This section describes installing Rancher:</p><ul><li><a href="#1-add-the-helm-chart-repository">1. Add the Helm Chart Repository</a></li><li><a href="#2-choose-your-ssl-configuration">2. Choose your SSL Configuration</a></li><li><a href="#3-render-the-rancher-helm-template">3. Render the Rancher Helm Template</a></li><li><a href="#4-install-rancher">4. Install Rancher</a></li></ul><header><h1>1. Add the Helm Chart Repository</h1></header><p>From a system that has access to the internet, fetch the latest Helm chart and copy the resulting manifests to a system that has access to the Rancher server cluster.</p><ol><li><p>If you haven&#x27;t already, install <code>helm</code> locally on a workstation that has internet access. Note: Refer to the <a href="https://rancher.com/docs/rancher/v2.6/en/installation/resources/helm-version" target="_blank" rel="noopener noreferrer">Helm version requirements</a> to choose a version of Helm to install Rancher.</p></li><li><p>Use <code>helm repo add</code> command to add the Helm chart repository that contains charts to install Rancher. For more information about the repository choices and which is best for your use case, see <a href="https://rancher.com/docs/rancher/v2.6/en/installation/install-rancher-on-k8s/chart-options/#helm-chart-repositories" target="_blank" rel="noopener noreferrer">Choosing a Version of Rancher</a>.
{{ release-channel }}</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo add rancher-\&lt;CHART_REPO\&gt; https://releases.rancher.com/server-charts/\&lt;CHART_REPO\&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Fetch the latest Rancher chart. This will pull down the chart and save it in the current directory as a <code>.tgz</code> file.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">helm fetch rancher-\&lt;CHART_REPO\&gt;/rancher</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If you require a specific version of Rancher, you can fetch this with the Helm <code>--version</code> parameter like in the following example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">helm fetch rancher-stable/rancher --version=v2.4.8</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ol><header><h1>2. Choose your SSL Configuration</h1></header><p>Rancher Server is designed to be secure by default and requires SSL/TLS configuration.</p><p>When Rancher is installed on an air gapped Kubernetes cluster, there are two recommended options for the source of the certificate.</p><p>&gt; <strong>Note:</strong> If you want terminate SSL/TLS externally, see <a href="https://rancher.com/docs/rancher/v2.6/en/installation/install-rancher-on-k8s/chart-options/#external-tls-termination" target="_blank" rel="noopener noreferrer">TLS termination on an External Load Balancer</a>.</p><table><thead><tr><th>Configuration</th><th>Chart option</th><th>Description</th><th>Requires cert-manager</th></tr></thead><tbody><tr><td>Rancher Generated Self-Signed Certificates</td><td><code>ingress.tls.source=rancher</code></td><td>Use certificates issued by Rancher&#x27;s generated CA (self signed) This is the <strong>default</strong> and does not need to be added when rendering the Helm template.</td><td>yes</td></tr><tr><td>Certificates from Files</td><td><code>ingress.tls.source=secret</code></td><td>Use your own certificate files by creating Kubernetes Secret(s). This option must be passed when rendering the Rancher Helm template.</td><td>no</td></tr></tbody></table><header><h1>Helm Chart Options for Air Gap Installations</h1></header><p>When setting up the Rancher Helm template, there are several options in the Helm chart that are designed specifically for air gap installations.</p><table><thead><tr><th>Chart Option</th><th>Chart Value</th><th>Description</th></tr></thead><tbody><tr><td><code>certmanager.version</code></td><td>&quot;[version]&quot;</td><td>Configure proper Rancher TLS issuer depending of running cert-manager version.</td></tr><tr><td><code>systemDefaultRegistry</code></td><td><code>[REGISTRY.YOURDOMAIN.COM:PORT]</code></td><td>Configure Rancher server to always pull from your private registry when provisioning clusters.</td></tr><tr><td><code>useBundledSystemChart</code></td><td><code>true</code></td><td>Configure Rancher server to use the packaged copy of Helm system charts. The <a href="https://github.com/rancher/system-charts" target="_blank" rel="noopener noreferrer">system charts</a> repository contains all the catalog items required for features such as monitoring, logging, alerting and global DNS. These <a href="https://github.com/rancher/system-charts" target="_blank" rel="noopener noreferrer">Helm charts</a> are located in GitHub, but since you are in an air gapped environment, using the charts that are bundled within Rancher is much easier than setting up a Git mirror.</td></tr></tbody></table><header><h1>3. Render the Rancher Helm Template</h1></header><p>Based on the choice your made in <a href="#2-choose-your-ssl-configuration">2. Choose your SSL Configuration</a>, complete one of the procedures below.</p><header><h1>Option A: Default Self-Signed Certificate</h1></header><p>By default, Rancher generates a CA and uses cert-manager to issue the certificate for access to the Rancher server interface.</p><p>&gt; <strong>Note:</strong>
&gt; Recent changes to cert-manager require an upgrade. If you are upgrading Rancher and using a version of cert-manager older than v0.11.0, please see our <a href="https://rancher.com/docs/rancher/v2.6/en/installation/resources/upgrading-cert-manager/" target="_blank" rel="noopener noreferrer">upgrade cert-manager documentation</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="1-add-the-cert-manager-repo"></a>1. Add the cert-manager repo<a class="hash-link" href="#1-add-the-cert-manager-repo" title="Direct link to heading">#</a></h3><p>From a system connected to the internet, add the cert-manager repo to Helm:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo add jetstack https://charts.jetstack.io</span></span><span class="token-line" style="color:#393A34"><span class="token plain">helm repo update</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="2-fetch-the-cert-manager-chart"></a>2. Fetch the cert-manager chart<a class="hash-link" href="#2-fetch-the-cert-manager-chart" title="Direct link to heading">#</a></h3><p>Fetch the latest cert-manager chart available from the <a href="https://hub.helm.sh/charts/jetstack/cert-manager" target="_blank" rel="noopener noreferrer">Helm chart repository</a>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">helm fetch jetstack/cert-manager --version v1.5.1</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="3-render-the-cert-manager-template"></a>3. Render the cert-manager template<a class="hash-link" href="#3-render-the-cert-manager-template" title="Direct link to heading">#</a></h3><p>Render the cert-manager template with the options you would like to use to install the chart. Remember to set the <code>image.repository</code> option to pull the image from your private registry. This will create a <code>cert-manager</code> directory with the Kubernetes manifest files.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">helm template cert-manager ./cert-manager-v1.5.1.tgz --output-dir . \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --namespace cert-manager \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --set image.repository=[REGISTRY.YOURDOMAIN.COM:PORT]/quay.io/jetstack/cert-manager-controller \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --set webhook.image.repository=[REGISTRY.YOURDOMAIN.COM:PORT]/quay.io/jetstack/cert-manager-webhook \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --set cainjector.image.repository=[REGISTRY.YOURDOMAIN.COM:PORT]/quay.io/jetstack/cert-manager-cainjector</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="4-download-the-cert-manager-crd"></a>4. Download the cert-manager CRD<a class="hash-link" href="#4-download-the-cert-manager-crd" title="Direct link to heading">#</a></h3><p>Download the required CRD file for cert-manager:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">curl -L -o cert-manager/cert-manager-crd.yaml https://github.com/jetstack/cert-manager/releases/download/v1.5.1/cert-manager.crds.yaml</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="5-render-the-rancher-template"></a>5. Render the Rancher template<a class="hash-link" href="#5-render-the-rancher-template" title="Direct link to heading">#</a></h3><p>Render the Rancher template, declaring your chosen options. Use the reference table below to replace each placeholder. Rancher needs to be configured to use the private registry in order to provision any Rancher launched Kubernetes clusters or Rancher tools.</p><table><thead><tr><th>Placeholder</th><th>Description</th></tr></thead><tbody><tr><td><code>[VERSION]</code></td><td>The version number of the output tarball.</td></tr><tr><td><code>[RANCHER.YOURDOMAIN.COM]</code></td><td>The DNS name you pointed at your load balancer.</td></tr><tr><td><code>[REGISTRY.YOURDOMAIN.COM:PORT]</code></td><td>The DNS name for your private registry.</td></tr><tr><td><code>[CERTMANAGER_VERSION]</code></td><td>Cert-manager version running on k8s cluster.</td></tr></tbody></table><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">helm template rancher ./rancher-[VERSION].tgz --output-dir . \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --no-hooks \ # prevent files for Helm hooks from being generated</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --namespace cattle-system \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --set hostname=[RANCHER.YOURDOMAIN.COM] \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --set certmanager.version=[CERTMANAGER_VERSION] \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --set rancherImage=[REGISTRY.YOURDOMAIN.COM:PORT]/rancher/rancher \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --set systemDefaultRegistry=[REGISTRY.YOURDOMAIN.COM:PORT] \ # Set a default private registry to be used in Rancher</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --set useBundledSystemChart=true # Use the packaged Rancher system charts</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>Optional</strong>: To install a specific Rancher version, set the <code>rancherImageTag</code> value, example: <code>--set rancherImageTag=v2.5.8</code></p><header><h1>Option B: Certificates From Files using Kubernetes Secrets</h1></header><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="1-create-secrets"></a>1. Create secrets<a class="hash-link" href="#1-create-secrets" title="Direct link to heading">#</a></h3><p>Create Kubernetes secrets from your own certificates for Rancher to use. The common name for the cert will need to match the <code>hostname</code> option in the command below, or the ingress controller will fail to provision the site for Rancher.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="2-render-the-rancher-template"></a>2. Render the Rancher template<a class="hash-link" href="#2-render-the-rancher-template" title="Direct link to heading">#</a></h3><p>Render the Rancher template, declaring your chosen options. Use the reference table below to replace each placeholder. Rancher needs to be configured to use the private registry in order to provision any Rancher launched Kubernetes clusters or Rancher tools.</p><table><thead><tr><th>Placeholder</th><th>Description</th></tr></thead><tbody><tr><td><code>[VERSION]</code></td><td>The version number of the output tarball.</td></tr><tr><td><code>[RANCHER.YOURDOMAIN.COM]</code></td><td>The DNS name you pointed at your load balancer.</td></tr><tr><td><code>[REGISTRY.YOURDOMAIN.COM:PORT]</code></td><td>The DNS name for your private registry.</td></tr></tbody></table><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">   helm template rancher ./rancher-[VERSION].tgz --output-dir . \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --no-hooks \ # prevent files for Helm hooks from being generated</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --namespace cattle-system \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --set hostname=[RANCHER.YOURDOMAIN.COM] \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --set rancherImage=[REGISTRY.YOURDOMAIN.COM:PORT]/rancher/rancher \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --set ingress.tls.source=secret \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --set systemDefaultRegistry=[REGISTRY.YOURDOMAIN.COM:PORT] \ # Set a default private registry to be used in Rancher</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --set useBundledSystemChart=true # Use the packaged Rancher system charts</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If you are using a Private CA signed cert, add <code>--set privateCA=true</code> following <code>--set ingress.tls.source=secret</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">   helm template rancher ./rancher-[VERSION].tgz --output-dir . \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --no-hooks \ # prevent files for Helm hooks from being generated</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --namespace cattle-system \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --set hostname=[RANCHER.YOURDOMAIN.COM] \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --set rancherImage=[REGISTRY.YOURDOMAIN.COM:PORT]/rancher/rancher \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --set ingress.tls.source=secret \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --set privateCA=true \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --set systemDefaultRegistry=[REGISTRY.YOURDOMAIN.COM:PORT] \ # Set a default private registry to be used in Rancher</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    --set useBundledSystemChart=true # Use the packaged Rancher system charts</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>Optional</strong>: To install a specific Rancher version, set the <code>rancherImageTag</code> value, example: <code>--set rancherImageTag=v2.3.6</code></p><p>Then refer to <a href="https://rancher.com/docs/rancher/v2.6/en/installation/resources/tls-secrets/" target="_blank" rel="noopener noreferrer">Adding TLS Secrets</a> to publish the certificate files so Rancher and the ingress controller can use them.</p><header><h1>4. Install Rancher</h1></header><p>Copy the rendered manifest directories to a system that has access to the Rancher server cluster to complete installation.</p><p>Use <code>kubectl</code> to create namespaces and apply the rendered manifests.</p><p>If you choose to use self-signed certificates in <a href="#b-choose-your-ssl-configuration">B. Choose your SSL Configuration</a>, install cert-manager.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="for-self-signed-certificate-installs-install-cert-manager"></a>For Self-Signed Certificate Installs, Install Cert-manager<a class="hash-link" href="#for-self-signed-certificate-installs-install-cert-manager" title="Direct link to heading">#</a></h3><p>{{% accordion id=&quot;install-cert-manager&quot; label=&quot;Click to expand&quot; %}}</p><p>If you are using self-signed certificates, install cert-manager:</p><ol><li>Create the namespace for cert-manager.</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create namespace cert-manager</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol><li>Create the cert-manager CustomResourceDefinitions (CRDs).</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f cert-manager/cert-manager-crd.yaml</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">\&gt; **Note:**</span></span><span class="token-line" style="color:#393A34"><span class="token plain">\&gt; If you are running Kubernetes v1.15 or below, you will need to add the `--validate=false` flag to your `kubectl apply` command above, or else you will receive a validation error relating to the `x-kubernetes-preserve-unknown-fields` field in cert-managerâ€™s CustomResourceDefinition resources. This is a benign error and occurs due to the way kubectl performs resource validation.</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol><li>Launch cert-manager.</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -R -f ./cert-manager</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>{{% /accordion %}}</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="install-rancher-with-kubectl"></a>Install Rancher with kubectl<a class="hash-link" href="#install-rancher-with-kubectl" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create namespace cattle-system</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl -n cattle-system apply -R -f ./rancher</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The installation is complete.</p><p>&gt; <strong>Note:</strong> If you don&#x27;t intend to send telemetry data, opt out <a href="https://rancher.com/docs/rancher/v2.6/en/faq/telemetry/" target="_blank" rel="noopener noreferrer">telemetry</a> during the initial login. Leaving this active in an air-gapped environment can cause issues if the sockets cannot be opened successfully.</p><header><h1>Additional Resources</h1></header><p>These resources could be helpful when installing Rancher:</p><ul><li><a href="https://rancher.com/docs/rancher/v2.6/en/installation/resources/chart-options/" target="_blank" rel="noopener noreferrer">Rancher Helm chart options</a></li><li><a href="https://rancher.com/docs/rancher/v2.6/en/installation/resources/tls-secrets/" target="_blank" rel="noopener noreferrer">Adding TLS secrets</a></li><li><a href="https://rancher.com/docs/rancher/v2.6/en/installation/resources/troubleshooting/" target="_blank" rel="noopener noreferrer">Troubleshooting Rancher Kubernetes Installations</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/main/website/docs/installation/other-installation-methods/air-gap/install-rancher/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/rancher-docusaurus/installation/other-installation-methods/air-gap/install-rancher/docker-install-commands"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Docker Install Commands</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/rancher-docusaurus/installation/other-installation-methods/air-gap/launch-kubernetes"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">3. Install Kubernetes (Skip for Docker Installs) Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#privileged-access-for-rancher" class="table-of-contents__link">Privileged Access for Rancher</a></li><li><a href="#1-add-the-cert-manager-repo" class="table-of-contents__link">1. Add the cert-manager repo</a></li><li><a href="#2-fetch-the-cert-manager-chart" class="table-of-contents__link">2. Fetch the cert-manager chart</a></li><li><a href="#3-render-the-cert-manager-template" class="table-of-contents__link">3. Render the cert-manager template</a></li><li><a href="#4-download-the-cert-manager-crd" class="table-of-contents__link">4. Download the cert-manager CRD</a></li><li><a href="#5-render-the-rancher-template" class="table-of-contents__link">5. Render the Rancher template</a></li><li><a href="#1-create-secrets" class="table-of-contents__link">1. Create secrets</a></li><li><a href="#2-render-the-rancher-template" class="table-of-contents__link">2. Render the Rancher template</a></li><li><a href="#for-self-signed-certificate-installs-install-cert-manager" class="table-of-contents__link">For Self-Signed Certificate Installs, Install Cert-manager</a></li><li><a href="#install-rancher-with-kubectl" class="table-of-contents__link">Install Rancher with kubectl</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://forums.rancher.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Forums<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://slack.rancher.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/Rancher_Labs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://rancher.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Rancher Website</a></li><li class="footer__item"><a href="https://github.com/rancher/rancher" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Rancher on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/rancher/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Rancher Docs on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/rancher-docusaurus/assets/js/runtime~main.9668cced.js"></script>
<script src="/rancher-docusaurus/assets/js/main.7243044c.js"></script>
</body>
</html>