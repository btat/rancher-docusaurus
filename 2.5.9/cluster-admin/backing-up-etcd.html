<!doctype html>
<html class="docs-version-2.5.9" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<title data-react-helmet="true">Backing up a Cluster | My Site</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://btat.github.io/rancher-docusaurus/2.5.9/cluster-admin/backing-up-etcd"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="2.5.9"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-2.5.9"><meta data-react-helmet="true" property="og:title" content="Backing up a Cluster | My Site"><meta data-react-helmet="true" name="description" content="In the Rancher UI, etcd backup and recovery for Rancher launched Kubernetes clusters can be easily performed."><meta data-react-helmet="true" property="og:description" content="In the Rancher UI, etcd backup and recovery for Rancher launched Kubernetes clusters can be easily performed."><link data-react-helmet="true" rel="shortcut icon" href="/rancher-docusaurus/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://btat.github.io/rancher-docusaurus/2.5.9/cluster-admin/backing-up-etcd"><link data-react-helmet="true" rel="alternate" href="https://btat.github.io/rancher-docusaurus/2.5.9/cluster-admin/backing-up-etcd" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://btat.github.io/rancher-docusaurus/2.5.9/cluster-admin/backing-up-etcd" hreflang="x-default"><link rel="stylesheet" href="/rancher-docusaurus/assets/css/styles.6d09dbb1.css">
<link rel="preload" href="/rancher-docusaurus/assets/js/runtime~main.e49194ca.js" as="script">
<link rel="preload" href="/rancher-docusaurus/assets/js/main.ed945e9c.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/rancher-docusaurus/"><img src="/rancher-docusaurus/img/rancher-logo.svg" alt="Rancher Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/rancher-docusaurus/img/rancher-logo.svg" alt="Rancher Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Rancher Docs</b></a><a href="https://suse-projects.github.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>More SUSE Projects<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Overview</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Rancher Deployment Quick Start Guides</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Installing/Upgrading Rancher</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Best Practices Guide</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Backups and Disaster Recovery</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Authentication, Permissions and Global Configuration</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Setting up Kubernetes Clusters in Rancher</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Cluster Administration</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rancher-docusaurus/2.5.9/cluster-admin/backing-up-etcd">Backing up a Cluster</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/2.5.9/cluster-admin/certificate-rotation">Certificate Rotation</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/2.5.9/cluster-admin/cleaning-cluster-nodes">Removing Kubernetes Components from Nodes</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/2.5.9/cluster-admin/cloning-clusters">Cloning Clusters</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">cluster-access</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">cluster-autoscaler</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">editing-clusters</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/2.5.9/cluster-admin/index">Intro</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/2.5.9/cluster-admin/nodes">Nodes and Node Pools</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/2.5.9/cluster-admin/pod-security-policies">Assigning Pod Security Policies</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/2.5.9/cluster-admin/pod-security-policy">Adding a Pod Security Policy</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/2.5.9/cluster-admin/projects-and-namespaces">Projects and Kubernetes Namespaces with Rancher</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/2.5.9/cluster-admin/restoring-etcd">Restoring a Cluster from Backup</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/2.5.9/cluster-admin/tools">Tools for Logging, Monitoring, and Visibility</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/2.5.9/cluster-admin/upgrading-kubernetes">Upgrading and Rolling Back Kubernetes</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">volumes-and-storage</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Project Administration</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pipelines</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Deploying Applications across Clusters</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Monitoring and Alerting</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Istio</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Logging</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">CIS Scans</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Kubernetes Resources</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Security</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">User Settings</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">API</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">FAQ</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Troubleshooting</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/2.5.9/cli">Using the Rancher Command Line Interface</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/2.5.9/contributing">Contributing to Rancher</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/2.5.9/helm-charts">Helm Charts in Rancher</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/2.5.9">Rancher 2.6</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/2.5.9/longhorn">Longhorn - Cloud native distributed block storage for Kubernetes</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/2.5.9/opa-gatekeper">OPA Gatekeeper</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/2.5.9/system-tools">System Tools</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for My Site <b>2.5.9</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/rancher-docusaurus/cluster-admin/backing-up-etcd">latest version</a></b> (2.4.15).</div></div><div class="docItemContainer_33ec"><article><span class="theme-doc-version-badge badge badge--secondary">Version: 2.5.9</span><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Backing up a Cluster</h1></header><p>In the Rancher UI, etcd backup and recovery for <a href="https://rancher.com/docs/rancher/v2.6/en/cluster-provisioning/rke-clusters/" target="_blank" rel="noopener noreferrer">Rancher launched Kubernetes clusters</a> can be easily performed.</p><p>Rancher recommends configuring recurrent <code>etcd</code> snapshots for all production clusters. Additionally, one-time snapshots can easily be taken as well.</p><p>Snapshots of the etcd database are taken and saved either <a href="#local-backup-target">locally onto the etcd nodes</a> or to a <a href="#s3-backup-target">S3 compatible target</a>. The advantages of configuring S3 is that if all etcd nodes are lost, your snapshot is saved remotely and can be used to restore the cluster.</p><header><h1>How Snapshots Work</h1></header><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="snapshot-components"></a>Snapshot Components<a class="hash-link" href="#snapshot-components" title="Direct link to heading">#</a></h3><p>When Rancher creates a snapshot, it includes three components: </p><ul><li>The cluster data in etcd</li><li>The Kubernetes version</li><li>The cluster configuration in the form of the <code>cluster.yml</code></li></ul><p>Because the Kubernetes version is now included in the snapshot, it is possible to restore a cluster to a prior Kubernetes version.</p><p>The multiple components of the snapshot allow you to select from the following options if you need to restore a cluster from a snapshot:</p><ul><li><strong>Restore just the etcd contents:</strong> This restore is similar to restoring to snapshots in Rancher before v2.4.0.</li><li><strong>Restore etcd and Kubernetes version:</strong> This option should be used if a Kubernetes upgrade is the reason that your cluster is failing, and you haven&#x27;t made any cluster configuration changes.</li><li><strong>Restore etcd, Kubernetes versions and cluster configuration:</strong> This option should be used if you changed both the Kubernetes version and cluster configuration when upgrading.</li></ul><p>It&#x27;s always recommended to take a new snapshot before any upgrades.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="generating-the-snapshot-from-etcd-nodes"></a>Generating the Snapshot from etcd Nodes<a class="hash-link" href="#generating-the-snapshot-from-etcd-nodes" title="Direct link to heading">#</a></h3><p>For each etcd node in the cluster, the etcd cluster health is checked. If the node reports that the etcd cluster is healthy, a snapshot is created from it and optionally uploaded to S3.</p><p>The snapshot is stored in <code>/opt/rke/etcd-snapshots</code>. If the directory is configured on the nodes as a shared mount, it will be overwritten. On S3, the snapshot will always be from the last node that uploads it, as all etcd nodes upload it and the last will remain.</p><p>In the case when multiple etcd nodes exist, any created snapshot is created after the cluster has been health checked, so it can be considered a valid snapshot of the data in the etcd cluster.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="snapshot-naming-conventions"></a>Snapshot Naming Conventions<a class="hash-link" href="#snapshot-naming-conventions" title="Direct link to heading">#</a></h3><p>The name of the snapshot is auto-generated. The <code>--name</code> option can be used to override the name of the snapshot when creating one-time snapshots with the RKE CLI.</p><p>When Rancher creates a snapshot of an RKE cluster, the snapshot name is based on the type (whether the snapshot  is manual or recurring) and the target (whether the snapshot is saved locally or uploaded to S3). The naming convention is as follows:</p><ul><li><code>m</code> stands for manual</li><li><code>r</code> stands for recurring</li><li><code>l</code> stands for local</li><li><code>s</code> stands for S3</li></ul><p>Some example snapshot names are:</p><ul><li>c-9dmxz-rl-8b2cx</li><li>c-9dmxz-ml-kr56m</li><li>c-9dmxz-ms-t6bjb</li><li>c-9dmxz-rs-8gxc8</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="how-restoring-from-a-snapshot-works"></a>How Restoring from a Snapshot Works<a class="hash-link" href="#how-restoring-from-a-snapshot-works" title="Direct link to heading">#</a></h3><p>On restore, the following process is used:</p><ol><li>The snapshot is retrieved from S3, if S3 is configured.</li><li>The snapshot is unzipped (if zipped).</li><li>One of the etcd nodes in the cluster serves that snapshot file to the other nodes.</li><li>The other etcd nodes download the snapshot and validate the checksum so that they all use the same snapshot for the restore.</li><li>The cluster is restored and post-restore actions will be done in the cluster.</li></ol><header><h1>Configuring Recurring Snapshots</h1></header><p>Select how often you want recurring snapshots to be taken as well as how many snapshots to keep. The amount of time is measured in hours. With timestamped snapshots, the user has the ability to do a point-in-time recovery.</p><p>By default, <a href="https://rancher.com/docs/rancher/v2.6/en/cluster-provisioning/rke-clusters/" target="_blank" rel="noopener noreferrer">Rancher launched Kubernetes clusters</a> are configured to take recurring snapshots (saved to local disk). To protect against local disk failure, using the <a href="#s3-backup-target">S3 Target</a> or replicating the path on disk is advised.</p><p>During cluster provisioning or editing the cluster, the configuration for snapshots can be found in the advanced section for <strong>Cluster Options</strong>. Click on <strong>Show advanced options</strong>.</p><p>In the <strong>Advanced Cluster Options</strong> section, there are several options available to configure:</p><table><thead><tr><th>Option</th><th>Description</th><th>Default Value</th></tr></thead><tbody><tr><td>etcd Snapshot Backup Target</td><td>Select where you want the snapshots to be saved. Options are either local or in S3</td><td>local</td></tr><tr><td>Recurring etcd Snapshot Enabled</td><td>Enable/Disable recurring snapshots</td><td>Yes</td></tr><tr><td>Recurring etcd Snapshot Creation Period</td><td>Time in hours between recurring snapshots</td><td>12 hours</td></tr><tr><td>Recurring etcd Snapshot Retention Count</td><td>Number of snapshots to retain</td><td>6</td></tr></tbody></table><header><h1>One-Time Snapshots</h1></header><p>In addition to recurring snapshots, you may want to take a &quot;one-time&quot; snapshot. For example, before upgrading the Kubernetes version of a cluster it&#x27;s best to backup the state of the cluster to protect against upgrade failure.</p><ol><li>In the upper left corner, click <strong>â˜° &gt; Cluster Management</strong>.</li><li>On the <strong>Clusters</strong> page, navigate to the cluster where you want to take a one-time snapshot.</li><li>Click <strong>â‹® &gt; Take Snapshot</strong>.</li></ol><p><strong>Result:</strong> Based on your <a href="#snapshot-backup-targets">snapshot backup target</a>, a one-time snapshot will be taken and saved in the selected backup target.</p><header><h1>Snapshot Backup Targets</h1></header><p>Rancher supports two different backup targets:</p><ul><li><a href="#local-backup-target">Local Target</a></li><li><a href="#s3-backup-target">S3 Target</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="local-backup-target"></a>Local Backup Target<a class="hash-link" href="#local-backup-target" title="Direct link to heading">#</a></h3><p>By default, the <code>local</code> backup target is selected. The benefits of this option is that there is no external configuration. Snapshots are automatically saved locally to the etcd nodes in the <a href="https://rancher.com/docs/rancher/v2.6/en/cluster-provisioning/rke-clusters/" target="_blank" rel="noopener noreferrer">Rancher launched Kubernetes clusters</a> in <code>/opt/rke/etcd-snapshots</code>. All recurring snapshots are taken at configured intervals. The downside of using the <code>local</code> backup target is that if there is a total disaster and <em>all</em> etcd nodes are lost, there is no ability to restore the cluster.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="s3-backup-target"></a>S3 Backup Target<a class="hash-link" href="#s3-backup-target" title="Direct link to heading">#</a></h3><p>The <code>S3</code> backup target allows users to configure a S3 compatible backend to store the snapshots. The primary benefit of this option is that if the cluster loses all the etcd nodes, the cluster can still be restored as the snapshots are stored externally. Rancher recommends external targets like <code>S3</code> backup, however its configuration requirements do require additional effort that should be considered.</p><table><thead><tr><th>Option</th><th>Description</th><th>Required</th></tr></thead><tbody><tr><td>S3 Bucket Name</td><td>S3 bucket name where backups will be stored</td><td>*</td></tr><tr><td>S3 Region</td><td>S3 region for the backup bucket</td><td></td></tr><tr><td>S3 Region Endpoint</td><td>S3 regions endpoint for the backup bucket</td><td>*</td></tr><tr><td>S3 Access Key</td><td>S3 access key with permission to access the backup bucket</td><td>*</td></tr><tr><td>S3 Secret Key</td><td>S3 secret key with permission to access the backup bucket</td><td>*</td></tr><tr><td>Custom CA Certificate</td><td>A custom certificate used to access private S3 backends</td><td></td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="using-a-custom-ca-certificate-for-s3"></a>Using a custom CA certificate for S3<a class="hash-link" href="#using-a-custom-ca-certificate-for-s3" title="Direct link to heading">#</a></h3><p>The backup snapshot can be stored on a custom <code>S3</code> backup like <a href="https://min.io/" target="_blank" rel="noopener noreferrer">minio</a>. If the S3 back end uses a self-signed or custom certificate, provide a custom certificate using the <code>Custom CA Certificate</code> option to connect to the S3 backend.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="iam-support-for-storing-snapshots-in-s3"></a>IAM Support for Storing Snapshots in S3<a class="hash-link" href="#iam-support-for-storing-snapshots-in-s3" title="Direct link to heading">#</a></h3><p>The <code>S3</code> backup target supports using IAM authentication to AWS API in addition to using API credentials. An IAM role gives temporary permissions that an application can use when making API calls to S3 storage. To use IAM authentication, the following requirements must be met:</p><ul><li><p>The cluster etcd nodes must have an instance role that has read/write access to the designated backup bucket.</p></li><li><p>The cluster etcd nodes must have network access to the specified S3 endpoint.</p></li><li><p>The Rancher Server worker node(s) must have an instance role that has read/write to the designated backup bucket.</p></li><li><p>The Rancher Server worker node(s) must have network access to the specified S3 endpoint.</p><p>To give an application access to S3, refer to the AWS documentation on <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles_use_switch-role-ec2.html" target="_blank" rel="noopener noreferrer">Using an IAM Role to Grant Permissions to Applications Running on Amazon EC2 Instances.</a></p></li></ul><header><h1>Viewing Available Snapshots</h1></header><p>The list of all available snapshots for the cluster is available in the Rancher UI.</p><ol><li>In the upper left corner, click <strong>â˜° &gt; Cluster Management</strong>.</li><li>In the <strong>Clusters</strong> page, go to the cluster where you want to view the snapshots and click its name.</li><li>Click the <strong>Snapshots</strong> tab to view the list of saved snapshots. These snapshots include a timestamp of when they were created.</li></ol><header><h1>Safe Timestamps</h1></header><p>Snapshot files are timestamped to simplify processing the files using external tools and scripts, but in some S3 compatible backends, these timestamps were unusable. </p><p>The option <code>safe_timestamp</code> is added to support compatible file names. When this flag is set to <code>true</code>, all special characters in the snapshot filename timestamp are replaced.</p><p>This option is not available directly in the UI, and is only available through the <code>Edit as Yaml</code> interface.</p><header><h1>Enabling Snapshot Features for Clusters Created Before Rancher v2.2.0</h1></header><p>If you have any Rancher launched Kubernetes clusters that were created before v2.2.0, after upgrading Rancher, you must <a href="https://rancher.com/docs/rancher/v2.6/en/cluster-admin/editing-clusters/" target="_blank" rel="noopener noreferrer">edit the cluster</a> and <em>save</em> it, in order to enable the updated snapshot features. Even if you were already creating snapshots before v2.2.0, you must do this step as the older snapshots will not be available to use to <a href="https://rancher.com/docs/rancher/v2.6/en/cluster-admin/restoring-etcd/" target="_blank" rel="noopener noreferrer">back up and restore etcd through the UI</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/main/website/versioned_docs/version-2.5.9/cluster-admin/backing-up-etcd.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/rancher-docusaurus/2.5.9/cluster-provisioning/rke-clusters/windows-clusters/windows-parity"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Windows and Linux Cluster Feature Parity</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/rancher-docusaurus/2.5.9/cluster-admin/certificate-rotation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Certificate Rotation Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#snapshot-components" class="table-of-contents__link">Snapshot Components</a></li><li><a href="#generating-the-snapshot-from-etcd-nodes" class="table-of-contents__link">Generating the Snapshot from etcd Nodes</a></li><li><a href="#snapshot-naming-conventions" class="table-of-contents__link">Snapshot Naming Conventions</a></li><li><a href="#how-restoring-from-a-snapshot-works" class="table-of-contents__link">How Restoring from a Snapshot Works</a></li><li><a href="#local-backup-target" class="table-of-contents__link">Local Backup Target</a></li><li><a href="#s3-backup-target" class="table-of-contents__link">S3 Backup Target</a></li><li><a href="#using-a-custom-ca-certificate-for-s3" class="table-of-contents__link">Using a custom CA certificate for S3</a></li><li><a href="#iam-support-for-storing-snapshots-in-s3" class="table-of-contents__link">IAM Support for Storing Snapshots in S3</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://forums.rancher.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Forums<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://slack.rancher.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/Rancher_Labs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://rancher.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Rancher Website</a></li><li class="footer__item"><a href="https://github.com/rancher/rancher" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Rancher on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/rancher/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Rancher Docs on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/rancher-docusaurus/assets/js/runtime~main.e49194ca.js"></script>
<script src="/rancher-docusaurus/assets/js/main.ed945e9c.js"></script>
</body>
</html>