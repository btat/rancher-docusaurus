<!doctype html>
<html class="docs-version-2.5.9" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<title data-react-helmet="true">Upgrading Cert-Manager | My Site</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://btat.github.io/rancher-docusaurus/2.5.9/installation/resources/upgrading-cert-manager/index"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="2.5.9"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-2.5.9"><meta data-react-helmet="true" property="og:title" content="Upgrading Cert-Manager | My Site"><meta data-react-helmet="true" name="description" content="Rancher uses cert-manager to automatically generate and renew TLS certificates for HA deployments of Rancher. As of Fall 2019, three important changes to cert-manager are set to occur that you need to take action on if you have an HA deployment of Rancher:"><meta data-react-helmet="true" property="og:description" content="Rancher uses cert-manager to automatically generate and renew TLS certificates for HA deployments of Rancher. As of Fall 2019, three important changes to cert-manager are set to occur that you need to take action on if you have an HA deployment of Rancher:"><link data-react-helmet="true" rel="shortcut icon" href="/rancher-docusaurus/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://btat.github.io/rancher-docusaurus/2.5.9/installation/resources/upgrading-cert-manager/index"><link data-react-helmet="true" rel="alternate" href="https://btat.github.io/rancher-docusaurus/2.5.9/installation/resources/upgrading-cert-manager/index" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://btat.github.io/rancher-docusaurus/2.5.9/installation/resources/upgrading-cert-manager/index" hreflang="x-default"><link rel="stylesheet" href="/rancher-docusaurus/assets/css/styles.6d09dbb1.css">
<link rel="preload" href="/rancher-docusaurus/assets/js/runtime~main.e49194ca.js" as="script">
<link rel="preload" href="/rancher-docusaurus/assets/js/main.ed945e9c.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/rancher-docusaurus/"><img src="/rancher-docusaurus/img/rancher-logo.svg" alt="Rancher Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/rancher-docusaurus/img/rancher-logo.svg" alt="Rancher Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Rancher Docs</b></a><a href="https://suse-projects.github.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>More SUSE Projects<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Overview</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Rancher Deployment Quick Start Guides</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Installing/Upgrading Rancher</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/2.5.9/installation/index">Intro</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">install-rancher-on-k8s</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">other-installation-methods</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">requirements</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">resources</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">advanced</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/2.5.9/installation/resources/bootstrap-password">Bootstrap Password</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/2.5.9/installation/resources/chart-options">Rancher Helm Chart Options</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/2.5.9/installation/resources/choosing-version">Choosing a Rancher Version</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/2.5.9/installation/resources/custom-ca-root-certificate">About Custom CA Root Certificates</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">feature-flags</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/2.5.9/installation/resources/helm-version">Helm Version Requirements</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/2.5.9/installation/resources/index">Resources</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/2.5.9/installation/resources/installing-docker">Installing Docker</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">k8s-tutorials</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/2.5.9/installation/resources/local-system-charts">Setting up Local System Charts for Air Gapped Installations</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/2.5.9/installation/resources/tls-secrets">Adding TLS Secrets</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/2.5.9/installation/resources/tls-settings">TLS Settings</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/2.5.9/installation/resources/troubleshooting">Troubleshooting the Rancher Server Kubernetes Cluster</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/2.5.9/installation/resources/update-ca-cert">Updating a Private CA Certificate</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">upgrading-cert-manager</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/2.5.9/installation/resources/upgrading-cert-manager/helm-2-instructions">Upgrading Cert-Manager with Helm 2</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rancher-docusaurus/2.5.9/installation/resources/upgrading-cert-manager/index">Upgrading Cert-Manager</a></li></ul></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Best Practices Guide</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Backups and Disaster Recovery</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Authentication, Permissions and Global Configuration</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Setting up Kubernetes Clusters in Rancher</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Cluster Administration</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Project Administration</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pipelines</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Deploying Applications across Clusters</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Monitoring and Alerting</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Istio</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Logging</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">CIS Scans</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Kubernetes Resources</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Security</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">User Settings</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">API</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">FAQ</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Troubleshooting</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/2.5.9/cli">Using the Rancher Command Line Interface</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/2.5.9/contributing">Contributing to Rancher</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/2.5.9/helm-charts">Helm Charts in Rancher</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/2.5.9">Rancher 2.6</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/2.5.9/longhorn">Longhorn - Cloud native distributed block storage for Kubernetes</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/2.5.9/opa-gatekeper">OPA Gatekeeper</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/2.5.9/system-tools">System Tools</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for My Site <b>2.5.9</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/rancher-docusaurus/installation/resources/upgrading-cert-manager/index">latest version</a></b> (2.4.15).</div></div><div class="docItemContainer_33ec"><article><span class="theme-doc-version-badge badge badge--secondary">Version: 2.5.9</span><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Upgrading Cert-Manager</h1></header><p>Rancher uses cert-manager to automatically generate and renew TLS certificates for HA deployments of Rancher. As of Fall 2019, three important changes to cert-manager are set to occur that you need to take action on if you have an HA deployment of Rancher:</p><ol><li><a href="https://community.letsencrypt.org/t/blocking-old-cert-manager-versions/98753" target="_blank" rel="noopener noreferrer">Let&#x27;s Encrypt will be blocking cert-manager instances older than 0.8.0 starting November 1st 2019.</a></li><li><a href="https://cert-manager.io/docs/installation/upgrading/upgrading-0.7-0.8/" target="_blank" rel="noopener noreferrer">Cert-manager is deprecating and replacing the certificate.spec.acme.solvers field</a>. This change has no exact deadline.</li><li><a href="https://cert-manager.io/docs/installation/upgrading/upgrading-0.10-0.11/" target="_blank" rel="noopener noreferrer">Cert-manager is deprecating <code>v1alpha1</code> API and replacing its API group</a></li></ol><p>To address these changes, this guide will do two things:</p><ol><li>Document the procedure for upgrading cert-manager</li><li>Explain the cert-manager API changes and link to cert-manager&#x27;s official documentation for migrating your data</li></ol><p>&gt; <strong>Important:</strong>
&gt; If you are currently running the cert-manger whose version is older than v0.11, and want to upgrade both Rancher and cert-manager to a newer version, you need to reinstall both of them:</p><p>&gt; 1. Take a one-time snapshot of your Kubernetes cluster running Rancher server
&gt; 2. Uninstall Rancher, cert-manager, and the CustomResourceDefinition for cert-manager
&gt; 3. Install the newer version of Rancher and cert-manager </p><p>&gt; The reason is that when Helm upgrades Rancher, it will reject the upgrade and show error messages if the running Rancher app does not match the chart template used to install it. Because cert-manager changed its API group and we cannot modify released charts for Rancher, there will always be a mismatch on the cert-manager&#x27;s API version, therefore the upgrade will be rejected.</p><header><h1>Upgrade Cert-Manager</h1></header><p>The namespace used in these instructions depends on the namespace cert-manager is currently installed in. If it is in kube-system use that in the instructions below. You can verify by running <code>kubectl get pods --all-namespaces</code> and checking which namespace the cert-manager-* pods are listed in. Do not change the namespace cert-manager is running in or this can cause issues.</p><p>&gt; These instructions have been updated for Helm 3. If you are still using Helm 2, refer to <a href="https://rancher.com/docs/rancher/v2.6/en/installation/resources/upgrading-cert-manager/helm-2-instructions" target="_blank" rel="noopener noreferrer">these instructions.</a></p><p>In order to upgrade cert-manager, follow these instructions:</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="option-a-upgrade-cert-manager-with-internet-access"></a>Option A: Upgrade cert-manager with Internet Access<a class="hash-link" href="#option-a-upgrade-cert-manager-with-internet-access" title="Direct link to heading">#</a></h3><p>{{% accordion id=&quot;normal&quot; label=&quot;Click to expand&quot; %}}</p><ol><li><p><a href="https://cert-manager.io/docs/tutorials/backup/" target="_blank" rel="noopener noreferrer">Back up existing resources</a> as a precaution</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get -o yaml --all-namespaces \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">issuer,clusterissuer,certificates,certificaterequests \&gt; cert-manager-backup.yaml</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>&gt; <strong>Important:</strong>
&gt; If you are upgrading from a version older than 0.11.0, Update the apiVersion on all your backed up resources from <code>certmanager.k8s.io/v1alpha1</code> to <code>cert-manager.io/v1alpha2</code>. If you use any cert-manager annotations on any of your other resources, you will need to update them to reflect the new API group. For details, refer to the documentation on <a href="https://cert-manager.io/docs/installation/upgrading/upgrading-0.10-0.11/#additional-annotation-changes" target="_blank" rel="noopener noreferrer">additional annotation changes.</a></p></li><li><p><a href="https://cert-manager.io/docs/installation/uninstall/kubernetes/#uninstalling-with-helm" target="_blank" rel="noopener noreferrer">Uninstall existing deployment</a></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">helm uninstall cert-manager</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Delete the CustomResourceDefinition using the link to the version vX.Y.Z you installed</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete -f https://github.com/jetstack/cert-manager/releases/download/vX.Y.Z/cert-manager.crds.yaml</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Install the CustomResourceDefinition resources separately</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply --validate=false -f https://github.com/jetstack/cert-manager/releases/download/vX.Y.Z/cert-manager.crds.yaml</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>&gt; <strong>Note:</strong>
&gt; If you are running Kubernetes v1.15 or below, you will need to add the <code>--validate=false</code> flag to your <code>kubectl apply</code> command above. Otherwise, you will receive a validation error relating to the <code>x-kubernetes-preserve-unknown-fields</code> field in cert-managerâ€™s CustomResourceDefinition resources. This is a benign error and occurs due to the way kubectl performs resource validation.</p></li><li><p>Create the namespace for cert-manager if needed</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create namespace cert-manager</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Add the Jetstack Helm repository</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo add jetstack https://charts.jetstack.io</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Update your local Helm chart repository cache</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo update</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Install the new version of cert-manager</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">helm install \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  cert-manager jetstack/cert-manager \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  --namespace cert-manager \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  --version v0.12.0 </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p><a href="https://cert-manager.io/docs/tutorials/backup/#restoring-resources" target="_blank" rel="noopener noreferrer">Restore back up resources</a></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f cert-manager-backup.yaml</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ol><p>{{% /accordion %}}</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="option-b-upgrade-cert-manager-in-an-air-gap-environment"></a>Option B: Upgrade cert-manager in an Air Gap Environment<a class="hash-link" href="#option-b-upgrade-cert-manager-in-an-air-gap-environment" title="Direct link to heading">#</a></h3><p>{{% accordion id=&quot;airgap&quot; label=&quot;Click to expand&quot; %}}</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="prerequisites"></a>Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">#</a></h3><p>Before you can perform the upgrade, you must prepare your air gapped environment by adding the necessary container images to your private registry and downloading or rendering the required Kubernetes manifest files.</p><ol><li><p>Follow the guide to <a href="https://rancher.com/docs/rancher/v2.6/en/installation/other-installation-methods/air-gap/populate-private-registry" target="_blank" rel="noopener noreferrer">Prepare your Private Registry</a> with the images needed for the upgrade.</p></li><li><p>From a system connected to the internet, add the cert-manager repo to Helm</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo add jetstack https://charts.jetstack.io</span></span><span class="token-line" style="color:#393A34"><span class="token plain">helm repo update</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Fetch the latest cert-manager chart available from the <a href="https://hub.helm.sh/charts/jetstack/cert-manager" target="_blank" rel="noopener noreferrer">Helm chart repository</a>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">helm fetch jetstack/cert-manager --version v0.12.0</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Render the cert manager template with the options you would like to use to install the chart. Remember to set the <code>image.repository</code> option to pull the image from your private registry. This will create a <code>cert-manager</code> directory with the Kubernetes manifest files.</p><p>The Helm 3 command is as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">helm template cert-manager ./cert-manager-v0.12.0.tgz --output-dir . \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">--namespace cert-manager \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">--set image.repository=[REGISTRY.YOURDOMAIN.COM:PORT]/quay.io/jetstack/cert-manager-controller</span></span><span class="token-line" style="color:#393A34"><span class="token plain">--set webhook.image.repository=[REGISTRY.YOURDOMAIN.COM:PORT]/quay.io/jetstack/cert-manager-webhook</span></span><span class="token-line" style="color:#393A34"><span class="token plain">--set cainjector.image.repository=[REGISTRY.YOURDOMAIN.COM:PORT]/quay.io/jetstack/cert-manager-cainjector</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The Helm 2 command is as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">helm template ./cert-manager-v0.12.0.tgz --output-dir . \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">--name cert-manager --namespace cert-manager \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">--set image.repository=[REGISTRY.YOURDOMAIN.COM:PORT]/quay.io/jetstack/cert-manager-controller</span></span><span class="token-line" style="color:#393A34"><span class="token plain">--set webhook.image.repository=[REGISTRY.YOURDOMAIN.COM:PORT]/quay.io/jetstack/cert-manager-webhook</span></span><span class="token-line" style="color:#393A34"><span class="token plain">--set cainjector.image.repository=[REGISTRY.YOURDOMAIN.COM:PORT]/quay.io/jetstack/cert-manager-cainjector</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Download the required CRD file for cert-manager (old and new)</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">curl -L -o cert-manager/cert-manager-crd.yaml https://raw.githubusercontent.com/jetstack/cert-manager/release-0.12/deploy/manifests/00-crds.yaml</span></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -L -o cert-manager/cert-manager-crd-old.yaml https://raw.githubusercontent.com/jetstack/cert-manager/release-X.Y/deploy/manifests/00-crds.yaml</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="install-cert-manager"></a>Install cert-manager<a class="hash-link" href="#install-cert-manager" title="Direct link to heading">#</a></h3><ol><li><p>Back up existing resources as a precaution</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get -o yaml --all-namespaces \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">issuer,clusterissuer,certificates,certificaterequests \&gt; cert-manager-backup.yaml</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>&gt; <strong>Important:</strong>
&gt; If you are upgrading from a version older than 0.11.0, Update the apiVersion on all your backed up resources from <code>certmanager.k8s.io/v1alpha1</code> to <code>cert-manager.io/v1alpha2</code>. If you use any cert-manager annotations on any of your other resources, you will need to update them to reflect the new API group. For details, refer to the documentation on <a href="https://cert-manager.io/docs/installation/upgrading/upgrading-0.10-0.11/#additional-annotation-changes" target="_blank" rel="noopener noreferrer">additional annotation changes.</a></p></li><li><p>Delete the existing cert-manager installation</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl -n cert-manager \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">delete deployment,sa,clusterrole,clusterrolebinding \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">-l &#x27;app=cert-manager&#x27; -l &#x27;chart=cert-manager-v0.5.2&#x27;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Delete the CustomResourceDefinition using the link to the version vX.Y you installed</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete -f cert-manager/cert-manager-crd-old.yaml</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Install the CustomResourceDefinition resources separately</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f cert-manager/cert-manager-crd.yaml</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>&gt; <strong>Note:</strong>
&gt; If you are running Kubernetes v1.15 or below, you will need to add the <code>--validate=false</code> flag to your <code>kubectl apply</code> command above. Otherwise, you will receive a validation error relating to the <code>x-kubernetes-preserve-unknown-fields</code> field in cert-managerâ€™s CustomResourceDefinition resources. This is a benign error and occurs due to the way kubectl performs resource validation.</p></li><li><p>Create the namespace for cert-manager</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl create namespace cert-manager</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>Install cert-manager</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl -n cert-manager apply -R -f ./cert-manager</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p><a href="https://cert-manager.io/docs/tutorials/backup/#restoring-resources" target="_blank" rel="noopener noreferrer">Restore back up resources</a></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly plain"><pre tabindex="0" class="prism-code language-plain codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f cert-manager-backup.yaml</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ol><p>{{% /accordion %}}</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="verify-the-deployment"></a>Verify the Deployment<a class="hash-link" href="#verify-the-deployment" title="Direct link to heading">#</a></h3><p>Once youâ€™ve installed cert-manager, you can verify it is deployed correctly by checking the kube-system namespace for running pods:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods --namespace cert-manager</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                                       READY   STATUS    RESTARTS   AGE</span></span><span class="token-line" style="color:#393A34"><span class="token plain">cert-manager-5c6866597-zw7kh               1/1     Running   0          2m</span></span><span class="token-line" style="color:#393A34"><span class="token plain">cert-manager-cainjector-577f6d9fd7-tr77l   1/1     Running   0          2m</span></span><span class="token-line" style="color:#393A34"><span class="token plain">cert-manager-webhook-787858fcdb-nlzsq      1/1     Running   0          2m</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="cert-manager-api-change-and-data-migration"></a>Cert-Manager API change and data migration<a class="hash-link" href="#cert-manager-api-change-and-data-migration" title="Direct link to heading">#</a></h2><p>Cert-manager has deprecated the use of the <code>certificate.spec.acme.solvers</code> field and will drop support for it completely in an upcoming release.</p><p>Per the cert-manager documentation, a new format for configuring ACME certificate resources was introduced in v0.8. Specifically, the challenge solver configuration field was moved. Both the old format and new are supported as of v0.9, but support for the old format will be dropped in an upcoming release of cert-manager. The cert-manager documentation strongly recommends that after upgrading you update your ACME Issuer and Certificate resources to the new format.</p><p>Details about the change and migration instructions can be found in the <a href="https://cert-manager.io/docs/installation/upgrading/upgrading-0.7-0.8/" target="_blank" rel="noopener noreferrer">cert-manager v0.7 to v0.8 upgrade instructions</a>.</p><p>The v0.11 release marks the removal of the v1alpha1 API that was used in previous versions of cert-manager, as well as our API group changing to be cert-manager.io instead of certmanager.k8s.io.</p><p>We have also removed support for the old configuration format that was deprecated in the v0.8 release. This means you must transition to using the new solvers style configuration format for your ACME issuers before upgrading to v0.11. For more information, see the <a href="https://cert-manager.io/docs/installation/upgrading/upgrading-0.7-0.8/" target="_blank" rel="noopener noreferrer">upgrading to v0.8 guide</a>.</p><p>Details about the change and migration instructions can be found in the <a href="https://cert-manager.io/docs/installation/upgrading/upgrading-0.10-0.11/" target="_blank" rel="noopener noreferrer">cert-manager v0.10 to v0.11 upgrade instructions</a>.</p><p>More info about <a href="https://cert-manager.io/docs/installation/upgrading/" target="_blank" rel="noopener noreferrer">cert-manager upgrade information</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/main/website/versioned_docs/version-2.5.9/installation/resources/upgrading-cert-manager/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/rancher-docusaurus/2.5.9/installation/resources/upgrading-cert-manager/helm-2-instructions"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Upgrading Cert-Manager with Helm 2</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/rancher-docusaurus/2.5.9/best-practices/index"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Intro Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#option-a-upgrade-cert-manager-with-internet-access" class="table-of-contents__link">Option A: Upgrade cert-manager with Internet Access</a></li><li><a href="#option-b-upgrade-cert-manager-in-an-air-gap-environment" class="table-of-contents__link">Option B: Upgrade cert-manager in an Air Gap Environment</a></li><li><a href="#prerequisites" class="table-of-contents__link">Prerequisites</a></li><li><a href="#install-cert-manager" class="table-of-contents__link">Install cert-manager</a></li><li><a href="#verify-the-deployment" class="table-of-contents__link">Verify the Deployment</a></li><li><a href="#cert-manager-api-change-and-data-migration" class="table-of-contents__link">Cert-Manager API change and data migration</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://forums.rancher.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Forums<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://slack.rancher.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/Rancher_Labs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://rancher.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Rancher Website</a></li><li class="footer__item"><a href="https://github.com/rancher/rancher" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Rancher on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/rancher/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Rancher Docs on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/rancher-docusaurus/assets/js/runtime~main.e49194ca.js"></script>
<script src="/rancher-docusaurus/assets/js/main.ed945e9c.js"></script>
</body>
</html>