<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<title data-react-helmet="true">Launching Kubernetes on Windows Clusters | My Site</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://btat.github.io/rancher-docusaurus/cluster-provisioning/rke-clusters/windows-clusters/index"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Launching Kubernetes on Windows Clusters | My Site"><meta data-react-helmet="true" name="description" content="When provisioning a custom cluster using Rancher, Rancher uses RKE (the Rancher Kubernetes Engine) to install Kubernetes on your existing nodes."><meta data-react-helmet="true" property="og:description" content="When provisioning a custom cluster using Rancher, Rancher uses RKE (the Rancher Kubernetes Engine) to install Kubernetes on your existing nodes."><link data-react-helmet="true" rel="shortcut icon" href="/rancher-docusaurus/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://btat.github.io/rancher-docusaurus/cluster-provisioning/rke-clusters/windows-clusters/index"><link data-react-helmet="true" rel="alternate" href="https://btat.github.io/rancher-docusaurus/cluster-provisioning/rke-clusters/windows-clusters/index" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://btat.github.io/rancher-docusaurus/cluster-provisioning/rke-clusters/windows-clusters/index" hreflang="x-default"><link rel="stylesheet" href="/rancher-docusaurus/assets/css/styles.6d09dbb1.css">
<link rel="preload" href="/rancher-docusaurus/assets/js/runtime~main.9668cced.js" as="script">
<link rel="preload" href="/rancher-docusaurus/assets/js/main.7243044c.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/rancher-docusaurus/"><img src="/rancher-docusaurus/img/rancher-logo.svg" alt="Rancher Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/rancher-docusaurus/img/rancher-logo.svg" alt="Rancher Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Rancher Docs</b></a><a href="https://suse-projects.github.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>More SUSE Projects<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Overview</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Rancher Deployment Quick Start Guides</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Installing/Upgrading Rancher</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Best Practices Guide</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Backups and Disaster Recovery</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Authentication, Permissions and Global Configuration</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Setting up Kubernetes Clusters in Rancher</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/cluster-provisioning/cluster-capabilities-table">cluster-capabilities-table</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">hosted-kubernetes-clusters</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/cluster-provisioning/index">Intro</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/cluster-provisioning/node-requirements">Node Requirements for Rancher Managed Clusters</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">production</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/cluster-provisioning/registered-clusters">Registering Existing Clusters</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">rke-clusters</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">cloud-providers</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">custom-nodes</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/cluster-provisioning/rke-clusters/index">Launching Kubernetes with Rancher</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">node-pools</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/cluster-provisioning/rke-clusters/options">RKE Cluster Configuration</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/cluster-provisioning/rke-clusters/rancher-agents">Rancher Agents</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">windows-clusters</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/cluster-provisioning/rke-clusters/windows-clusters/azure-storageclass">Configuration for Storage Classes in Azure</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/cluster-provisioning/rke-clusters/windows-clusters/host-gateway-requirements">Networking Requirements for Host Gateway (L2bridge)</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rancher-docusaurus/cluster-provisioning/rke-clusters/windows-clusters/index">Launching Kubernetes on Windows Clusters</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/cluster-provisioning/rke-clusters/windows-clusters/windows-parity">Windows and Linux Cluster Feature Parity</a></li></ul></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Cluster Administration</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Project Administration</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pipelines</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Deploying Applications across Clusters</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Monitoring and Alerting</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Istio</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Logging</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">CIS Scans</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Kubernetes Resources</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Security</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">User Settings</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">API</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">FAQ</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Troubleshooting</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/cli">Using the Rancher Command Line Interface</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/contributing">Contributing to Rancher</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/helm-charts">Helm Charts in Rancher</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/">Rancher 2.6</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/longhorn">Longhorn - Cloud native distributed block storage for Kubernetes</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/opa-gatekeper">OPA Gatekeeper</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/system-tools">System Tools</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Launching Kubernetes on Windows Clusters</h1></header><p>When provisioning a <a href="https://rancher.com/docs/rancher/v2.6/en/cluster-provisioning/rke-clusters/custom-nodes" target="_blank" rel="noopener noreferrer">custom cluster</a> using Rancher, Rancher uses RKE (the Rancher Kubernetes Engine) to install Kubernetes on your existing nodes.</p><p>In a Windows cluster provisioned with Rancher, the cluster must contain both Linux and Windows nodes. The Kubernetes controlplane can only run on Linux nodes, and the Windows nodes can only have the worker role. Windows nodes can only be used for deploying workloads.</p><p>Some other requirements for Windows clusters include:</p><ul><li>You can only add Windows nodes to a cluster if Windows support is enabled when the cluster is created. Windows support cannot be enabled for existing clusters.</li><li>Kubernetes 1.15+ is required.</li><li>The Flannel network provider must be used.</li><li>Windows nodes must have 50 GB of disk space.</li></ul><p>For the full list of requirements, see <a href="#requirements-for-windows-clusters">this section.</a></p><p>For a summary of Kubernetes features supported in Windows, see the Kubernetes documentation on <a href="https://kubernetes.io/docs/setup/production-environment/windows/intro-windows-in-kubernetes/#supported-functionality-and-limitations" target="_blank" rel="noopener noreferrer">supported functionality and limitations for using Kubernetes with Windows</a> or the <a href="https://kubernetes.io/docs/setup/production-environment/windows/user-guide-windows-containers/" target="_blank" rel="noopener noreferrer">guide for scheduling Windows containers in Kubernetes</a>.</p><header><h1>Changes in Rancher v2.6</h1></header><p><em>Tech Preview</em></p><p>Rancher v2.6 introduces provisioning for <a href="https://docs.rke2.io/" target="_blank" rel="noopener noreferrer">RKE2</a> clusters directly from the Rancher UI. RKE2, also known as RKE Government, is a fully conformant Kubernetes distribution that focuses on security and compliance within the U.S. Federal Government sector.</p><p>The RKE2 provisioning tech preview also includes installing RKE2 on Windows clusters. Windows features for RKE2 include:</p><ul><li>Windows Containers with RKE2 powered by containerd</li><li>Added provisioning of Windows RKE2 custom clusters directly from the Rancher UI</li><li>Calico CNI for Windows RKE2 custom clusters</li><li>SAC releases of Windows Server (2004 and 20H2) are included in the technical preview</li></ul><p>Windows Support for RKE2 Custom Clusters requires choosing Calico as the CNI.</p><header><h1>Requirements for Windows Clusters</h1></header><p>The general node requirements for networking, operating systems, and Docker are the same as the node requirements for a <a href="https://rancher.com/docs/rancher/v2.6/en/installation/requirements/" target="_blank" rel="noopener noreferrer">Rancher installation</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="os-and-docker-requirements"></a>OS and Docker Requirements<a class="hash-link" href="#os-and-docker-requirements" title="Direct link to heading">#</a></h3><p>Our support for Windows Server and Windows containers match the Microsoft official lifecycle for LTSC (Long-Term Servicing Channel) and SAC (Semi-Annual Channel).</p><p>For the support lifecycle dates for Windows Server, see the <a href="https://docs.microsoft.com/en-us/windows-server/get-started/windows-server-release-info" target="_blank" rel="noopener noreferrer">Microsoft Documentation.</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="kubernetes-version"></a>Kubernetes Version<a class="hash-link" href="#kubernetes-version" title="Direct link to heading">#</a></h3><p>Kubernetes v1.15+ is required.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="node-requirements"></a>Node Requirements<a class="hash-link" href="#node-requirements" title="Direct link to heading">#</a></h3><p>The hosts in the cluster need to have at least:</p><ul><li>2 core CPUs</li><li>5 GB memory</li><li>50 GB disk space</li></ul><p>Rancher will not provision the node if the node does not meet these requirements.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="networking-requirements"></a>Networking Requirements<a class="hash-link" href="#networking-requirements" title="Direct link to heading">#</a></h3><p>Before provisioning a new cluster, be sure that you have already installed Rancher on a device that accepts inbound network traffic. This is required in order for the cluster nodes to communicate with Rancher. If you have not already installed Rancher, please refer to the <a href="https://rancher.com/docs/rancher/v2.6/en/installation/" target="_blank" rel="noopener noreferrer">installation documentation</a> before proceeding with this guide.</p><p>Rancher only supports Windows using Flannel as the network provider.</p><p>There are two network options: <a href="https://github.com/coreos/flannel/blob/master/Documentation/backends.md#host-gw" target="_blank" rel="noopener noreferrer"><strong>Host Gateway (L2bridge)</strong></a> and <a href="https://github.com/coreos/flannel/blob/master/Documentation/backends.md#vxlan" target="_blank" rel="noopener noreferrer"><strong>VXLAN (Overlay)</strong></a>. The default option is <strong>VXLAN (Overlay)</strong> mode.</p><p>For <strong>Host Gateway (L2bridge)</strong> networking, it&#x27;s best to use the same Layer 2 network for all nodes. Otherwise, you need to configure the route rules for them. For details, refer to the <a href="https://rancher.com/docs/rancher/v2.6/en/cluster-provisioning/rke-clusters/windows-clusters/host-gateway-requirements/#cloud-hosted-vm-routes-configuration" target="_blank" rel="noopener noreferrer">documentation on configuring cloud-hosted VM routes.</a> You will also need to <a href="https://rancher.com/docs/rancher/v2.6/en/cluster-provisioning/rke-clusters/windows-clusters/host-gateway-requirements/#disabling-private-ip-address-checks" target="_blank" rel="noopener noreferrer">disable private IP address checks</a> if you are using Amazon EC2, Google GCE, or Azure VM.</p><p>For <strong>VXLAN (Overlay)</strong> networking, the <a href="https://support.microsoft.com/en-us/help/4489899" target="_blank" rel="noopener noreferrer">KB4489899</a> hotfix must be installed. Most cloud-hosted VMs already have this hotfix.</p><p>If you are configuring DHCP options sets for an AWS virtual private cloud, note that in the <code>domain-name</code> option field, only one domain name can be specified. According to the DHCP options <a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_DHCP_Options.html" target="_blank" rel="noopener noreferrer">documentation:</a></p><p>&gt; Some Linux operating systems accept multiple domain names separated by spaces. However, other Linux operating systems and Windows treat the value as a single domain, which results in unexpected behavior. If your DHCP options set is associated with a VPC that has instances with multiple operating systems, specify only one domain name.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="architecture-requirements"></a>Architecture Requirements<a class="hash-link" href="#architecture-requirements" title="Direct link to heading">#</a></h3><p>The Kubernetes cluster management nodes (<code>etcd</code> and <code>controlplane</code>) must be run on Linux nodes.</p><p>The <code>worker</code> nodes, which is where your workloads will be deployed on, will typically be Windows nodes, but there must be at least one <code>worker</code> node that is run on Linux in order to run the Rancher cluster agent, DNS, metrics server, and Ingress related containers.</p><p>We recommend the minimum three-node architecture listed in the table below, but you can always add additional Linux and Windows workers to scale up your cluster for redundancy:</p><p>\&lt;a id=&quot;guide-architecture&quot;&gt;\&lt;/a&gt;</p><table><thead><tr><th>Node</th><th>Operating System</th><th>Kubernetes Cluster Role(s)</th><th>Purpose</th></tr></thead><tbody><tr><td>Node 1</td><td>Linux (Ubuntu Server 18.04 recommended)</td><td>Control plane, etcd, worker</td><td>Manage the Kubernetes cluster</td></tr><tr><td>Node 2</td><td>Linux (Ubuntu Server 18.04 recommended)</td><td>Worker</td><td>Support the Rancher Cluster agent, Metrics server, DNS, and Ingress for the cluster</td></tr><tr><td>Node 3</td><td>Windows (Windows Server core version 1809 or above)</td><td>Worker</td><td>Run your Windows containers</td></tr></tbody></table><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="container-requirements"></a>Container Requirements<a class="hash-link" href="#container-requirements" title="Direct link to heading">#</a></h3><p>Windows requires that containers must be built on the same Windows Server version that they are being deployed on. Therefore, containers must be built on Windows Server core version 1809 or above. If you have existing containers built for an earlier Windows Server core version, they must be re-built on Windows Server core version 1809 or above.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="cloud-provider-specific-requirements"></a>Cloud Provider Specific Requirements<a class="hash-link" href="#cloud-provider-specific-requirements" title="Direct link to heading">#</a></h3><p>If you set a Kubernetes cloud provider in your cluster, some additional steps are required. You might want to set a cloud provider if you want to want to leverage a cloud provider&#x27;s capabilities, for example, to automatically provision storage, load balancers, or other infrastructure for your cluster. Refer to <a href="https://rancher.com/docs/rancher/v2.6/en/cluster-provisioning/rke-clusters/cloud-providers/" target="_blank" rel="noopener noreferrer">this page</a> for details on how to configure a cloud provider cluster of nodes that meet the prerequisites.</p><p>If you are using the GCE (Google Compute Engine) cloud provider, you must do the following:</p><ul><li>Enable the GCE cloud provider in the <code>cluster.yml</code> by following <a href="https://rancher.com/docs/rancher/v2.6/en/cluster-provisioning/rke-clusters/cloud-providers/gce" target="_blank" rel="noopener noreferrer">these steps.</a></li><li>When provisioning the cluster in Rancher, choose <strong>Custom cloud provider</strong> as the cloud provider in the Rancher UI.</li></ul><header><h1>Tutorial: How to Create a Cluster with Windows Support</h1></header><p>This tutorial describes how to create a Rancher-provisioned cluster with the three nodes in the <a href="#guide-architecture">recommended architecture.</a></p><p>When you provision a cluster with Rancher on existing nodes, you will add nodes to the cluster by installing the <a href="https://rancher.com/docs/rancher/v2.6/en/cluster-provisioning/rke-clusters/custom-nodes/agent-options/" target="_blank" rel="noopener noreferrer">Rancher agent</a> on each one. When you create or edit your cluster from the Rancher UI, you will see a <strong>Customize Node Run Command</strong> that you can run on each server to add it to your cluster.</p><p>To set up a cluster with support for Windows nodes and containers, you will need to complete the tasks below.</p><p>\&lt;!-- TOC --&gt;</p><ol><li><a href="#1-provision-hosts">Provision Hosts</a></li><li><a href="#2-create-the-cluster-on-existing-nodes">Create the Cluster on Existing Nodes</a></li><li><a href="#3-add-nodes-to-the-cluster">Add Nodes to the Cluster</a></li><li><a href="#4-optional-configuration-for-azure-files">Optional: Configuration for Azure Files</a>
\&lt;!-- /TOC --&gt;</li></ol><header><h1>1. Provision Hosts</h1></header><p>To begin provisioning a cluster on existing nodes with Windows support, prepare your hosts.</p><p>Your hosts can be:</p><ul><li>Cloud-hosted VMs</li><li>VMs from virtualization clusters</li><li>Bare-metal servers</li></ul><p>You will provision three nodes:</p><ul><li>One Linux node, which manages the Kubernetes control plane and stores your <code>etcd</code></li><li>A second Linux node, which will be another worker node</li><li>The Windows node, which will run your Windows containers as a worker node</li></ul><table><thead><tr><th>Node</th><th>Operating System</th></tr></thead><tbody><tr><td>Node 1</td><td>Linux (Ubuntu Server 18.04 recommended)</td></tr><tr><td>Node 2</td><td>Linux (Ubuntu Server 18.04 recommended)</td></tr><tr><td>Node 3</td><td>Windows (Windows Server core version 1809 or above required)</td></tr></tbody></table><p>If your nodes are hosted by a <strong>Cloud Provider</strong> and you want automation support such as loadbalancers or persistent storage devices, your nodes have additional configuration requirements. For details, see <a href="https://rancher.com/docs/rancher/v2.6/en/cluster-provisioning/rke-clusters/cloud-providers" target="_blank" rel="noopener noreferrer">Selecting Cloud Providers.</a></p><header><h1>2. Create the Cluster on Existing Nodes</h1></header><p>The instructions for creating a Windows cluster on existing nodes are very similar to the general <a href="https://rancher.com/docs/rancher/v2.6/en/cluster-provisioning/rke-clusters/custom-nodes/" target="_blank" rel="noopener noreferrer">instructions for creating a custom cluster</a> with some Windows-specific requirements.</p><ol><li>In the upper left corner, click <strong>â˜° &gt; Cluster Management</strong>.</li><li>On the <strong>Clusters</strong> page, click <strong>Create</strong>.</li><li>Click <strong>Custom</strong>.</li><li>Enter a name for your cluster in the <strong>Cluster Name</strong> field.</li><li>In the <strong>Kubernetes Version</strong> dropdown menu, select v1.19 or above.</li><li>In the <strong>Network Provider</strong> field, select <strong>Flannel</strong>.</li><li>In the <strong>Windows Support</strong> section, click <strong>Enabled</strong>.</li><li>Optional: After you enable Windows support, you will be able to choose the Flannel backend. There are two network options: <a href="https://github.com/coreos/flannel/blob/master/Documentation/backends.md#host-gw" target="_blank" rel="noopener noreferrer"><strong>Host Gateway (L2bridge)</strong></a> and <a href="https://github.com/coreos/flannel/blob/master/Documentation/backends.md#vxlan" target="_blank" rel="noopener noreferrer"><strong>VXLAN (Overlay)</strong></a>. The default option is <strong>VXLAN (Overlay)</strong> mode.</li><li>Click <strong>Next</strong>.</li></ol><p>&gt; <strong>Important:</strong> For \&lt;b&gt;Host Gateway (L2bridge)\&lt;/b&gt; networking, it&#x27;s best to use the same Layer 2 network for all nodes. Otherwise, you need to configure the route rules for them. For details, refer to the <a href="https://rancher.com/docs/rancher/v2.6/en/cluster-provisioning/rke-clusters/windows-clusters/host-gateway-requirements/#cloud-hosted-vm-routes-configuration" target="_blank" rel="noopener noreferrer">documentation on configuring cloud-hosted VM routes.</a> You will also need to <a href="https://rancher.com/docs/rancher/v2.6/en/cluster-provisioning/rke-clusters/windows-clusters/host-gateway-requirements/#disabling-private-ip-address-checks" target="_blank" rel="noopener noreferrer">disable private IP address checks</a> if you are using Amazon EC2, Google GCE, or Azure VM.</p><header><h1>3. Add Nodes to the Cluster</h1></header><p>This section describes how to register your Linux and Worker nodes to your cluster. You will run a command on each node, which will install the Rancher agent and allow Rancher to manage each node.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="add-linux-master-node"></a>Add Linux Master Node<a class="hash-link" href="#add-linux-master-node" title="Direct link to heading">#</a></h3><p>In this section, we fill out a form on the Rancher UI to get a custom command to install the Rancher agent on the Linux master node. Then we will copy the command and run it on our Linux master node to register the node in the cluster.</p><p>The first node in your cluster should be a Linux host has both the <strong>Control Plane</strong> and <strong>etcd</strong> roles. At a minimum, both of these roles must be enabled for this node, and this node must be added to your cluster before you can add Windows hosts.</p><ol><li>In the <strong>Node Operating System</strong> section, click <strong>Linux</strong>.</li><li>In the <strong>Node Role</strong> section, choose at least <strong>etcd</strong> and <strong>Control Plane</strong>. We recommend selecting all three.</li><li>Optional: If you click <strong>Show advanced options,</strong> you can customize the settings for the <a href="https://rancher.com/docs/rancher/v2.6/en/cluster-provisioning/rke-clusters/custom-nodes/agent-options/" target="_blank" rel="noopener noreferrer">Rancher agent</a> and <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/" target="_blank" rel="noopener noreferrer">node labels.</a></li><li>Copy the command displayed on the screen to your clipboard.</li><li>SSH into your Linux host and run the command that you copied to your clipboard.</li><li>When you are finished provisioning your Linux node(s), select <strong>Done</strong>.</li></ol><p><strong>Result:</strong> </p><p>Your cluster is created and assigned a state of <strong>Provisioning</strong>. Rancher is standing up your cluster.</p><p>You can access your cluster after its state is updated to <strong>Active</strong>.</p><p><strong>Active</strong> clusters are assigned two Projects: </p><ul><li><code>Default</code>, containing the <code>default</code> namespace</li><li><code>System</code>, containing the <code>cattle-system</code>, <code>ingress-nginx</code>, <code>kube-public</code>, and <code>kube-system</code> namespaces</li></ul><p>It may take a few minutes for the node to be registered in your cluster.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="add-linux-worker-node"></a>Add Linux Worker Node<a class="hash-link" href="#add-linux-worker-node" title="Direct link to heading">#</a></h3><p>In this section, we run a command to register the Linux worker node to the cluster.</p><p>After the initial provisioning of your cluster, your cluster only has a single Linux host. Next, we add another Linux <code>worker</code> host, which will be used to support <em>Rancher cluster agent</em>, <em>Metrics server</em>, <em>DNS</em> and <em>Ingress</em> for your cluster.</p><ol><li>In the upper left corner, click <strong>â˜° &gt; Cluster Management</strong>.</li><li>Go to the cluster that you created and click <strong>â‹® &gt; Edit Config</strong>.</li><li>Scroll down to <strong>Node Operating System</strong>. Choose <strong>Linux</strong>.</li><li>In the <strong>Customize Node Run Command</strong> section, go to the <strong>Node Options</strong> and select the <strong>Worker</strong> role.</li><li>Copy the command displayed on screen to your clipboard.</li><li>Log in to your Linux host using a remote Terminal connection. Run the command copied to your clipboard.</li><li>From <strong>Rancher</strong>, click <strong>Save</strong>.</li></ol><p><strong>Result:</strong> The <strong>Worker</strong> role is installed on your Linux host, and the node registers with Rancher. It may take a few minutes for the node to be registered in your cluster.</p><p>&gt; <strong>Note:</strong> Taints on Linux Worker Nodes
&gt;
&gt; For each Linux worker node added into the cluster, the following taints will be added to Linux worker node. By adding this taint to the Linux worker node, any workloads added to the Windows cluster will be automatically scheduled to the Windows worker node. If you want to schedule workloads specifically onto the Linux worker node, you will need to add tolerations to those workloads.</p><p>&gt; | Taint Key      | Taint Value | Taint Effect |
&gt; | -------------- | ----------- | ------------ |
&gt; | <code>cattle.io/os</code> | <code>linux</code>     | <code>NoSchedule</code> |</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="add-a-windows-worker-node"></a>Add a Windows Worker Node<a class="hash-link" href="#add-a-windows-worker-node" title="Direct link to heading">#</a></h3><p>In this section, we run a command to register the Windows worker node to the cluster.</p><p>You can add Windows hosts to the cluster by editing the cluster and choosing the <strong>Windows</strong> option.</p><ol><li>In the upper left corner, click <strong>â˜° &gt; Cluster Management</strong>.</li><li>Go to the cluster that you created and click <strong>â‹® &gt; Edit Config</strong>.</li><li>Scroll down to <strong>Node Operating System</strong>. Choose <strong>Windows</strong>. Note: You will see that the <strong>worker</strong> role is the only available role.</li><li>Copy the command displayed on screen to your clipboard.</li><li>Log in to your Windows host using your preferred tool, such as <a href="https://docs.microsoft.com/en-us/windows-server/remote/remote-desktop-services/clients/remote-desktop-clients" target="_blank" rel="noopener noreferrer">Microsoft Remote Desktop</a>. Run the command copied to your clipboard in the <strong>Command Prompt (CMD)</strong>.</li><li>From Rancher, click <strong>Save</strong>.</li><li>Optional: Repeat these instructions if you want to add more Windows nodes to your cluster.</li></ol><p><strong>Result:</strong> The <strong>Worker</strong> role is installed on your Windows host, and the node registers with Rancher. It may take a few minutes for the node to be registered in your cluster. You now have a Windows Kubernetes cluster.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="optional-next-steps"></a>Optional Next Steps<a class="hash-link" href="#optional-next-steps" title="Direct link to heading">#</a></h3><p>After creating your cluster, you can access it through the Rancher UI. As a best practice, we recommend setting up these alternate ways of accessing your cluster:</p><ul><li><strong>Access your cluster with the kubectl CLI:</strong> Follow <a href="https://rancher.com/docs/rancher/v2.6/en/cluster-admin/cluster-access/kubectl/#accessing-clusters-with-kubectl-on-your-workstation" target="_blank" rel="noopener noreferrer">these steps</a> to access clusters with kubectl on your workstation. In this case, you will be authenticated through the Rancher serverâ€™s authentication proxy, then Rancher will connect you to the downstream cluster. This method lets you manage the cluster without the Rancher UI.</li><li><strong>Access your cluster with the kubectl CLI, using the authorized cluster endpoint:</strong> Follow <a href="https://rancher.com/docs/rancher/v2.6/en/cluster-admin/cluster-access/kubectl/#authenticating-directly-with-a-downstream-cluster" target="_blank" rel="noopener noreferrer">these steps</a> to access your cluster with kubectl directly, without authenticating through the Rancher server. We recommend setting up this alternative method to access your cluster so that in case you canâ€™t connect to Rancher, you can still access the cluster.</li></ul><header><h1>Configuration for Storage Classes in Azure</h1></header><p>If you are using Azure VMs for your nodes, you can use <a href="https://docs.microsoft.com/en-us/azure/aks/azure-files-dynamic-pv" target="_blank" rel="noopener noreferrer">Azure files</a> as a StorageClass for the cluster. For details, refer to <a href="https://rancher.com/docs/rancher/v2.6/en/cluster-provisioning/rke-clusters/windows-clusters/azure-storageclass" target="_blank" rel="noopener noreferrer">this section.</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/main/website/docs/cluster-provisioning/rke-clusters/windows-clusters/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/rancher-docusaurus/cluster-provisioning/rke-clusters/windows-clusters/host-gateway-requirements"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Networking Requirements for Host Gateway (L2bridge)</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/rancher-docusaurus/cluster-provisioning/rke-clusters/windows-clusters/windows-parity"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Windows and Linux Cluster Feature Parity Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#os-and-docker-requirements" class="table-of-contents__link">OS and Docker Requirements</a></li><li><a href="#kubernetes-version" class="table-of-contents__link">Kubernetes Version</a></li><li><a href="#node-requirements" class="table-of-contents__link">Node Requirements</a></li><li><a href="#networking-requirements" class="table-of-contents__link">Networking Requirements</a></li><li><a href="#architecture-requirements" class="table-of-contents__link">Architecture Requirements</a></li><li><a href="#container-requirements" class="table-of-contents__link">Container Requirements</a></li><li><a href="#cloud-provider-specific-requirements" class="table-of-contents__link">Cloud Provider Specific Requirements</a></li><li><a href="#add-linux-master-node" class="table-of-contents__link">Add Linux Master Node</a></li><li><a href="#add-linux-worker-node" class="table-of-contents__link">Add Linux Worker Node</a></li><li><a href="#add-a-windows-worker-node" class="table-of-contents__link">Add a Windows Worker Node</a></li><li><a href="#optional-next-steps" class="table-of-contents__link">Optional Next Steps</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://forums.rancher.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Forums<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://slack.rancher.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/Rancher_Labs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://rancher.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Rancher Website</a></li><li class="footer__item"><a href="https://github.com/rancher/rancher" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Rancher on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/rancher/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Rancher Docs on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/rancher-docusaurus/assets/js/runtime~main.9668cced.js"></script>
<script src="/rancher-docusaurus/assets/js/main.7243044c.js"></script>
</body>
</html>