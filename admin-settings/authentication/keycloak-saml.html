<!doctype html>
<html class="docs-version-2.4.15" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<title data-react-helmet="true">Configuring Keycloak (SAML) | My Site</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://btat.github.io/rancher-docusaurus/admin-settings/authentication/keycloak-saml"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="2.4.15"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-2.4.15"><meta data-react-helmet="true" property="og:title" content="Configuring Keycloak (SAML) | My Site"><meta data-react-helmet="true" name="description" content="Create a Keycloak SAML client and configure Rancher to work with Keycloak. By the end your users will be able to sign into Rancher using their Keycloak logins"><meta data-react-helmet="true" property="og:description" content="Create a Keycloak SAML client and configure Rancher to work with Keycloak. By the end your users will be able to sign into Rancher using their Keycloak logins"><link data-react-helmet="true" rel="shortcut icon" href="/rancher-docusaurus/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://btat.github.io/rancher-docusaurus/admin-settings/authentication/keycloak-saml"><link data-react-helmet="true" rel="alternate" href="https://btat.github.io/rancher-docusaurus/admin-settings/authentication/keycloak-saml" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://btat.github.io/rancher-docusaurus/admin-settings/authentication/keycloak-saml" hreflang="x-default"><link rel="stylesheet" href="/rancher-docusaurus/assets/css/styles.6d09dbb1.css">
<link rel="preload" href="/rancher-docusaurus/assets/js/runtime~main.e49194ca.js" as="script">
<link rel="preload" href="/rancher-docusaurus/assets/js/main.ed945e9c.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/rancher-docusaurus/"><img src="/rancher-docusaurus/img/rancher-logo.svg" alt="Rancher Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/rancher-docusaurus/img/rancher-logo.svg" alt="Rancher Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Rancher Docs</b></a><a href="https://suse-projects.github.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>More SUSE Projects<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Overview</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Rancher Deployment Quick Start Guides</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Installing/Upgrading Rancher</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Best Practices Guide</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Backups and Disaster Recovery</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Authentication, Permissions and Global Configuration</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">authentication</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/admin-settings/authentication/ad">Configuring Active Directory (AD)</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/admin-settings/authentication/azure-ad">Configuring Azure AD</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/admin-settings/authentication/freeipa">Configuring FreeIPA</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/admin-settings/authentication/github">Configuring GitHub</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/admin-settings/authentication/google">Configuring Google OAuth</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/admin-settings/authentication/index">Authentication</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/admin-settings/authentication/keycloak-oidc">Configuring Keycloak (OIDC)</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rancher-docusaurus/admin-settings/authentication/keycloak-saml">Configuring Keycloak (SAML)</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/admin-settings/authentication/local">Local Authentication</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">microsoft-adfs</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/admin-settings/authentication/okta">Configuring Okta (SAML)</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">openldap</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/admin-settings/authentication/ping-federate">Configuring PingIdentity (SAML)</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">shibboleth</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/admin-settings/authentication/user-groups">Users and Groups</a></li></ul></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/admin-settings/branding">Custom Branding</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/admin-settings/cluster-templates">Cluster Templates</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/admin-settings/config-private-registry">Configuring a Global Default Private Registry</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">drivers</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/admin-settings/index">Intro</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/admin-settings/k8s-metadata">Upgrading Kubernetes without Upgrading Rancher</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/admin-settings/pod-security-policies">Pod Security Policies</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">rbac</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">rke-templates</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Setting up Kubernetes Clusters in Rancher</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Cluster Administration</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Project Administration</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pipelines</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Deploying Applications across Clusters</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Monitoring and Alerting</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Istio</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Logging</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">CIS Scans</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Kubernetes Resources</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Security</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">User Settings</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">API</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">FAQ</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Troubleshooting</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/cli">Using the Rancher Command Line Interface</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/contributing">Contributing to Rancher</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/helm-charts">Helm Charts in Rancher</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/">Rancher 2.6</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/longhorn">Longhorn - Cloud native distributed block storage for Kubernetes</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/opa-gatekeper">OPA Gatekeeper</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/system-tools">System Tools</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><span class="theme-doc-version-badge badge badge--secondary">Version: 2.4.15</span><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Configuring Keycloak (SAML)</h1></header><p>If your organization uses Keycloak Identity Provider (IdP) for user authentication, you can configure Rancher to allow your users to log in using their IdP credentials.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="prerequisites"></a>Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">#</a></h2><ul><li><p>You must have a <a href="https://www.keycloak.org/docs/latest/server_installation/" target="_blank" rel="noopener noreferrer">Keycloak IdP Server</a> configured.</p></li><li><p>In Keycloak, create a <a href="https://www.keycloak.org/docs/latest/server_admin/#saml-clients" target="_blank" rel="noopener noreferrer">new SAML client</a>, with the settings below. See the <a href="https://www.keycloak.org/docs/latest/server_admin/#saml-clients" target="_blank" rel="noopener noreferrer">Keycloak documentation</a> for help.</p><table><thead><tr><th>Setting</th><th>Value</th></tr></thead><tbody><tr><td><code>Sign Documents</code></td><td><code>ON</code> \&lt;sup&gt;1\&lt;/sup&gt;</td></tr><tr><td><code>Sign Assertions</code></td><td><code>ON</code> \&lt;sup&gt;1\&lt;/sup&gt;</td></tr><tr><td>All other <code>ON/OFF</code> Settings</td><td><code>OFF</code></td></tr><tr><td><code>Client ID</code></td><td>Either <code>https://yourRancherHostURL/v1-saml/keycloak/saml/metadata</code> or the value configured in the <code>Entry ID Field</code> of the Rancher Keycloak configuration\&lt;sup&gt;2\&lt;/sup&gt;</td></tr><tr><td><code>Client Name</code></td><td>\&lt;CLIENT_NAME&gt; (e.g. <code>rancher</code>)</td></tr><tr><td><code>Client Protocol</code></td><td><code>SAML</code></td></tr><tr><td><code>Valid Redirect URI</code></td><td><code>https://yourRancherHostURL/v1-saml/keycloak/saml/acs</code></td></tr></tbody></table><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">\&gt;\&lt;sup\&gt;1\&lt;/sup\&gt;: Optionally, you can enable either one or both of these settings.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">\&gt;\&lt;sup\&gt;2\&lt;/sup\&gt;: Rancher SAML metadata won&#x27;t be generated until a SAML provider is configured and saved.</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly img"><pre tabindex="0" class="prism-code language-img codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">  {{ img &quot;/img/rancher/keycloak/keycloak-saml-client-configuration.png&quot; &quot;&quot;}}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>In the new SAML client, create Mappers to expose the users fields<ul><li>Add all &quot;Builtin Protocol Mappers&quot;</li></ul></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly img"><pre tabindex="0" class="prism-code language-img codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">    {{ img &quot;/img/rancher/keycloak/keycloak-saml-client-builtin-mappers.png&quot; &quot;&quot;}}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>Create a new &quot;Group list&quot; mapper to map the member attribute to a user&#x27;s groups</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly img"><pre tabindex="0" class="prism-code language-img codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">    {{ img &quot;/img/rancher/keycloak/keycloak-saml-client-group-mapper.png&quot; &quot;&quot;}}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li><p>Export a <code>metadata.xml</code> file from your Keycloak client:
From the <code>Installation</code> tab, choose the <code>SAML Metadata IDPSSODescriptor</code> format option and download your file.</p><p>&gt;<strong>Note</strong>
&gt; Keycloak versions 6.0.0 and up no longer provide the IDP metadata under the <code>Installation</code> tab.
&gt; You can still get the XML from the following url:
&gt;<br>
&gt; <code>https://{KEYCLOAK-URL}/auth/realms/{REALM-NAME}/protocol/saml/descriptor</code>
&gt;<br>
&gt; The XML obtained from this URL contains <code>EntitiesDescriptor</code> as the root element. Rancher expects the root element to be <code>EntityDescriptor</code> rather than <code>EntitiesDescriptor</code>. So before passing this XML to Rancher, follow these steps to adjust it:
&gt;<br>
&gt;    <em> Copy all the attributes from <code>EntitiesDescriptor</code> to the <code>EntityDescriptor</code> that are not present.
&gt;    </em> Remove the <code>\&lt;EntitiesDescriptor\&gt;</code> tag from the beginning.
&gt;    * Remove the <code>\&lt;/EntitiesDescriptor\&gt;</code> from the end of the xml.
&gt;<br>
&gt; You are left with something similar as the example below:
&gt;<br>
&gt; <code>\&gt; \&lt;EntityDescriptor xmlns=&quot;urn:oasis:names:tc:SAML:2.0:metadata&quot; xmlns:dsig=&quot;http://www.w3.org/2000/09/xmldsig#&quot; entityID=&quot;https://{KEYCLOAK-URL}/auth/realms/{REALM-NAME}&quot;\&gt;
\&gt;   .... 
\&gt; \&lt;/EntityDescriptor\&gt;
\&gt;</code></p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="configuring-keycloak-in-rancher"></a>Configuring Keycloak in Rancher<a class="hash-link" href="#configuring-keycloak-in-rancher" title="Direct link to heading">#</a></h2><ol><li><p>In the top left corner, click <strong>â˜° &gt; Users &amp; Authentication</strong>.</p></li><li><p>In the left navigation menu, click <strong>Auth Provider</strong>.</p></li><li><p>Click <strong>Keycloak SAML</strong>.</p></li><li><p>Complete the <strong>Configure Keycloak Account</strong> form. For help with filling the form, see the <a href="#configuration-reference">configuration reference</a>.</p></li><li><p>After you complete the <strong>Configure a Keycloak Account</strong> form, click <strong>Enable</strong>.</p><p>Rancher redirects you to the IdP login page. Enter credentials that authenticate with Keycloak IdP to validate your Rancher Keycloak configuration.</p><p>&gt;<strong>Note:</strong> You may have to disable your popup blocker to see the IdP login page.</p></li></ol><p><strong>Result:</strong> Rancher is configured to work with Keycloak. Your users can now sign into Rancher using their Keycloak logins.</p><p>{{ saml_caveats }}</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="configuration-reference"></a>Configuration Reference<a class="hash-link" href="#configuration-reference" title="Direct link to heading">#</a></h2><table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td>Display Name Field</td><td>The attribute that contains the display name of users. Example: <code>givenName</code></td></tr><tr><td>User Name Field</td><td>The attribute that contains the user name/given name. Example: <code>email</code></td></tr><tr><td>UID Field</td><td>An attribute that is unique to every user. Example: <code>email</code></td></tr><tr><td>Groups Field</td><td>Make entries for managing group memberships. Example: <code>member</code></td></tr><tr><td>Entity ID Field</td><td>The ID that needs to be configured as a client ID in the Keycloak client. Default: <code>https://yourRancherHostURL/v1-saml/keycloak/saml/metadata</code></td></tr><tr><td>Rancher API Host</td><td>The URL for your Rancher Server.</td></tr><tr><td>Private Key / Certificate</td><td>A key/certificate pair to create a secure shell between Rancher and your IdP.</td></tr><tr><td>IDP-metadata</td><td>The <code>metadata.xml</code> file that you exported from your IdP server.</td></tr></tbody></table><p>&gt;<strong>Tip:</strong> You can generate a key/certificate pair using an openssl command. For example:
&gt;
&gt;        openssl req -x509 -sha256 -nodes -days 365 -newkey rsa:2048 -keyout myservice.key -out myservice.cert</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="annex-troubleshooting"></a>Annex: Troubleshooting<a class="hash-link" href="#annex-troubleshooting" title="Direct link to heading">#</a></h2><p>If you are experiencing issues while testing the connection to the Keycloak server, first double-check the configuration option of your SAML client. You may also inspect the Rancher logs to help pinpointing the problem cause. Debug logs may contain more detailed information about the error. Please refer to <a href="https://rancher.com/docs/rancher/v2.6/en/faq/technical/#how-can-i-enable-debug-logging" target="_blank" rel="noopener noreferrer">How can I enable debug logging</a> in this documentation.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="you-are-not-redirected-to-keycloak"></a>You are not redirected to Keycloak<a class="hash-link" href="#you-are-not-redirected-to-keycloak" title="Direct link to heading">#</a></h3><p>When you click on <strong>Authenticate with Keycloak</strong>, you are not redirected to your IdP.</p><ul><li>Verify your Keycloak client configuration.</li><li>Make sure <code>Force Post Binding</code> set to <code>OFF</code>.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="forbidden-message-displayed-after-idp-login"></a>Forbidden message displayed after IdP login<a class="hash-link" href="#forbidden-message-displayed-after-idp-login" title="Direct link to heading">#</a></h3><p>You are correctly redirected to your IdP login page and you are able to enter your credentials, however you get a <code>Forbidden</code> message afterwards.</p><ul><li>Check the Rancher debug log.</li><li>If the log displays <code>ERROR: either the Response or Assertion must be signed</code>, make sure either <code>Sign Documents</code> or <code>Sign assertions</code> is set to <code>ON</code> in your Keycloak client.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="http-502-when-trying-to-access-v1-samlkeycloaksamlmetadata"></a>HTTP 502 when trying to access /v1-saml/keycloak/saml/metadata<a class="hash-link" href="#http-502-when-trying-to-access-v1-samlkeycloaksamlmetadata" title="Direct link to heading">#</a></h3><p>This is usually due to the metadata not being created until a SAML provider is configured.
Try configuring and saving keycloak as your SAML provider and then accessing the metadata.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="keycloak-error-were-sorry-failed-to-process-response"></a>Keycloak Error: &quot;We&#x27;re sorry, failed to process response&quot;<a class="hash-link" href="#keycloak-error-were-sorry-failed-to-process-response" title="Direct link to heading">#</a></h3><ul><li>Check your Keycloak log.</li><li>If the log displays <code>failed: org.keycloak.common.VerificationException: Client does not have a public key</code>, set <code>Encrypt Assertions</code> to <code>OFF</code> in your Keycloak client.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="keycloak-error-were-sorry-invalid-requester"></a>Keycloak Error: &quot;We&#x27;re sorry, invalid requester&quot;<a class="hash-link" href="#keycloak-error-were-sorry-invalid-requester" title="Direct link to heading">#</a></h3><ul><li>Check your Keycloak log.</li><li>If the log displays <code>request validation failed: org.keycloak.common.VerificationException: SigAlg was null</code>, set <code>Client Signature Required</code> to <code>OFF</code> in your Keycloak client.</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/main/website/versioned_docs/version-2.4.15/admin-settings/authentication/keycloak-saml.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/rancher-docusaurus/admin-settings/authentication/keycloak-oidc"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Configuring Keycloak (OIDC)</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/rancher-docusaurus/admin-settings/authentication/local"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Local Authentication Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link">Prerequisites</a></li><li><a href="#configuring-keycloak-in-rancher" class="table-of-contents__link">Configuring Keycloak in Rancher</a></li><li><a href="#configuration-reference" class="table-of-contents__link">Configuration Reference</a></li><li><a href="#annex-troubleshooting" class="table-of-contents__link">Annex: Troubleshooting</a><ul><li><a href="#you-are-not-redirected-to-keycloak" class="table-of-contents__link">You are not redirected to Keycloak</a></li><li><a href="#forbidden-message-displayed-after-idp-login" class="table-of-contents__link">Forbidden message displayed after IdP login</a></li><li><a href="#http-502-when-trying-to-access-v1-samlkeycloaksamlmetadata" class="table-of-contents__link">HTTP 502 when trying to access /v1-saml/keycloak/saml/metadata</a></li><li><a href="#keycloak-error-were-sorry-failed-to-process-response" class="table-of-contents__link">Keycloak Error: &quot;We&#39;re sorry, failed to process response&quot;</a></li><li><a href="#keycloak-error-were-sorry-invalid-requester" class="table-of-contents__link">Keycloak Error: &quot;We&#39;re sorry, invalid requester&quot;</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://forums.rancher.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Forums<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://slack.rancher.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/Rancher_Labs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://rancher.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Rancher Website</a></li><li class="footer__item"><a href="https://github.com/rancher/rancher" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Rancher on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/rancher/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Rancher Docs on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/rancher-docusaurus/assets/js/runtime~main.e49194ca.js"></script>
<script src="/rancher-docusaurus/assets/js/main.ed945e9c.js"></script>
</body>
</html>