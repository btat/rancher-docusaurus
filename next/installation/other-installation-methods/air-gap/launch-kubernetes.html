<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<title data-react-helmet="true">3. Install Kubernetes (Skip for Docker Installs) | My Site</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://btat.github.io/rancher-docusaurus/next/installation/other-installation-methods/air-gap/launch-kubernetes"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="3. Install Kubernetes (Skip for Docker Installs) | My Site"><meta data-react-helmet="true" name="description" content="\&gt; Skip this section if you are installing Rancher on a single node with Docker."><meta data-react-helmet="true" property="og:description" content="\&gt; Skip this section if you are installing Rancher on a single node with Docker."><link data-react-helmet="true" rel="shortcut icon" href="/rancher-docusaurus/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://btat.github.io/rancher-docusaurus/next/installation/other-installation-methods/air-gap/launch-kubernetes"><link data-react-helmet="true" rel="alternate" href="https://btat.github.io/rancher-docusaurus/next/installation/other-installation-methods/air-gap/launch-kubernetes" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://btat.github.io/rancher-docusaurus/next/installation/other-installation-methods/air-gap/launch-kubernetes" hreflang="x-default"><link rel="stylesheet" href="/rancher-docusaurus/assets/css/styles.6d09dbb1.css">
<link rel="preload" href="/rancher-docusaurus/assets/js/runtime~main.e49194ca.js" as="script">
<link rel="preload" href="/rancher-docusaurus/assets/js/main.ed945e9c.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/rancher-docusaurus/"><img src="/rancher-docusaurus/img/rancher-logo.svg" alt="Rancher Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/rancher-docusaurus/img/rancher-logo.svg" alt="Rancher Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Rancher Docs</b></a><a href="https://suse-projects.github.io/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>More SUSE Projects<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Overview</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Rancher Deployment Quick Start Guides</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Installing/Upgrading Rancher</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/next/installation/index">Intro</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">install-rancher-on-k8s</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">other-installation-methods</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">air-gap</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/next/installation/other-installation-methods/air-gap/index">Air Gapped Helm CLI Install</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">install-rancher</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rancher-docusaurus/next/installation/other-installation-methods/air-gap/launch-kubernetes">3. Install Kubernetes (Skip for Docker Installs)</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/next/installation/other-installation-methods/air-gap/populate-private-registry">2. Collect and Publish Images to your Private Registry</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/next/installation/other-installation-methods/air-gap/prepare-nodes">1. Set up Infrastructure and Private Registry</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">behind-proxy</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/rancher-docusaurus/next/installation/other-installation-methods/index">Other Installation Methods</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">single-node-docker</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">requirements</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">resources</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Best Practices Guide</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Backups and Disaster Recovery</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Authentication, Permissions and Global Configuration</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Setting up Kubernetes Clusters in Rancher</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Cluster Administration</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Project Administration</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Pipelines</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Deploying Applications across Clusters</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Monitoring and Alerting</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Istio</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Logging</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">CIS Scans</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Kubernetes Resources</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Security</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">User Settings</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">API</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">FAQ</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Troubleshooting</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/next/cli">Using the Rancher Command Line Interface</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/next/contributing">Contributing to Rancher</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/next/helm-charts">Helm Charts in Rancher</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/next">Rancher 2.6</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/next/longhorn">Longhorn - Cloud native distributed block storage for Kubernetes</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/next/opa-gatekeper">OPA Gatekeeper</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/rancher-docusaurus/next/system-tools">System Tools</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for My Site <b>Next</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/rancher-docusaurus/installation/other-installation-methods/air-gap/launch-kubernetes">latest version</a></b> (2.4.15).</div></div><div class="docItemContainer_33ec"><article><span class="theme-doc-version-badge badge badge--secondary">Version: Next</span><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>3. Install Kubernetes (Skip for Docker Installs)</h1></header><p>&gt; Skip this section if you are installing Rancher on a single node with Docker.</p><p>This section describes how to install a Kubernetes cluster according to our <a href="https://rancher.com/docs/rancher/v2.6/en/overview/architecture-recommendations/#environment-for-kubernetes-installations" target="_blank" rel="noopener noreferrer">best practices for the Rancher server environment.</a> This cluster should be dedicated to run only the Rancher server.</p><p>Rancher can be installed on any Kubernetes cluster, including hosted Kubernetes providers.</p><p>The steps to set up an air-gapped Kubernetes cluster on RKE or K3s are shown below.</p><p>{{% tabs %}}
{{% tab &quot;K3s&quot; %}}</p><p>In this guide, we are assuming you have created your nodes in your air gapped environment and have a secure Docker private registry on your bastion server.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="installation-outline"></a>Installation Outline<a class="hash-link" href="#installation-outline" title="Direct link to heading">#</a></h3><ol><li><a href="#1-prepare-images-directory">Prepare Images Directory</a></li><li><a href="#2-create-registry-yaml">Create Registry YAML</a></li><li><a href="#3-install-k3s">Install K3s</a></li><li><a href="#4-save-and-start-using-the-kubeconfig-file">Save and Start Using the kubeconfig File</a></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="1-prepare-images-directory"></a>1. Prepare Images Directory<a class="hash-link" href="#1-prepare-images-directory" title="Direct link to heading">#</a></h3><p>Obtain the images tar file for your architecture from the <a href="https://github.com/rancher/k3s/releases" target="_blank" rel="noopener noreferrer">releases</a> page for the version of K3s you will be running.</p><p>Place the tar file in the <code>images</code> directory before starting K3s on each node, for example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">sudo mkdir -p /var/lib/rancher/k3s/agent/images/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo cp ./k3s-airgap-images-$ARCH.tar /var/lib/rancher/k3s/agent/images/</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="2-create-registry-yaml"></a>2. Create Registry YAML<a class="hash-link" href="#2-create-registry-yaml" title="Direct link to heading">#</a></h3><p>Create the registries.yaml file at <code>/etc/rancher/k3s/registries.yaml</code>. This will tell K3s the necessary details to connect to your private registry.</p><p>The registries.yaml file should look like this before plugging in the necessary information:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">---</span></span><span class="token-line" style="color:#393A34"><span class="token plain">mirrors:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  customreg:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    endpoint:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      - &quot;https://ip-to-server:5000&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">configs:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  customreg:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    auth:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      username: xxxxxx # this is the registry username</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      password: xxxxxx # this is the registry password</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    tls:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      cert_file: \&lt;path to the cert file used in the registry\&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      key_file:  \&lt;path to the key file used in the registry\&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      ca_file: \&lt;path to the ca file used in the registry\&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Note, at this time only secure registries are supported with K3s (SSL with custom CA).</p><p>For more information on private registries configuration file for K3s, refer to the <a href="https://rancher.com/docs/k3s/latest/en/installation/private-registry/" target="_blank" rel="noopener noreferrer">K3s documentation.</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="3-install-k3s"></a>3. Install K3s<a class="hash-link" href="#3-install-k3s" title="Direct link to heading">#</a></h3><p>Rancher needs to be installed on a supported Kubernetes version. To find out which versions of Kubernetes are supported for your Rancher version, refer to the <a href="https://rancher.com/support-maintenance-terms/" target="_blank" rel="noopener noreferrer">support maintenance terms.</a></p><p>To specify the K3s version, use the INSTALL_K3S_VERSION environment variable when running the K3s installation script.</p><p>Obtain the K3s binary from the <a href="https://github.com/rancher/k3s/releases" target="_blank" rel="noopener noreferrer">releases</a> page, matching the same version used to get the airgap images tar.
Also obtain the K3s install script at <a href="https://get.k3s.io" target="_blank" rel="noopener noreferrer">https://get.k3s.io</a></p><p>Place the binary in <code>/usr/local/bin</code> on each node.
Place the install script anywhere on each node, and name it <code>install.sh</code>.</p><p>Install K3s on each server:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">INSTALL_K3S_SKIP_DOWNLOAD=true ./install.sh</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Install K3s on each agent:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">INSTALL_K3S_SKIP_DOWNLOAD=true K3S_URL=https://myserver:6443 K3S_TOKEN=mynodetoken ./install.sh</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Note, take care to ensure you replace <code>myserver</code> with the IP or valid DNS of the server and replace <code>mynodetoken</code> with the node-token from the server.
The node-token is on the server at <code>/var/lib/rancher/k3s/server/node-token</code></p><p>&gt;<strong>Note:</strong> K3s additionally provides a <code>--resolv-conf</code> flag for kubelets, which may help with configuring DNS in air-gap networks.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="4-save-and-start-using-the-kubeconfig-file"></a>4. Save and Start Using the kubeconfig File<a class="hash-link" href="#4-save-and-start-using-the-kubeconfig-file" title="Direct link to heading">#</a></h3><p>When you installed K3s on each Rancher server node, a <code>kubeconfig</code> file was created on the node at <code>/etc/rancher/k3s/k3s.yaml</code>. This file contains credentials for full access to the cluster, and you should save this file in a secure location.</p><p>To use this <code>kubeconfig</code> file, </p><ol><li>Install <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/#install-kubectl" target="_blank" rel="noopener noreferrer">kubectl,</a> a Kubernetes command-line tool.</li><li>Copy the file at <code>/etc/rancher/k3s/k3s.yaml</code> and save it to the directory <code>~/.kube/config</code> on your local machine.</li><li>In the kubeconfig file, the <code>server</code> directive is defined as localhost. Configure the server as the DNS of your load balancer, referring to port 6443. (The Kubernetes API server will be reached at port 6443, while the Rancher server will be reached at ports 80 and 443.) Here is an example <code>k3s.yaml</code>:</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span></span><span class="token-line" style="color:#393A34"><span class="token plain">clusters:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">- cluster:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    certificate-authority-data: [CERTIFICATE-DATA]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    server: [LOAD-BALANCER-DNS]:6443 # Edit this line</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: default</span></span><span class="token-line" style="color:#393A34"><span class="token plain">contexts:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">- context:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    cluster: default</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    user: default</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: default</span></span><span class="token-line" style="color:#393A34"><span class="token plain">current-context: default</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Config</span></span><span class="token-line" style="color:#393A34"><span class="token plain">preferences: {}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">users:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">- name: default</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  user:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    password: [PASSWORD]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    username: admin</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>Result:</strong> You can now use <code>kubectl</code> to manage your K3s cluster. If you have more than one kubeconfig file, you can specify which one you want to use by passing in the path to the file when using <code>kubectl</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl --kubeconfig ~/.kube/config/k3s.yaml get pods --all-namespaces</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>For more information about the <code>kubeconfig</code> file, refer to the <a href="https://rancher.com/docs/k3s/latest/en/cluster-access/" target="_blank" rel="noopener noreferrer">K3s documentation</a> or the <a href="https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/" target="_blank" rel="noopener noreferrer">official Kubernetes documentation</a> about organizing cluster access using <code>kubeconfig</code> files.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="note-on-upgrading"></a>Note on Upgrading<a class="hash-link" href="#note-on-upgrading" title="Direct link to heading">#</a></h3><p>Upgrading an air-gap environment can be accomplished in the following manner:</p><ol><li>Download the new air-gap images (tar file) from the <a href="https://github.com/rancher/k3s/releases" target="_blank" rel="noopener noreferrer">releases</a> page for the version of K3s you will be upgrading to. Place the tar in the <code>/var/lib/rancher/k3s/agent/images/</code> directory on each node. Delete the old tar file.</li><li>Copy and replace the old K3s binary in <code>/usr/local/bin</code> on each node. Copy over the install script at <a href="https://get.k3s.io" target="_blank" rel="noopener noreferrer">https://get.k3s.io</a> (as it is possible it has changed since the last release). Run the script again just as you had done in the past with the same environment variables.</li><li>Restart the K3s service (if not restarted automatically by installer).
{{% /tab %}}
{{% tab &quot;RKE&quot; %}}
We will create a Kubernetes cluster using Rancher Kubernetes Engine (RKE). Before being able to start your Kubernetes cluster, youâ€™ll need to install RKE and create a RKE config file.</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="1-install-rke"></a>1. Install RKE<a class="hash-link" href="#1-install-rke" title="Direct link to heading">#</a></h3><p>Install RKE by following the instructions in the <a href="https://rancher.com/docs/rke/latest/en/installation/" target="_blank" rel="noopener noreferrer">RKE documentation.</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="2-create-an-rke-config-file"></a>2. Create an RKE Config File<a class="hash-link" href="#2-create-an-rke-config-file" title="Direct link to heading">#</a></h3><p>From a system that can access ports 22/TCP and 6443/TCP on the Linux host node(s) that you set up in a previous step, use the sample below to create a new file named <code>rancher-cluster.yml</code>.</p><p>This file is an RKE configuration file, which is a configuration for the cluster you&#x27;re deploying Rancher to.</p><p>Replace values in the code sample below with help of the <em>RKE Options</em> table. Use the IP address or DNS names of the three nodes you created.</p><p>&gt; <strong>Tip:</strong> For more details on the options available, see the RKE <a href="https://rancher.com/docs/rke/latest/en/config-options/" target="_blank" rel="noopener noreferrer">Config Options</a>.</p><p>\&lt;figcaption&gt;RKE Options\&lt;/figcaption&gt;</p><table><thead><tr><th>Option</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td><code>address</code></td><td>âœ“</td><td>The DNS or IP address for the node within the air gapped network.</td></tr><tr><td><code>user</code></td><td>âœ“</td><td>A user that can run Docker commands.</td></tr><tr><td><code>role</code></td><td>âœ“</td><td>List of Kubernetes roles assigned to the node.</td></tr><tr><td><code>internal_address</code></td><td>optional\&lt;sup&gt;1\&lt;/sup&gt;</td><td>The DNS or IP address used for internal cluster traffic.</td></tr><tr><td><code>ssh_key_path</code></td><td></td><td>Path to the SSH private key used to authenticate to the node (defaults to <code>~/.ssh/id_rsa</code>).</td></tr></tbody></table><p>&gt; \&lt;sup&gt;1\&lt;/sup&gt; Some services like AWS EC2 require setting the <code>internal_address</code> if you want to use self-referencing security groups or firewalls.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">nodes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10.10.3.187 </span><span class="token comment" style="color:#999988;font-style:italic"># node air gap network IP</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">internal_address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 172.31.7.22 </span><span class="token comment" style="color:#999988;font-style:italic"># node intra-cluster IP</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">user</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> rancher</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">role</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;controlplane&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;etcd&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;worker&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ssh_key_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /home/user/.ssh/id_rsa</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10.10.3.254 </span><span class="token comment" style="color:#999988;font-style:italic"># node air gap network IP</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">internal_address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 172.31.13.132 </span><span class="token comment" style="color:#999988;font-style:italic"># node intra-cluster IP</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">user</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> rancher</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">role</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;controlplane&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;etcd&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;worker&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ssh_key_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /home/user/.ssh/id_rsa</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10.10.3.89 </span><span class="token comment" style="color:#999988;font-style:italic"># node air gap network IP</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">internal_address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 172.31.3.216 </span><span class="token comment" style="color:#999988;font-style:italic"># node intra-cluster IP</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">user</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> rancher</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">role</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;controlplane&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;etcd&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;worker&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ssh_key_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /home/user/.ssh/id_rsa</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">private_registries</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">url</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">REGISTRY.YOURDOMAIN.COM</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">PORT</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># private registry url</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">user</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> rancher</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">password</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;*********&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">is_default</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="3-run-rke"></a>3. Run RKE<a class="hash-link" href="#3-run-rke" title="Direct link to heading">#</a></h3><p>After configuring <code>rancher-cluster.yml</code>, bring up your Kubernetes cluster:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">rke up --config ./rancher-cluster.yml</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="4-save-your-files"></a>4. Save Your Files<a class="hash-link" href="#4-save-your-files" title="Direct link to heading">#</a></h3><p>&gt; <strong>Important</strong>
&gt; The files mentioned below are needed to maintain, troubleshoot and upgrade your cluster.</p><p>Save a copy of the following files in a secure location:</p><ul><li><code>rancher-cluster.yml</code>: The RKE cluster configuration file.</li><li><code>kube_config_rancher-cluster.yml</code>: The <a href="https://rancher.com/docs/rke/latest/en/kubeconfig/" target="_blank" rel="noopener noreferrer">Kubeconfig file</a> for the cluster, this file contains credentials for full access to the cluster.</li><li><code>rancher-cluster.rkestate</code>: The <a href="https://rancher.com/docs/rke/latest/en/installation/#kubernetes-cluster-state" target="_blank" rel="noopener noreferrer">Kubernetes Cluster State file</a>, this file contains the current state of the cluster including the RKE configuration and the certificates.<em>The Kubernetes Cluster State file is only created when using RKE v0.2.0 or higher.</em>
{{% /tab %}}
{{% /tabs %}}</li></ul><p>&gt; <strong>Note:</strong> The &quot;rancher-cluster&quot; parts of the two latter file names are dependent on how you name the RKE cluster configuration file.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="issues-or-errors"></a>Issues or errors?<a class="hash-link" href="#issues-or-errors" title="Direct link to heading">#</a></h3><p>See the <a href="https://rancher.com/docs/rancher/v2.6/en/installation/resources/troubleshooting/" target="_blank" rel="noopener noreferrer">Troubleshooting</a> page.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="next-install-rancher"></a><a href="/rancher-docusaurus/next/installation/other-installation-methods/install-rancher">Next: Install Rancher</a><a class="hash-link" href="#next-install-rancher" title="Direct link to heading">#</a></h3></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/main/website/docs/installation/other-installation-methods/air-gap/launch-kubernetes.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/rancher-docusaurus/next/installation/other-installation-methods/air-gap/install-rancher/index"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« 4. Install Rancher</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/rancher-docusaurus/next/installation/other-installation-methods/air-gap/populate-private-registry"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">2. Collect and Publish Images to your Private Registry Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#installation-outline" class="table-of-contents__link">Installation Outline</a></li><li><a href="#1-prepare-images-directory" class="table-of-contents__link">1. Prepare Images Directory</a></li><li><a href="#2-create-registry-yaml" class="table-of-contents__link">2. Create Registry YAML</a></li><li><a href="#3-install-k3s" class="table-of-contents__link">3. Install K3s</a></li><li><a href="#4-save-and-start-using-the-kubeconfig-file" class="table-of-contents__link">4. Save and Start Using the kubeconfig File</a></li><li><a href="#note-on-upgrading" class="table-of-contents__link">Note on Upgrading</a></li><li><a href="#1-install-rke" class="table-of-contents__link">1. Install RKE</a></li><li><a href="#2-create-an-rke-config-file" class="table-of-contents__link">2. Create an RKE Config File</a></li><li><a href="#3-run-rke" class="table-of-contents__link">3. Run RKE</a></li><li><a href="#4-save-your-files" class="table-of-contents__link">4. Save Your Files</a></li><li><a href="#issues-or-errors" class="table-of-contents__link">Issues or errors?</a></li><li><a href="#next-install-rancher" class="table-of-contents__link">Next: Install Rancher</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://forums.rancher.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Forums<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://slack.rancher.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/Rancher_Labs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://rancher.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Rancher Website</a></li><li class="footer__item"><a href="https://github.com/rancher/rancher" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Rancher on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/rancher/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Rancher Docs on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/rancher-docusaurus/assets/js/runtime~main.e49194ca.js"></script>
<script src="/rancher-docusaurus/assets/js/main.ed945e9c.js"></script>
</body>
</html>