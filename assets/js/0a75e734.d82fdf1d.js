"use strict";(self.webpackChunkrancher_docusaurus=self.webpackChunkrancher_docusaurus||[]).push([[54405],{3905:function(e,t,r){r.d(t,{Zo:function(){return p},kt:function(){return h}});var o=r(67294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},a=Object.keys(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var l=o.createContext({}),u=function(e){var t=o.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},p=function(e){var t=u(e.components);return o.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var r=e.components,n=e.mdxType,a=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),d=u(r),h=n,m=d["".concat(l,".").concat(h)]||d[h]||c[h]||a;return r?o.createElement(m,s(s({ref:t},p),{},{components:r})):o.createElement(m,s({ref:t},p))}));function h(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var a=r.length,s=new Array(a);s[0]=d;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:n,s[1]=i;for(var u=2;u<a;u++)s[u]=r[u];return o.createElement.apply(null,s)}return o.createElement.apply(null,r)}d.displayName="MDXCreateElement"},80023:function(e,t,r){r.r(t),r.d(t,{frontMatter:function(){return i},contentTitle:function(){return l},metadata:function(){return u},toc:function(){return p},default:function(){return d}});var o=r(87462),n=r(63366),a=(r(67294),r(3905)),s=["components"],i={title:"Kubernetes Persistent Storage: Volumes and Storage Classes",description:"Learn about the two ways with which you can create persistent storage in Kubernetes: persistent volumes and storage classes",position:2031},l=void 0,u={unversionedId:"cluster-admin/volumes-and-storage/index",id:"version-2.4.15/cluster-admin/volumes-and-storage/index",isDocsHomePage:!1,title:"Kubernetes Persistent Storage: Volumes and Storage Classes",description:"Learn about the two ways with which you can create persistent storage in Kubernetes: persistent volumes and storage classes",source:"@site/versioned_docs/version-2.4.15/cluster-admin/volumes-and-storage/index.md",sourceDirName:"cluster-admin/volumes-and-storage",slug:"/cluster-admin/volumes-and-storage/index",permalink:"/rancher-docusaurus/cluster-admin/volumes-and-storage/index",editUrl:"https://github.com/facebook/docusaurus/edit/main/website/versioned_docs/version-2.4.15/cluster-admin/volumes-and-storage/index.md",tags:[],version:"2.4.15",frontMatter:{title:"Kubernetes Persistent Storage: Volumes and Storage Classes",description:"Learn about the two ways with which you can create persistent storage in Kubernetes: persistent volumes and storage classes",position:2031},sidebar:"version-2.4.15/tutorialSidebar",previous:{title:"How Persistent Storage Works",permalink:"/rancher-docusaurus/cluster-admin/volumes-and-storage/how-storage-works"},next:{title:"iSCSI Volumes",permalink:"/rancher-docusaurus/cluster-admin/volumes-and-storage/iscsi-volumes"}},p=[{value:"Prerequisites",id:"prerequisites",children:[]},{value:"Setting up Existing Storage",id:"setting-up-existing-storage",children:[]},{value:"Dynamically Provisioning New Storage in Rancher",id:"dynamically-provisioning-new-storage-in-rancher",children:[]},{value:"Longhorn Storage",id:"longhorn-storage",children:[]},{value:"Provisioning Storage Examples",id:"provisioning-storage-examples",children:[]},{value:"GlusterFS Volumes",id:"glusterfs-volumes",children:[]},{value:"iSCSI Volumes",id:"iscsi-volumes",children:[]},{value:"hostPath Volumes",id:"hostpath-volumes",children:[]},{value:"Migrating vSphere Cloud Provider from In-tree to Out-of-tree",id:"migrating-vsphere-cloud-provider-from-in-tree-to-out-of-tree",children:[]},{value:"Related Links",id:"related-links",children:[]}],c={toc:p};function d(e){var t=e.components,r=(0,n.Z)(e,s);return(0,a.kt)("wrapper",(0,o.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"When deploying an application that needs to retain data, you'll need to create persistent storage. Persistent storage allows you to store application data external from the pod running your application. This storage practice allows you to maintain application data, even if the application's pod fails."),(0,a.kt)("p",null,"The documents in this section assume that you understand the Kubernetes concepts of persistent volumes, persistent volume claims, and storage classes. For more information, refer to the section on ",(0,a.kt)("a",{parentName:"p",href:"./how-storage-works"},"how storage works.")),(0,a.kt)("h3",{id:"prerequisites"},"Prerequisites"),(0,a.kt)("p",null,"To set up persistent storage, the ",(0,a.kt)("inlineCode",{parentName:"p"},"Manage Volumes")," ",(0,a.kt)("a",{parentName:"p",href:"https://rancher.com/docs/rancher/v2.6/en/admin-settings/rbac/cluster-project-roles/#project-role-reference"},"role")," is required."),(0,a.kt)("p",null,"If you are provisioning storage for a cluster hosted in the cloud, the storage and cluster hosts must have the same cloud provider."),(0,a.kt)("p",null,"For provisioning new storage with Rancher, the cloud provider must be enabled. For details on enabling cloud providers, refer to ",(0,a.kt)("a",{parentName:"p",href:"https://rancher.com/docs/rancher/v2.6/en/cluster-provisioning/rke-clusters/cloud-providers/"},"this page.")),(0,a.kt)("p",null,"For attaching existing persistent storage to a cluster, the cloud provider does not need to be enabled."),(0,a.kt)("h3",{id:"setting-up-existing-storage"},"Setting up Existing Storage"),(0,a.kt)("p",null,"The overall workflow for setting up existing storage is as follows:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Set up your persistent storage. This may be storage in an infrastructure provider, or it could be your own storage."),(0,a.kt)("li",{parentName:"ol"},"Add a persistent volume (PV) that refers to the persistent storage."),(0,a.kt)("li",{parentName:"ol"},"Add a persistent volume claim (PVC) that refers to the PV."),(0,a.kt)("li",{parentName:"ol"},"Mount the PVC as a volume in your workload.")),(0,a.kt)("p",null,"For details and prerequisites, refer to ",(0,a.kt)("a",{parentName:"p",href:"./attaching-existing-storage"},"this page.")),(0,a.kt)("h3",{id:"dynamically-provisioning-new-storage-in-rancher"},"Dynamically Provisioning New Storage in Rancher"),(0,a.kt)("p",null,"The overall workflow for provisioning new storage is as follows:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Add a StorageClass and configure it to use your storage provider. The StorageClass could refer to storage in an infrastructure provider, or it could refer to your own storage."),(0,a.kt)("li",{parentName:"ol"},"Add a persistent volume claim (PVC) that refers to the storage class."),(0,a.kt)("li",{parentName:"ol"},"Mount the PVC as a volume for your workload.")),(0,a.kt)("p",null,"For details and prerequisites, refer to ",(0,a.kt)("a",{parentName:"p",href:"./provisioning-new-storage"},"this page.")),(0,a.kt)("h3",{id:"longhorn-storage"},"Longhorn Storage"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://longhorn.io/"},"Longhorn")," is a lightweight, reliable and easy-to-use distributed block storage system for Kubernetes."),(0,a.kt)("p",null,"Longhorn is free, open source software. Originally developed by Rancher Labs, it is now being developed as a sandbox project of the Cloud Native Computing Foundation. It can be installed on any Kubernetes cluster with Helm, with kubectl, or with the Rancher UI."),(0,a.kt)("p",null,"If you have a pool of block storage, Longhorn can help you provide persistent storage to your Kubernetes cluster without relying on cloud providers. For more information about Longhorn features, refer to the ",(0,a.kt)("a",{parentName:"p",href:"https://longhorn.io/docs/1.0.2/what-is-longhorn/"},"documentation.")),(0,a.kt)("p",null,"Rancher v2.5 simplified the process of installing Longhorn on a Rancher-managed cluster. For more information, see ",(0,a.kt)("a",{parentName:"p",href:"https://rancher.com/docs/rancher/v2.6/en/longhorn"},"this page.")),(0,a.kt)("h3",{id:"provisioning-storage-examples"},"Provisioning Storage Examples"),(0,a.kt)("p",null,"We provide examples of how to provision storage with ",(0,a.kt)("a",{parentName:"p",href:"./examples/nfs"},"NFS,")," ",(0,a.kt)("a",{parentName:"p",href:"./examples/vsphere"},"vSphere,")," and ",(0,a.kt)("a",{parentName:"p",href:"./examples/ebs"},"Amazon's EBS.")),(0,a.kt)("h3",{id:"glusterfs-volumes"},"GlusterFS Volumes"),(0,a.kt)("p",null,"In clusters that store data on GlusterFS volumes, you may experience an issue where pods fail to mount volumes after restarting the ",(0,a.kt)("inlineCode",{parentName:"p"},"kubelet"),". For details on preventing this from happening, refer to ",(0,a.kt)("a",{parentName:"p",href:"./glusterfs-volumes"},"this page.")),(0,a.kt)("h3",{id:"iscsi-volumes"},"iSCSI Volumes"),(0,a.kt)("p",null,"In ",(0,a.kt)("a",{parentName:"p",href:"https://rancher.com/docs/rancher/v2.6/en/cluster-provisioning/rke-clusters/"},"Rancher Launched Kubernetes clusters")," that store data on iSCSI volumes, you may experience an issue where kubelets fail to automatically connect with iSCSI volumes. For details on resolving this issue, refer to ",(0,a.kt)("a",{parentName:"p",href:"./iscsi-volumes"},"this page.")),(0,a.kt)("h3",{id:"hostpath-volumes"},"hostPath Volumes"),(0,a.kt)("p",null,"Before you create a hostPath volume, you need to set up an ",(0,a.kt)("a",{parentName:"p",href:"https://rancher.com/docs/rke/latest/en/config-options/services/services-extras/#extra-binds/"},"extra_bind")," in your cluster configuration. This will mount the path as a volume in your kubelets, which can then be used for hostPath volumes in your workloads."),(0,a.kt)("h3",{id:"migrating-vsphere-cloud-provider-from-in-tree-to-out-of-tree"},"Migrating vSphere Cloud Provider from In-tree to Out-of-tree"),(0,a.kt)("p",null,"Kubernetes is moving away from maintaining cloud providers in-tree. vSphere has an out-of-tree cloud provider that can be used by installing the vSphere cloud provider and cloud storage plugins."),(0,a.kt)("p",null,"For instructions on how to migrate from the in-tree vSphere cloud provider to out-of-tree, and manage the existing VMs post migration, refer to ",(0,a.kt)("a",{parentName:"p",href:"https://rancher.com/docs/rancher/v2.6/en/cluster-provisioning/rke-clusters/cloud-providers/vsphere/out-of-tree"},"this page.")),(0,a.kt)("h3",{id:"related-links"},"Related Links"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://kubernetes.io/docs/concepts/storage/"},"Kubernetes Documentation: Storage"))))}d.isMDXComponent=!0}}]);