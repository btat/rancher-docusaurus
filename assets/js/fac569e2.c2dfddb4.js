"use strict";(self.webpackChunkrancher_docusaurus=self.webpackChunkrancher_docusaurus||[]).push([[2805],{3905:function(e,t,r){r.d(t,{Zo:function(){return c},kt:function(){return m}});var o=r(7294);function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function n(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,o,s=function(e,t){if(null==e)return{};var r,o,s={},a=Object.keys(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||(s[r]=e[r]);return s}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}var u=o.createContext({}),l=function(e){var t=o.useContext(u),r=t;return e&&(r="function"==typeof e?e(t):n(n({},t),e)),r},c=function(e){var t=l(e.components);return o.createElement(u.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},p=o.forwardRef((function(e,t){var r=e.components,s=e.mdxType,a=e.originalType,u=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),p=l(r),m=s,h=p["".concat(u,".").concat(m)]||p[m]||d[m]||a;return r?o.createElement(h,n(n({ref:t},c),{},{components:r})):o.createElement(h,n({ref:t},c))}));function m(e,t){var r=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var a=r.length,n=new Array(a);n[0]=p;var i={};for(var u in t)hasOwnProperty.call(t,u)&&(i[u]=t[u]);i.originalType=e,i.mdxType="string"==typeof e?e:s,n[1]=i;for(var l=2;l<a;l++)n[l]=r[l];return o.createElement.apply(null,n)}return o.createElement.apply(null,r)}p.displayName="MDXCreateElement"},4:function(e,t,r){r.r(t),r.d(t,{frontMatter:function(){return i},contentTitle:function(){return u},metadata:function(){return l},toc:function(){return c},default:function(){return p}});var o=r(7462),s=r(3366),a=(r(7294),r(3905)),n=["components"],i={title:"How Persistent Storage Works",position:1},u=void 0,l={unversionedId:"cluster-admin/volumes-and-storage/how-storage-works",id:"cluster-admin/volumes-and-storage/how-storage-works",isDocsHomePage:!1,title:"How Persistent Storage Works",description:"A persistent volume (PV) is a piece of storage in the Kubernetes cluster, while a persistent volume claim (PVC) is a request for storage.",source:"@site/docs/cluster-admin/volumes-and-storage/how-storage-works.md",sourceDirName:"cluster-admin/volumes-and-storage",slug:"/cluster-admin/volumes-and-storage/how-storage-works",permalink:"/rancher-docusaurus/cluster-admin/volumes-and-storage/how-storage-works",editUrl:"https://github.com/facebook/docusaurus/edit/main/website/docs/cluster-admin/volumes-and-storage/how-storage-works.md",tags:[],version:"current",frontMatter:{title:"How Persistent Storage Works",position:1},sidebar:"tutorialSidebar",previous:{title:"GlusterFS Volumes",permalink:"/rancher-docusaurus/cluster-admin/volumes-and-storage/glusterfs-volumes"},next:{title:"Kubernetes Persistent Storage: Volumes and Storage Classes",permalink:"/rancher-docusaurus/cluster-admin/volumes-and-storage/index"}},c=[{value:"PVCs are Required for Both New and Existing Persistent Storage",id:"pvcs-are-required-for-both-new-and-existing-persistent-storage",children:[]},{value:"Binding PVs to PVCs",id:"binding-pvs-to-pvcs",children:[]}],d={toc:c};function p(e){var t=e.components,r=(0,s.Z)(e,n);return(0,a.kt)("wrapper",(0,o.Z)({},d,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"A persistent volume (PV) is a piece of storage in the Kubernetes cluster, while a persistent volume claim (PVC) is a request for storage."),(0,a.kt)("p",null,"There are two ways to use persistent storage in Kubernetes:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Use an existing persistent volume"),(0,a.kt)("li",{parentName:"ul"},"Dynamically provision new persistent volumes")),(0,a.kt)("p",null,"To use an existing PV, your application will need to use a PVC that is bound to a PV, and the PV should include the minimum resources that the PVC requires."),(0,a.kt)("p",null,"For dynamic storage provisioning, your application will need to use a PVC that is bound to a storage class. The storage class contains the authorization to provision new persistent volumes."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-img"},"![Setting Up New and Existing Persistent Storage](./assets/img/rancher/rancher-storage.svg)\n")),(0,a.kt)("p",null,"For more information, refer to the ",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/storage/volumes/"},"official Kubernetes documentation on storage")),(0,a.kt)("h1",{id:"about-persistent-volume-claims"},"About Persistent Volume Claims"),(0,a.kt)("p",null,"Persistent volume claims (PVCs) are objects that request storage resources from your cluster. They're similar to a voucher that your deployment can redeem for storage access. A PVC is mounted into a workloads as a volume so that the workload can claim its specified share of the persistent storage."),(0,a.kt)("p",null,"To access persistent storage, a pod must have a PVC mounted as a volume. This PVC lets your deployment application store its data in an external location, so that if a pod fails, it can be replaced with a new pod and continue accessing its data stored externally, as though an outage never occurred."),(0,a.kt)("p",null,"Each Rancher project contains a list of PVCs that you've created, available from ",(0,a.kt)("strong",{parentName:"p"},"Resources ",">"," Workloads ",">"," Volumes"),". You can reuse these PVCs when creating deployments in the future."),(0,a.kt)("h3",{id:"pvcs-are-required-for-both-new-and-existing-persistent-storage"},"PVCs are Required for Both New and Existing Persistent Storage"),(0,a.kt)("p",null,"A PVC is required for pods to use any persistent storage, regardless of whether the workload is intended to use storage that already exists, or the workload will need to dynamically provision new storage on demand."),(0,a.kt)("p",null,"If you are setting up existing storage for a workload, the workload mounts a PVC, which refers to a PV, which corresponds to existing storage infrastructure."),(0,a.kt)("p",null,"If a workload should request new storage, the workload mounts PVC, which refers to a storage class, which has the capability to create a new PV along with its underlying storage infrastructure."),(0,a.kt)("p",null,"Rancher lets you create as many PVCs within a project as you'd like."),(0,a.kt)("p",null,"You can mount PVCs to a deployment as you create it, or later, after the deployment is running."),(0,a.kt)("h1",{id:"setting-up-existing-storage-with-a-pvc-and-pv"},"Setting up Existing Storage with a PVC and PV"),(0,a.kt)("p",null,"Your pods can store data in ",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/storage/volumes/"},"volumes,")," but if the pod fails, that data is lost. To solve this issue, Kubernetes offers persistent volumes (PVs), which are Kubernetes resources that correspond to external storage disks or file systems that your pods can access. If a pod crashes, its replacement pod can access the data in persistent storage without any data loss."),(0,a.kt)("p",null,"PVs can represent a physical disk or file system that you host on premise, or a vendor-hosted storage resource, such as Amazon EBS or Azure Disk."),(0,a.kt)("p",null,"Creating a persistent volume in Rancher will not create a storage volume. It only creates a Kubernetes resource that maps to an existing volume. Therefore, before you can create a persistent volume as a Kubernetes resource, you must have storage provisioned."),(0,a.kt)("p",null,">"," ",(0,a.kt)("strong",{parentName:"p"},"Important:")," PVs are created at the cluster level, which means that in a multi-tenant cluster, teams with access to separate namespaces could have access to the same PV."),(0,a.kt)("h3",{id:"binding-pvs-to-pvcs"},"Binding PVs to PVCs"),(0,a.kt)("p",null,"When pods are set up to use persistent storage, they mount a persistent volume claim (PVC) that is mounted the same way as any other Kubernetes volume. When each PVC is created, the Kubernetes master considers it to be a request for storage and binds it to a PV that matches the minimum resource requirements of the PVC. Not every PVC is guaranteed to be bound to a PV. According to the Kubernetes ",(0,a.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/storage/persistent-volumes/"},"documentation,")),(0,a.kt)("p",null,">"," Claims will remain unbound indefinitely if a matching volume does not exist. Claims will be bound as matching volumes become available. For example, a cluster provisioned with many 50Gi PVs would not match a PVC requesting 100Gi. The PVC can be bound when a 100Gi PV is added to the cluster."),(0,a.kt)("p",null,"In other words, you can create unlimited PVCs, but they will only be bound to PVs if the Kubernetes master can find a sufficient PVs that has at least the amount of disk space required by the PVC."),(0,a.kt)("p",null,"To dynamically provision new storage, the PVC mounted in the pod would have to correspond to a storage class instead of a persistent volume."),(0,a.kt)("h1",{id:"provisioning-new-storage-with-a-pvc-and-storage-class"},"Provisioning New Storage with a PVC and Storage Class"),(0,a.kt)("p",null,"Storage Classes allow you to create PVs dynamically without having to create persistent storage in an infrastructure provider first."),(0,a.kt)("p",null,"For example, if a workload is bound to a PVC and the PVC refers to an Amazon EBS Storage Class, the storage class can dynamically create an EBS volume and a corresponding PV."),(0,a.kt)("p",null,"The Kubernetes master will then bind the newly created PV to your workload's PVC, allowing your workload to use the persistent storage."))}p.isMDXComponent=!0}}]);