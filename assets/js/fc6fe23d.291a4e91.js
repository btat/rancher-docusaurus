"use strict";(self.webpackChunkrancher_docusaurus=self.webpackChunkrancher_docusaurus||[]).push([[68296],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return m}});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=r.createContext({}),s=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=s(e.components);return r.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),d=s(n),m=a,h=d["".concat(c,".").concat(m)]||d[m]||p[m]||o;return n?r.createElement(h,l(l({ref:t},u),{},{components:n})):r.createElement(h,l({ref:t},u))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,l=new Array(o);l[0]=d;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:a,l[1]=i;for(var s=2;s<o;s++)l[s]=n[s];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},38232:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return i},contentTitle:function(){return c},metadata:function(){return s},toc:function(){return u},default:function(){return d}});var r=n(87462),a=n(63366),o=(n(67294),n(3905)),l=["components"],i={title:"Cloning Clusters",position:2035},c=void 0,s={unversionedId:"cluster-admin/cloning-clusters",id:"cluster-admin/cloning-clusters",isDocsHomePage:!1,title:"Cloning Clusters",description:"If you have a cluster in Rancher that you want to use as a template for creating similar clusters, you can use Rancher CLI to clone the cluster's configuration, edit it, and then use it to quickly launch the cloned cluster.",source:"@site/docs/cluster-admin/cloning-clusters.md",sourceDirName:"cluster-admin",slug:"/cluster-admin/cloning-clusters",permalink:"/rancher-docusaurus/next/cluster-admin/cloning-clusters",editUrl:"https://github.com/facebook/docusaurus/edit/main/website/docs/cluster-admin/cloning-clusters.md",tags:[],version:"current",frontMatter:{title:"Cloning Clusters",position:2035},sidebar:"tutorialSidebar",previous:{title:"Removing Kubernetes Components from Nodes",permalink:"/rancher-docusaurus/next/cluster-admin/cleaning-cluster-nodes"},next:{title:"How the Authorized Cluster Endpoint Works",permalink:"/rancher-docusaurus/next/cluster-admin/cluster-access/ace"}},u=[{value:"Prerequisites",id:"prerequisites",children:[]},{value:"1. Export Cluster Config",id:"1-export-cluster-config",children:[]},{value:"2. Modify Cluster Config",id:"2-modify-cluster-config",children:[]},{value:"3. Launch Cloned Cluster",id:"3-launch-cloned-cluster",children:[]}],p={toc:u};function d(e){var t=e.components,n=(0,a.Z)(e,l);return(0,o.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"If you have a cluster in Rancher that you want to use as a template for creating similar clusters, you can use Rancher CLI to clone the cluster's configuration, edit it, and then use it to quickly launch the cloned cluster."),(0,o.kt)("p",null,"Duplication of registered clusters is not supported."),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Cluster Type"),(0,o.kt)("th",{parentName:"tr",align:null},"Cloneable?"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("a",{parentName:"td",href:"https://rancher.com/docs/rancher/v2.6/en/cluster-provisioning/rke-clusters/node-pools/"},"Nodes Hosted by Infrastructure Provider")),(0,o.kt)("td",{parentName:"tr",align:null},"\u2713")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("a",{parentName:"td",href:"https://rancher.com/docs/rancher/v2.6/en/cluster-provisioning/hosted-kubernetes-clusters/"},"Hosted Kubernetes Providers")),(0,o.kt)("td",{parentName:"tr",align:null},"\u2713")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("a",{parentName:"td",href:"https://rancher.com/docs/rancher/v2.6/en/cluster-provisioning/rke-clusters/custom-nodes"},"Custom Cluster")),(0,o.kt)("td",{parentName:"tr",align:null},"\u2713")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("a",{parentName:"td",href:"https://rancher.com/docs/rancher/v2.6/en/cluster-provisioning/registered-clusters/"},"Registered Cluster")),(0,o.kt)("td",{parentName:"tr",align:null})))),(0,o.kt)("p",null,">"," ",(0,o.kt)("strong",{parentName:"p"},"Warning:")," During the process of duplicating a cluster, you will edit a config file full of cluster settings. However, we recommend editing only values explicitly listed in this document, as cluster duplication is designed for simple cluster copying, ",(0,o.kt)("em",{parentName:"p"},"not")," wide scale configuration changes. Editing other values may invalidate the config file, which will lead to cluster deployment failure."),(0,o.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,o.kt)("p",null,"Download and install ",(0,o.kt)("a",{parentName:"p",href:"https://rancher.com/docs/rancher/v2.6/en/cli"},"Rancher CLI"),". Remember to ",(0,o.kt)("a",{parentName:"p",href:"https://rancher.com/docs/rancher/v2.6/en/user-settings/api-keys"},"create an API bearer token")," if necessary."),(0,o.kt)("h2",{id:"1-export-cluster-config"},"1. Export Cluster Config"),(0,o.kt)("p",null,"Begin by using Rancher CLI to export the configuration for the cluster that you want to clone."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Open Terminal and change your directory to the location of the Rancher CLI binary, ",(0,o.kt)("inlineCode",{parentName:"p"},"rancher"),".")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Enter the following command to list the clusters managed by Rancher."))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"    ./rancher cluster ls\n")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Find the cluster that you want to clone, and copy either its resource ",(0,o.kt)("inlineCode",{parentName:"p"},"ID")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"NAME")," to your clipboard. From this point on, we'll refer to the resource ",(0,o.kt)("inlineCode",{parentName:"p"},"ID")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"NAME")," as ",(0,o.kt)("inlineCode",{parentName:"p"},"\\<RESOURCE_ID\\>"),", which is used as a placeholder in the next step.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Enter the following command to export the configuration for your cluster."))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"    ./rancher clusters export \\<RESOURCE_ID\\>\n\n\n**Step Result:** The YAML for a cloned cluster prints to Terminal.\n")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Copy the YAML to your clipboard and paste it in a new file. Save the file as ",(0,o.kt)("inlineCode",{parentName:"li"},"cluster-template.yml")," (or any other name, as long as it has a ",(0,o.kt)("inlineCode",{parentName:"li"},".yml")," extension).")),(0,o.kt)("h2",{id:"2-modify-cluster-config"},"2. Modify Cluster Config"),(0,o.kt)("p",null,"Use your favorite text editor to modify the cluster configuration in ",(0,o.kt)("inlineCode",{parentName:"p"},"cluster-template.yml")," for your cloned cluster."),(0,o.kt)("p",null,">"," ",(0,o.kt)("strong",{parentName:"p"},"Note:")," Cluster configuration directives must be nested under the ",(0,o.kt)("inlineCode",{parentName:"p"},"rancher_kubernetes_engine_config")," directive in ",(0,o.kt)("inlineCode",{parentName:"p"},"cluster.yml"),". For more information, refer to the section on ",(0,o.kt)("a",{parentName:"p",href:"https://rancher.com/docs/rancher/v2.6/en/cluster-provisioning/rke-clusters/options/#config-file-structure-in-rancher-v2-3-0"},"the config file structure in Rancher v2.3.0+.")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Open ",(0,o.kt)("inlineCode",{parentName:"p"},"cluster-template.yml")," (or whatever you named your config) in your favorite text editor."),(0,o.kt)("p",{parentName:"li"},">",(0,o.kt)("strong",{parentName:"p"},"Warning:")," Only edit the cluster config values explicitly called out below. Many of the values listed in this file are used to provision your cloned cluster, and editing their values may break the provisioning process."))),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"As depicted in the example below, at the ",(0,o.kt)("inlineCode",{parentName:"p"},"\\<CLUSTER_NAME\\>")," placeholder, replace your original cluster's name with a unique name (",(0,o.kt)("inlineCode",{parentName:"p"},"\\<CLUSTER_NAME\\>"),"). If your cloned cluster has a duplicate name, the cluster will not provision successfully."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-yml"},"Version: v3\nclusters:\n    \\<CLUSTER_NAME\\>: # ENTER UNIQUE NAME\n    dockerRootDir: /var/lib/docker\n    enableNetworkPolicy: false\n    rancherKubernetesEngineConfig:\n    addonJobTimeout: 30\n    authentication:\n        strategy: x509\n    authorization: {}\n    bastionHost: {}\n    cloudProvider: {}\n    ignoreDockerVersion: true\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"For each ",(0,o.kt)("inlineCode",{parentName:"p"},"nodePools")," section, replace the original nodepool name with a unique name at the ",(0,o.kt)("inlineCode",{parentName:"p"},"\\<NODEPOOL_NAME\\>")," placeholder.  If your cloned cluster has a duplicate nodepool name, the cluster will not provision successfully."),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-yml"},"nodePools:\n    \\<NODEPOOL_NAME\\>:\n    clusterId: do\n    controlPlane: true\n    etcd: true\n    hostnamePrefix: mark-do\n    nodeTemplateId: do\n    quantity: 1\n    worker: true\n"))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"When you're done, save and close the configuration."))),(0,o.kt)("h2",{id:"3-launch-cloned-cluster"},"3. Launch Cloned Cluster"),(0,o.kt)("p",null,"Move ",(0,o.kt)("inlineCode",{parentName:"p"},"cluster-template.yml")," into the same directory as the Rancher CLI binary. Then run this command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"./rancher up --file cluster-template.yml\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Result:")," Your cloned cluster begins provisioning. Enter ",(0,o.kt)("inlineCode",{parentName:"p"},"./rancher cluster ls")," to confirm."))}d.isMDXComponent=!0}}]);