"use strict";(self.webpackChunkrancher_docusaurus=self.webpackChunkrancher_docusaurus||[]).push([[1830],{3905:function(e,t,r){r.d(t,{Zo:function(){return p},kt:function(){return h}});var n=r(7294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var l=n.createContext({}),u=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},p=function(e){var t=u(e.components);return n.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),c=u(r),h=o,d=c["".concat(l,".").concat(h)]||c[h]||m[h]||a;return r?n.createElement(d,i(i({ref:t},p),{},{components:r})):n.createElement(d,i({ref:t},p))}));function h(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=r.length,i=new Array(a);i[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var u=2;u<a;u++)i[u]=r[u];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}c.displayName="MDXCreateElement"},2581:function(e,t,r){r.r(t),r.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return u},toc:function(){return p},default:function(){return c}});var n=r(7462),o=r(3366),a=(r(7294),r(3905)),i=["components"],s={title:"Intro",shortTitle:"Monitoring/Alerting",description:"Prometheus lets you view metrics from your different Rancher and Kubernetes objects. Learn about the scope of monitoring and how to enable cluster monitoring",position:1},l=void 0,u={unversionedId:"monitoring-alerting/index",id:"monitoring-alerting/index",isDocsHomePage:!1,title:"Intro",description:"Prometheus lets you view metrics from your different Rancher and Kubernetes objects. Learn about the scope of monitoring and how to enable cluster monitoring",source:"@site/docs/monitoring-alerting/index.md",sourceDirName:"monitoring-alerting",slug:"/monitoring-alerting/index",permalink:"/rancher-docusaurus/monitoring-alerting/index",editUrl:"https://github.com/facebook/docusaurus/edit/main/website/docs/monitoring-alerting/index.md",tags:[],version:"current",frontMatter:{title:"Intro",shortTitle:"Monitoring/Alerting",description:"Prometheus lets you view metrics from your different Rancher and Kubernetes objects. Learn about the scope of monitoring and how to enable cluster monitoring",position:1},sidebar:"tutorialSidebar",previous:{title:"How Monitoring Works",permalink:"/rancher-docusaurus/monitoring-alerting/how-monitoring-works"},next:{title:"Role-based Access Control",permalink:"/rancher-docusaurus/monitoring-alerting/rbac"}},p=[{value:"Features",id:"features",children:[]},{value:"Built-in Dashboards",id:"built-in-dashboards",children:[]},{value:"Default Metrics Exporters",id:"default-metrics-exporters",children:[]},{value:"Default Alerts",id:"default-alerts",children:[]},{value:"Components Exposed in the Rancher UI",id:"components-exposed-in-the-rancher-ui",children:[]},{value:"Configuring Monitoring Resources in Rancher",id:"configuring-monitoring-resources-in-rancher",children:[]},{value:"Configuring Helm Chart Options",id:"configuring-helm-chart-options",children:[]}],m={toc:p};function c(e){var t=e.components,r=(0,o.Z)(e,i);return(0,a.kt)("wrapper",(0,n.Z)({},m,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Using the ",(0,a.kt)("inlineCode",{parentName:"p"},"rancher-monitoring")," application, you can quickly deploy leading open-source monitoring and alerting solutions onto your cluster."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#features"},"Features")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#how-monitoring-works"},"How Monitoring Works")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#default-components-and-deployments"},"Default Components and Deployments")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#role-based-access-control"},"Role-based Access Control")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#guides"},"Guides")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#windows-cluster-support"},"Windows Cluster Support")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"#known-issues"},"Known Issues"))),(0,a.kt)("h3",{id:"features"},"Features"),(0,a.kt)("p",null,"Prometheus lets you view metrics from your Rancher and Kubernetes objects. Using timestamps, Prometheus lets you query and view these metrics in easy-to-read graphs and visuals, either through the Rancher UI or Grafana, which is an analytics viewing platform deployed along with Prometheus."),(0,a.kt)("p",null,"By viewing data that Prometheus scrapes from your cluster control plane, nodes, and deployments, you can stay on top of everything happening in your cluster. You can then use these analytics to better run your organization: stop system emergencies before they start, develop maintenance strategies, or restore crashed servers."),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"rancher-monitoring")," operator, introduced in Rancher v2.5, is powered by ",(0,a.kt)("a",{parentName:"p",href:"https://prometheus.io/"},"Prometheus"),", ",(0,a.kt)("a",{parentName:"p",href:"https://grafana.com/grafana/"},"Grafana"),",  ",(0,a.kt)("a",{parentName:"p",href:"https://prometheus.io/docs/alerting/latest/alertmanager/"},"Alertmanager"),", the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/prometheus-operator/prometheus-operator"},"Prometheus Operator"),", and the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/DirectXMan12/k8s-prometheus-adapter"},"Prometheus adapter.")),(0,a.kt)("p",null,"The monitoring application allows you to:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Monitor the state and processes of your cluster nodes, Kubernetes components, and software deployments"),(0,a.kt)("li",{parentName:"ul"},"Define alerts based on metrics collected via Prometheus"),(0,a.kt)("li",{parentName:"ul"},"Create custom Grafana dashboards"),(0,a.kt)("li",{parentName:"ul"},"Configure alert-based notifications via Email, Slack, PagerDuty, etc. using Prometheus Alertmanager"),(0,a.kt)("li",{parentName:"ul"},"Defines precomputed, frequently needed or computationally expensive expressions as new time series based on metrics collected via Prometheus"),(0,a.kt)("li",{parentName:"ul"},"Expose collected metrics from Prometheus to the Kubernetes Custom Metrics API via Prometheus Adapter for use in HPA")),(0,a.kt)("h1",{id:"how-monitoring-works"},"How Monitoring Works"),(0,a.kt)("p",null,"For an explanation of how the monitoring components work together, see ",(0,a.kt)("a",{parentName:"p",href:"./how-monitoring-works"},"this page.")),(0,a.kt)("h1",{id:"default-components-and-deployments"},"Default Components and Deployments"),(0,a.kt)("h3",{id:"built-in-dashboards"},"Built-in Dashboards"),(0,a.kt)("p",null,"By default, the monitoring application deploys Grafana dashboards (curated by the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/prometheus-operator/kube-prometheus"},"kube-prometheus")," project) onto a cluster."),(0,a.kt)("p",null,"It also deploys an Alertmanager UI and a Prometheus UI. For more information about these tools, see ",(0,a.kt)("a",{parentName:"p",href:"./dashboards"},"Built-in Dashboards.")),(0,a.kt)("h3",{id:"default-metrics-exporters"},"Default Metrics Exporters"),(0,a.kt)("p",null,"By default, Rancher Monitoring deploys exporters (such as ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/prometheus/node_exporter"},"node-exporter")," and ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/kubernetes/kube-state-metrics"},"kube-state-metrics"),")."),(0,a.kt)("p",null,"These default exporters automatically scrape metrics for CPU and memory from all components of your Kubernetes cluster, including your workloads."),(0,a.kt)("h3",{id:"default-alerts"},"Default Alerts"),(0,a.kt)("p",null,"The monitoring application deploys some alerts by default. To see the default alerts, go to the ",(0,a.kt)("a",{parentName:"p",href:"./dashboards/#alertmanager-ui"},"Alertmanager UI")," and click ",(0,a.kt)("strong",{parentName:"p"},"Expand all groups.")),(0,a.kt)("h3",{id:"components-exposed-in-the-rancher-ui"},"Components Exposed in the Rancher UI"),(0,a.kt)("p",null,"For a list of monitoring components exposed in the Rancher UI, along with common use cases for editing them, see ",(0,a.kt)("a",{parentName:"p",href:"./how-monitoring-works/#components-exposed-in-the-rancher-ui"},"this section.")),(0,a.kt)("h1",{id:"role-based-access-control"},"Role-based Access Control"),(0,a.kt)("p",null,"For information on configuring access to monitoring, see ",(0,a.kt)("a",{parentName:"p",href:"./rbac"},"this page.")),(0,a.kt)("h1",{id:"guides"},"Guides"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"./guides/enable-monitoring"},"Enable monitoring")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"./guides/uninstall"},"Uninstall monitoring")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"./guides/monitoring-workloads"},"Monitoring workloads")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"./guides/customize-grafana"},"Customizing Grafana dashboards")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"./guides/persist-grafana"},"Persistent Grafana dashboards")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"./guides/memory-usage"},"Debugging high memory usage")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"./guides/migrating"},"Migrating from Monitoring V1 to V2"))),(0,a.kt)("h1",{id:"configuration"},"Configuration"),(0,a.kt)("h3",{id:"configuring-monitoring-resources-in-rancher"},"Configuring Monitoring Resources in Rancher"),(0,a.kt)("p",null,">"," The configuration reference assumes familiarity with how monitoring components work together. For more information, see ",(0,a.kt)("a",{parentName:"p",href:"./how-monitoring-works"},"How Monitoring Works.")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"./configuration/servicemonitor-podmonitor"},"ServiceMonitor and PodMonitor")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"./configuration/receiver"},"Receiver")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"./configuration/route"},"Route")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"./configuration/advanced/prometheusrules"},"PrometheusRule")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"./configuration/advanced/prometheus"},"Prometheus")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"./configuration/advanced/alertmanager"},"Alertmanager"))),(0,a.kt)("h3",{id:"configuring-helm-chart-options"},"Configuring Helm Chart Options"),(0,a.kt)("p",null,"For more information on ",(0,a.kt)("inlineCode",{parentName:"p"},"rancher-monitoring")," chart options, including options to set resource limits and requests, see ",(0,a.kt)("a",{parentName:"p",href:"./configuration/helm-chart-options"},"this page.")),(0,a.kt)("h1",{id:"windows-cluster-support"},"Windows Cluster Support"),(0,a.kt)("p",null,"When deployed onto an RKE1 Windows cluster, Monitoring V2 will now automatically deploy a ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/prometheus-community/windows_exporter"},"windows-exporter")," DaemonSet and set up a ServiceMonitor to collect metrics from each of the deployed Pods. This will populate Prometheus with ",(0,a.kt)("inlineCode",{parentName:"p"},"windows_")," metrics that are akin to the ",(0,a.kt)("inlineCode",{parentName:"p"},"node_")," metrics exported by ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/prometheus/node_exporter"},"node_exporter")," for Linux hosts."),(0,a.kt)("p",null,"To be able to fully deploy Monitoring V2 for Windows, all of your Windows hosts must have a minimum ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/rancher/wins"},"wins")," version of v0.1.0."),(0,a.kt)("p",null,"For more details on how to upgrade wins on existing Windows hosts, refer to the section on ",(0,a.kt)("a",{parentName:"p",href:"./windows-clusters"},"Windows cluster support for Monitoring V2.")),(0,a.kt)("h1",{id:"known-issues"},"Known Issues"),(0,a.kt)("p",null,"There is a ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/rancher/rancher/issues/28787#issuecomment-693611821"},"known issue")," that K3s clusters require more default memory. If you are enabling monitoring on a K3s cluster, we recommend to setting ",(0,a.kt)("inlineCode",{parentName:"p"},"prometheus.prometheusSpec.resources.memory.limit")," to 2500 Mi and ",(0,a.kt)("inlineCode",{parentName:"p"},"prometheus.prometheusSpec.resources.memory.request")," to 1750 Mi."),(0,a.kt)("p",null,"For tips on debugging high memory usage, see ",(0,a.kt)("a",{parentName:"p",href:"./guides/memory-usage"},"this page.")))}c.isMDXComponent=!0}}]);